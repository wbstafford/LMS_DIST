import{d as L,j as e,m as R,a1 as E,a2 as H,c as G,r as a,w as U,a3 as _,x as q,y as J,f as B}from"./index-BSiKmnSf.js";import{C as K}from"./CourseCard-C6xNM68j.js";import{C as Q}from"./CourseStatusBar-DHzjfyVf.js";const W=({bundle:s,searchTerm:i,isEcomm:w})=>{const u=L(),b=()=>{u(`/student/bundle/${s.Id}`)},C=s.Price!==null&&s.Price!==void 0?s.Price.toFixed(2):"N/A",y=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),d=(n,l)=>{if(!l)return n;const I=y(l),c=new RegExp(`(${I})`,"gi"),m=n.split(c);return e.jsx(e.Fragment,{children:m.map((h,S)=>c.test(h)?e.jsx("span",{className:"bg-yellow-200",children:h},S):h)})};return e.jsxs(R.div,{className:"relative p-0 shadow-sm cursor-pointer courseCard card-bg courseCardBorder rounded-lg",style:{display:"flex",flexDirection:"column"},initial:{opacity:0},animate:{opacity:1},transition:{duration:.25},whileHover:{scale:1.05},onClick:b,children:[e.jsx("div",{className:"h-48",style:{flexShrink:0},children:e.jsx(E,{courses:s.courses,imgHeight:48})}),e.jsxs("div",{className:"text-white ml-2 font-bold",style:{marginTop:"-20px"},children:["<","Bundle",">"]}),e.jsxs("div",{className:"flex flex-col flex-grow mt-1 p-3",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("h3",{className:"text-gray-700 font-bold monster",children:i?d(s.Name,i):s.Name}),e.jsx("p",{className:"text-gray-700 courseCardDescription mt-1 text-sm",children:i?d(s.ShortDescription,i):s.ShortDescription})]}),e.jsxs("div",{className:"mt-2 flex justify-end",children:[s.Price!==0&&w&&e.jsxs("div",{className:"mr-2 pt-1 text-sm font-bold text-gray-700",children:["$",C]}),e.jsx("button",{onClick:n=>{n.stopPropagation(),b()},className:"w-7 h-7 flex items-center justify-center rounded-full text-white bg-gray-300","aria-label":"Play Course",children:e.jsx(H,{size:12,className:"text-white",style:{marginLeft:"1px"}})})]})]})]})},X=()=>{const{user:s}=G(),[i,w]=a.useState([]),[u,b]=a.useState("Name"),[C,y]=a.useState(!1),[d,n]=a.useState(localStorage.getItem("viewMode")||"grid"),[l,I]=a.useState(12),[c,m]=a.useState(1),[h,S]=a.useState([]),[j,T]=a.useState("All"),[f,$]=a.useState(""),[g,k]=a.useState(""),[N,z]=a.useState("All"),P=L(),D=t=>{t.type==="course"?P(`/student/course/${t.Id}`):t.type==="bundle"&&P(`/student/bundle/${t.Id}`)},v=a.useMemo(()=>U(t=>{k(t)},300),[]);a.useEffect(()=>(v(f),()=>{v.cancel()}),[f,v]);const O=()=>{$(""),k(""),v.cancel()};a.useEffect(()=>{(async()=>{if(!(s!=null&&s.OrgID))return;const r=sessionStorage.getItem("token");try{const o=await B.get(`https://knowvara.com/api/api/courses/${s.OrgID}/categories`,{headers:{Authorization:`Bearer ${r}`}});S(o.data)}catch(o){console.error("Error fetching categories:",o)}})()},[s==null?void 0:s.OrgID]),a.useEffect(()=>{(async()=>{if(!(s!=null&&s.OrgID)||!(s!=null&&s.Id))return;const r=sessionStorage.getItem("token");if(!r){console.error("No token found, user is not authenticated.");return}y(!0);try{const o=await B.post(`https://knowvara.com/api/api/courses/${s.OrgID}/items`,{userId:s.Id,sortBy:u,categoryId:j!=="All"?j:void 0},{headers:{Authorization:`Bearer ${r}`}}),A=Array.isArray(o.data)?o.data:[];w(A)}catch(o){console.error("Error fetching items:",o)}finally{y(!1)}})()},[s==null?void 0:s.OrgID,s==null?void 0:s.Id,u,j]);const x=a.useMemo(()=>{let t=i;if(N!=="All"&&(t=t.filter(r=>r.type===N.toLowerCase())),g.trim()){const r=g.trim().toLowerCase();t=t.filter(o=>{const A=o.Name.toLowerCase().includes(r),V=o.ShortDescription.toLowerCase().includes(r);return A||V})}return t},[i,g,N]),M=a.useMemo(()=>{if(l==="All")return x;const t=(c-1)*l,r=t+l;return x.slice(t,r)},[x,l,c]),p=a.useMemo(()=>l==="All"?1:Math.ceil(x.length/l),[x,l]),F=t=>{n(t),localStorage.setItem("viewMode",t)};return e.jsxs("div",{className:"px-2",children:[e.jsxs("div",{className:"mb-4 ml-auto flex flex-wrap items-center text-sm gap-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mr-6",children:"Catalog"}),e.jsxs("div",{className:"flex items-center relative",children:[e.jsx("label",{htmlFor:"catalogSearch",className:"mr-2",children:"Search:"}),e.jsx("input",{type:"text",id:"catalogSearch",placeholder:"Search items...",value:f,onChange:t=>$(t.target.value),className:"p-2 pr-8 border rounded text-sm w-64"}),f&&e.jsx("button",{onClick:O,className:"text-gray-500 hover:text-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500 w-5 h-5 flex items-center justify-center transition-opacity duration-200",style:{marginLeft:"-24px"},"aria-label":"Clear search",children:e.jsx(_,{size:12})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"sortBy",className:"mr-2",children:"Sort by:"}),e.jsxs("select",{id:"sortBy",value:u,onChange:t=>b(t.target.value),className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:"Name",children:"Name"}),e.jsx("option",{value:"Likes",children:"Popularity"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"typeFilter",className:"mr-2",children:"Type:"}),e.jsxs("select",{id:"typeFilter",value:N,onChange:t=>z(t.target.value),className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:"All",children:"All"}),e.jsx("option",{value:"course",children:"Courses"}),e.jsx("option",{value:"bundle",children:"Bundles"})]})]}),h.length>0&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"category",className:"mr-2",children:"Category:"}),e.jsxs("select",{id:"category",value:j,onChange:t=>T(t.target.value),className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:"All",children:"All"}),h.map(t=>e.jsx("option",{value:t.Id,children:t.Name},t.Id))]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>F("grid"),className:`mr-2 ${d==="grid"?"text-blue-500":"text-gray-500"}`,"aria-label":"Grid View",children:e.jsx(q,{size:18})}),e.jsx("button",{onClick:()=>F("table"),className:`${d==="table"?"text-blue-500":"text-gray-500"}`,"aria-label":"Table View",children:e.jsx(J,{size:18})})]}),d==="table"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"itemsPerPage",className:"mr-2",children:"Show:"}),e.jsxs("select",{id:"itemsPerPage",value:l,onChange:t=>{const r=t.target.value==="All"?"All":parseInt(t.target.value,10);I(r),m(1)},className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:12,children:"12"}),e.jsx("option",{value:30,children:"30"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),C?e.jsx("p",{className:"text-gray-500",children:"Loading items..."}):d==="grid"?e.jsx("div",{className:"flex flex-wrap justify-start gap-5 lg:gap-8 2xl:gap-12",children:x.length>0?x.map(t=>{if(t.type==="course"){const r=t;return e.jsx(K,{course:r,enrolled:r.enrolled,searchTerm:g,isEcomm:s==null?void 0:s.ecommerce},`course-${r.Id}`)}else if(t.type==="bundle"){const r=t;return e.jsx(W,{bundle:r,searchTerm:g,isEcomm:s==null?void 0:s.ecommerce},`bundle-${r.Id}`)}else return null}):e.jsx("p",{className:"text-gray-500",children:"No items found."})}):e.jsxs("div",{className:"overflow-x-auto mt-6",children:[e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left",children:"Name"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left  hidden md:table-cell",children:"Short Description"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left w-64",children:"Status"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left"})]})}),e.jsx("tbody",{children:M.length>0?M.map(t=>{if(t.type==="course"){const r=t;return e.jsxs("tr",{className:"even:bg-gray-50",children:[e.jsx("td",{className:"py-0 md:py-2 px-0 md:px-4 border-b border-gray-200 w-12 md:w-20",children:e.jsx("img",{src:r.ImageURL||"/GenericCourseIcon.webp",alt:r.Name,className:"w-12 h-8 object-cover rounded"})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:r.Name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 hidden md:table-cell",children:r.ShortDescription}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:r.enrolled&&e.jsx(Q,{courseId:r.Id})}),e.jsx("td",{className:"py-2 px-2 md:px-4 border-b border-gray-200 w-16 md:w-32",children:e.jsx("button",{onClick:()=>D(r),className:"px-3 py-1 text-white text-sm rounded-sm lms-button",children:"Details"})})]},`course-${r.Id}`)}else if(t.type==="bundle"){const r=t;return e.jsxs("tr",{className:"even:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 w-32 h-20",children:e.jsx(E,{courses:r.courses,imgHeight:16})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 font-bold text-gray-700",children:r.Name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:r.ShortDescription}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200"}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 w-32",children:e.jsx("button",{onClick:()=>D(r),className:"px-3 py-1 text-white text-sm rounded-sm lms-button",children:"Details"})})]},`bundle-${r.Id}`)}else return null}):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No items found."})})})]}),l!=="All"&&p>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>m(t=>Math.max(t-1,1)),disabled:c===1,className:`px-2 py-1 text-sm border rounded-md ${c===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:p},(t,r)=>r+1).map(t=>e.jsx("button",{onClick:()=>m(t),className:`px-2 py-1 text-sm border rounded-md ${c===t?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:t},t)),e.jsx("button",{onClick:()=>m(t=>Math.min(t+1,p)),disabled:c===p,className:`px-2 py-1 text-sm border rounded-md ${c===p?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]})]})]})},te=()=>e.jsx("div",{className:"p-2 md:p-4",children:e.jsx(X,{})});export{te as default};
