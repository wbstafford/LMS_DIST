import{v as E,c as $,r as l,j as e,f as u}from"./index-JlNpboNx.js";import{C as A}from"./CourseLessons-rg-8xybY.js";import{P as D}from"./PurchaseCourse-ojbX28hE.js";import{C as L}from"./CourseStatusBar-LbQkWQkb.js";const F=()=>{const{courseId:o}=E(),{user:s}=$(),[n,j]=l.useState(null),[i,d]=l.useState(null),[h,x]=l.useState(null),[b,c]=l.useState(!1),[p,f]=l.useState(null),[N,v]=l.useState(!1);if(l.useEffect(()=>{(async()=>{if(!(s!=null&&s.OrgID)||!o)return;const a=sessionStorage.getItem("token");if(!a){console.error("No token found, user is not authenticated.");return}try{const[t,m]=await Promise.all([u.get(`https://knowvara.com/api/api/courses/${s.OrgID}/${o}`,{headers:{Authorization:`Bearer ${a}`}}),u.get(`https://knowvara.com/api/api/courses/enrollment/${s.Id}/${o}`,{headers:{Authorization:`Bearer ${a}`}})]);j(t.data),m.data.enrolled?(x(m.data.enrollment),console.log("Got enrollment ID: "+m.data.enrollment.id),d(!0)):d(!1)}catch(t){console.error("Error fetching course or enrollment:",t),d(null)}})()},[s==null?void 0:s.OrgID,s==null?void 0:s.Id,o]),!n||i===null)return e.jsx("div",{children:"Loading course details..."});const{Name:g,Description:w,ImageURL:I,Price:r,ShortDescription:y}=n,C=I||"/GenericCourseIcon.webp",S=()=>{v(!0),d(!0),f(null),s!=null&&s.Id&&o&&(async()=>{const a=sessionStorage.getItem("token");if(a)try{const t=await u.get(`https://knowvara.com/api/api/courses/enrollment/${s.Id}/${o}`,{headers:{Authorization:`Bearer ${a}`}});t.data.enrolled&&(x(t.data.enrollment),console.log("Updated enrollment ID: "+t.data.enrollment.id))}catch(t){console.error("Error fetching updated enrollment:",t)}})()},k=()=>{f("The payment could not be processed. Please try again.")};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsx("div",{className:"flex flex-col items-start w-full md:w-1/4 border-r border-gray-300 p-2 shadow md:shadow-xl",children:e.jsxs("div",{className:"p-3",children:[e.jsx("img",{src:C,alt:g,className:"w-full h-auto shadow-lg rounded-lg mb-4"}),e.jsx("div",{className:"mb-2",children:y}),e.jsx("div",{className:"",children:e.jsx(L,{courseId:n.Id})})]})}),e.jsxs("div",{className:"w-full md:w-3/4 p-3 md:p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:g}),e.jsx("div",{className:"mt-2 prose mb-2",dangerouslySetInnerHTML:{__html:w}}),!i&&r!==null&&r!==0&&(s==null?void 0:s.ecommerce)&&e.jsxs("div",{className:"mt-4 p-5 border rounded-lg shadow w-64 items-center text-center",children:[e.jsxs("p",{className:"text-xl",children:["Price: $",r.toFixed(2)]}),e.jsx("button",{onClick:()=>c(!0),className:"py-2 px-4 lms-button text-white rounded-md mt-2",children:"Purchase Now"})]}),e.jsx("div",{className:"py-4",children:e.jsx(A,{courseId:Number(o),enrollmentId:h?h.id:0,hideLaunchButtons:(s==null?void 0:s.ecommerce)&&r!==null&&r>0&&!i,orderLessons:n.orderLessons})})]}),b&&r!==null&&r!==0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 w-full md:w-1/3 m-4 relative",children:[e.jsx("button",{onClick:()=>c(!1),className:"absolute top-2 right-2 text-gray-600 hover:text-gray-800",children:"Ã—"}),N?e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Congratulations! You have successfully purchased this course."}),e.jsx("button",{onClick:()=>c(!1),className:"py-2 px-4 bg-green-500 text-white rounded-md",children:"Close"})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Purchase Course"}),p&&e.jsx("div",{className:"mb-2 text-red-600",children:p}),s!=null&&s.stripeActive?e.jsx(D,{courseId:n.Id,orgId:n.OrgID,amount:r,onSuccess:S,onFailure:k}):e.jsx("div",{className:"text-red-600 font-semibold",children:"The payment account for this organization is not properly set up. Please contact the administrator to receive enrollment."}),!(s!=null&&s.stripeActive)&&e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:()=>c(!1),className:"py-2 px-4 bg-gray-300 text-black rounded-md mr-2",children:"Close"})}),(s==null?void 0:s.stripeActive)&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>c(!1),className:"py-2 px-4 bg-gray-300 text-black rounded-md mr-2",children:"Cancel"})})]})]})})]})};export{F as default};
