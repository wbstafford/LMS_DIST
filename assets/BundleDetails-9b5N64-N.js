import{v as C,c as B,r as a,j as s,a1 as O,aa as A,f as u,B as b}from"./index-qxcGHeRB.js";import{P as z}from"./PurchaseCourse-FVGoeDy4.js";const T=()=>{const{bundleId:t}=C(),{user:e}=B(),[h,j]=a.useState(null),[y,l]=a.useState(null),[I,i]=a.useState(!1),[g,m]=a.useState(null),[N,v]=a.useState(!1),[k,x]=a.useState(!0);if(a.useEffect(()=>{const n=async()=>{if(console.log("org ID: "+(e==null?void 0:e.OrgID)+" bundleId: "+t),!(e!=null&&e.OrgID)||!t){console.error("User OrgID or bundleId is missing.");return}const d=sessionStorage.getItem("token");if(!d){console.error("No token found, user is not authenticated.");return}try{console.log("Fetching bundle with ID:",t);const r=await u.get(`https://knowvara.com/api/api/bundles/${e.OrgID}/${t}`,{headers:{Authorization:`Bearer ${d}`}});console.log("Bundle fetched successfully:",r.data),j(r.data)}catch(r){console.error("Error fetching bundle:",r)}},o=async()=>{if(!(e!=null&&e.Id)||!t){console.error("User ID or bundleId is missing."),l(!1),x(!1);return}const d=sessionStorage.getItem("token");if(!d){console.error("No token found, user is not authenticated."),l(!1),x(!1);return}try{console.log("Checking enrollment for user ID:",e.Id,"and bundle ID:",t);const r=await u.get(`https://knowvara.com/api/api/bundles/${e.OrgID}/${t}/enrollment`,{headers:{Authorization:`Bearer ${d}`}});console.log("Enrollment check response:",r.data),r.data.enrolled?l(!0):l(!1)}catch(r){console.error("Error checking enrollment:",r),l(!1)}finally{x(!1)}};n(),o()},[e==null?void 0:e.OrgID,e==null?void 0:e.Id,t]),!h)return s.jsx("div",{children:"Loading bundle details..."});const{Name:w,Description:D,Price:c,ShortDescription:E,courses:f}=h,P=async()=>{if(v(!0),l(!0),m(null),e!=null&&e.Id&&t)try{const n=sessionStorage.getItem("token");if(!n)return;const o=await u.get(`https://knowvara.com/api/api/bundles/${e.OrgID}/${t}/enrollment`,{headers:{Authorization:`Bearer ${n}`}});o.data.enrolled&&console.log("Updated enrollment:",o.data.enrollment)}catch(n){console.error("Error fetching updated enrollment:",n)}},S=()=>{m("The payment could not be processed. Please try again.")},$=async()=>{if(!(e!=null&&e.Id)||!t){console.error("User ID or bundleId is missing.");return}const n=sessionStorage.getItem("token");if(!n){console.error("No token found, user is not authenticated.");return}try{const o=await u.post(`https://knowvara.com/api/api/bundles/${e.OrgID}/${t}/enroll`,{dueDate:null},{headers:{Authorization:`Bearer ${n}`}});console.log("Enrollment response:",o.data),l(!0),b.success("Successfully enrolled in the bundle!")}catch(o){console.error("Error enrolling in bundle:",o),m("Enrollment failed. Please try again."),b.error("Enrollment failed. Please try again.")}},p=n=>n!=null;return s.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[s.jsx("div",{className:"flex flex-col items-start w-full md:w-1/4 border-r border-gray-300 p-2 shadow-xl",children:s.jsxs("div",{className:"p-3 w-full",children:[s.jsx(O,{courses:f,imgHeight:96}),s.jsx("p",{className:"mt-4 text-gray-600",children:E})]})}),s.jsxs("div",{className:"md:w-3/4 p-4",children:[s.jsx("h2",{className:"text-2xl font-semibold",children:w}),s.jsx("div",{className:"mt-4 text-gray-700",dangerouslySetInnerHTML:{__html:D}}),s.jsx("div",{className:"mt-6",children:k?s.jsx("div",{children:"Checking enrollment status..."}):y?s.jsx("p",{className:"text-green-600 font-semibold",children:"You are already enrolled in this bundle."}):e!=null&&e.ecommerce&&p(c)&&c>0?s.jsxs("div",{className:"mt-4 p-5 border rounded-lg shadow w-64 items-center text-center",children:[s.jsxs("p",{className:"text-xl",children:["Price: $",c.toFixed(2)]}),s.jsx("button",{onClick:()=>i(!0),className:"py-2 px-4 lms-button text-white rounded-md mt-2",children:"Purchase Now"})]}):s.jsx("button",{onClick:$,className:"py-2 px-4 lms-button",children:"Enroll In This Bundle"})}),s.jsxs("div",{className:"mt-8",children:[s.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Courses in this Bundle"}),s.jsx(A,{courses:f})]})]}),I&&p(c)&&c>0&&s.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:s.jsxs("div",{className:"bg-white rounded-lg p-6 w-11/12 md:w-1/3 relative",children:[s.jsx("button",{onClick:()=>i(!1),className:"absolute top-2 right-2 text-gray-600 hover:text-gray-800",children:"Ã—"}),N?s.jsxs("div",{className:"text-center",children:[s.jsx("h2",{className:"text-lg font-bold mb-4",children:"Congratulations! You have successfully purchased this bundle."}),s.jsx("button",{onClick:()=>i(!1),className:"py-2 px-4 bg-green-500 text-white rounded-md",children:"Close"})]}):s.jsxs("div",{children:[s.jsx("h2",{className:"text-lg font-bold mb-4",children:"Purchase Bundle"}),g&&s.jsx("div",{className:"mb-2 text-red-600",children:g}),e!=null&&e.stripeActive?s.jsx(z,{courseId:Number(t),orgId:h.OrgID,amount:c,onSuccess:P,onFailure:S,isBundle:!0}):s.jsx("div",{className:"text-red-600 font-semibold",children:"The payment account for this organization is not properly set up. Please contact the administrator to receive enrollment."}),!(e!=null&&e.stripeActive)&&s.jsx("div",{className:"mt-4",children:s.jsx("button",{onClick:()=>i(!1),className:"py-2 px-4 bg-gray-300 text-black rounded-md mr-2",children:"Close"})}),(e==null?void 0:e.stripeActive)&&s.jsx("div",{className:"mt-4 flex justify-end",children:s.jsx("button",{onClick:()=>i(!1),className:"py-2 px-4 bg-gray-300 text-black rounded-md mr-2",children:"Cancel"})})]})]})})]})};export{T as default};
