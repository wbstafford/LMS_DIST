import{c as W,r,d as J,j as e,B as z,f,an as K,z as Q,C as ne,D as le,E as ie,G as oe,H as ce,I as de,J as me,K as xe,L as pe,N as he,O as ue,P as fe,Q as ge,R as je,S as Ne,T as be,U as ye,V as Fe,W as we,X as Ce,Y as ve,Z as Se,$ as Le,a0 as $e,m as De,F as D,a2 as ke,ak as Ue}from"./index-JlNpboNx.js";import{C as Pe}from"./CourseStatusBar-LbQkWQkb.js";import{f as q}from"./format-Dt71a7ij.js";const Ge=({userId:t,allowLaunch:i})=>{const{user:l}=W(),[a,h]=r.useState([]),[N,o]=r.useState(!0),[S,g]=r.useState(""),L=J(),F=t||(l==null?void 0:l.Id),[k,T]=r.useState({});r.useEffect(()=>{console.log("Allow launch: "+i),(async()=>{if(!F){z.error("User ID is missing. Please log in."),g("User ID is missing. Please log in."),o(!1);return}const n=sessionStorage.getItem("token");if(!n){z.error("Authentication token is missing. Please log in again."),g("Authentication token is missing. Please log in again."),o(!1);return}try{const p=(await f.get(`https://knowvara.com/api/api/learning-plans/users/${F}/learning-plans`,{headers:{Authorization:`Bearer ${n}`}})).data.data;if(h(p),p.length===0)return;const P=Array.from(new Set(p.flatMap(c=>c.courses.map(x=>x.id)))).map(c=>f.get("https://knowvara.com/api/api/courses/completionPercent",{params:{courseId:c,userId:F},headers:{Authorization:`Bearer ${n}`}}).then(x=>({courseId:c,completionPercent:x.data.completionPercent})).catch(x=>(console.error(`Error fetching completion percent for course ${c}:`,x),z.error(`Failed to fetch completion status for course ID ${c}.`),{courseId:c,completionPercent:0}))),$=await Promise.all(P),I={};$.forEach(({courseId:c,completionPercent:x})=>{I[c]=x});const A={};p.forEach(c=>{const x=c.courses.find(E=>I[E.id]<100);x&&(A[c.id]=x.id)}),T(A)}catch(w){console.error("Error fetching Learning Plans:",w),g("Failed to fetch Learning Plans."),z.error("Failed to fetch Learning Plans.")}finally{o(!1)}})()},[F,i]);const U=(u,n)=>{u.stopPropagation(),L(`/student/course/${n}`)};return N?e.jsx("div",{}):S?e.jsx("div",{className:"text-red-500",children:S}):a.length===0?null:e.jsxs("div",{className:"pl-2 pr-2 flex flex-col w-full mb-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-600 mr-8 mb-2",children:"Learning Plans"}),e.jsx("div",{className:"mb-2 w-full",children:a.map(u=>e.jsxs("div",{className:"p-2 pl-0",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-700 ",children:u.name}),e.jsx("div",{className:"flex flex-wrap items-center w-full",children:u.courses.map((n,w)=>{const p=k[u.id]===n.id;return e.jsxs("div",{className:"flex flex-row items-center relative mb-2 ",children:[w!==0&&e.jsx("div",{className:"w-6 h-0.5 mr-0 lpLine hidden md:block"}),e.jsxs("div",{className:`flex flex-col items-start p-2 ${p?"learningPlanDisplaySelected shadow-lg":"learningPlanDisplay"}`,children:[e.jsxs("div",{className:"flex flex-row",children:[e.jsx("img",{src:n.ImageURL||"/GenericCourseIcon.webp",alt:n.name,className:"w-16 h-16 object-cover"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-gray-700 font-bold monster mx-2 mt-0",children:n.name}),e.jsx("span",{className:"text-gray-700  mx-2",children:n.ShortDescription.length>40?`${n.ShortDescription.slice(0,40)}...`:n.ShortDescription})]})]}),e.jsxs("div",{className:"flex flex-row items-center w-full mt-2",children:[e.jsx(Pe,{courseId:n.id}),p&&i&&e.jsx("button",{onClick:b=>U(b,n.id),className:"ml-4 px-3 py-1 text-white text-sm rounded-sm lms-button","aria-label":`View details for ${n.name}`,children:"Launch"})]})]})]},n.id)})})]},u.id))})]})},Ie={FaStar:e.jsx(ne,{}),FaHeart:e.jsx(le,{}),FaCheckCircle:e.jsx(Q,{}),FaMedal:e.jsx(ie,{}),FaTrophy:e.jsx(oe,{}),FaCrown:e.jsx(ce,{}),FaBolt:e.jsx(de,{}),FaLeaf:e.jsx(me,{}),FaRocket:e.jsx(xe,{}),FaShieldAlt:e.jsx(pe,{}),FaGlobe:e.jsx(he,{}),FaLightbulb:e.jsx(ue,{}),FaBook:e.jsx(fe,{}),FaLaptop:e.jsx(ge,{}),FaCamera:e.jsx(je,{}),FaMusic:e.jsx(Ne,{}),FaCameraRetro:e.jsx(be,{}),FaCode:e.jsx(ye,{}),FaCloud:e.jsx(Fe,{}),FaComments:e.jsx(we,{}),FaCoffee:e.jsx(Ce,{}),FaDatabase:e.jsx(ve,{}),FaDice:e.jsx(Se,{}),FaGlasses:e.jsx(Le,{}),FaHeartbeat:e.jsx($e,{})},Ae=(t,i=20,l="#ffffff")=>{const a=Ie[t];return a?K.cloneElement(a,{size:i,color:l}):e.jsx(Q,{size:i,color:l})},Ee=({badges:t,initialDisplayCount:i=3})=>{const[l,a]=r.useState(!1),h=l?t:t.slice(0,i),N=()=>{a(!l)};return e.jsxs("div",{className:"space-y-0",children:[h.map(o=>e.jsxs("div",{className:"flex items-center space-x-4 hover:bg-gray-100 p-1 rounded transition duration-200 cursor-default",children:[e.jsx("div",{className:"w-[60px] h-[60px] rounded-full flex items-center justify-center",style:{backgroundColor:o.color},children:e.jsx("div",{className:"w-[55px] h-[55px] rounded-full bg-white flex items-center justify-center",children:e.jsx("div",{className:"w-[50px] h-[50px] rounded-full flex items-center justify-center text-white",style:{backgroundColor:o.color},children:Ae(o.icon,20,"#ffffff")})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",style:{color:o.color},children:o.badgeName}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Awarded on:"," ",Be(o.awardedAt)?new Date(o.awardedAt).toLocaleDateString():"Unknown Date"]})]})]},o.userBadgeId)),t.length>i&&e.jsx("div",{className:"flex justify-start",children:e.jsx("button",{onClick:N,className:"text-blue-500 hover:underline pt-2","aria-label":l?"Show less badges":"Show more badges",children:l?"Less...":"More..."})})]})},Be=t=>{if(!t)return!1;const i=new Date(t);return!isNaN(i.getTime())},Re=t=>{const[i,l]=r.useState([]),[a,h]=r.useState(!0),[N,o]=r.useState(null);return r.useEffect(()=>{(async()=>{if(!t){o("User ID is required"),h(!1);return}try{const L=await f.get(`https://knowvara.com/api/api/reports/user-badges/${t}`);l(L.data.badges)}catch(g){console.error("Error fetching user badges:",g),o("Failed to fetch user badges")}finally{h(!1)}})()},[t]),{badges:i,loading:a,error:N}},He=({userId:t,gamify:i,isMe:l})=>{const[a,h]=r.useState(null),[N,o]=r.useState(null),[S,g]=r.useState(null),[L,F]=r.useState(null),[k,T]=r.useState(null),[U,u]=r.useState([]),[n,w]=r.useState([]),[p,b]=r.useState(!0),[P,$]=r.useState(null),I=J(),{updateUser:A}=W(),{badges:c,loading:x,error:E}=Re(t),[X,G]=r.useState(!1),[H,C]=r.useState(null),[Y,V]=r.useState(0),O=K.useRef(null),Z={hidden:{opacity:0,y:50},visible:{opacity:1,y:0},exit:{opacity:0,y:-50}};r.useEffect(()=>{(async()=>{if(!t){$("User ID is required"),b(!1);return}const m=sessionStorage.getItem("token");if(!m){console.error("No token found, user is not authenticated."),$("User is not authenticated"),b(!1);return}b(!0);try{const d="https://knowvara.com/api",B=await f.get(`${d}/api/auth/users/${t}`,{headers:{Authorization:`Bearer ${m}`}});h(B.data);const R=await f.get(`${d}/api/reports/user-details/${t}?gamify=true`,{headers:{Authorization:`Bearer ${m}`}}),{completedCourses:v,incompleteCourses:M,points:j,level:y}=R.data;o(v),g(M),F(j),T(y||null);const ae=await f.get(`${d}/api/reports/recent-launched-courses/${t}`,{headers:{Authorization:`Bearer ${m}`}});u(ae.data.recentLaunchedCourses);const re=await f.get(`${d}/api/reports/recent-certificates/${t}`,{headers:{Authorization:`Bearer ${m}`}});w(re.data.recentCertificates)}catch(d){console.error("Error fetching user details, recent courses, or badges:",d),$("Failed to fetch user details")}finally{b(!1)}})()},[t]);const _=s=>{I(`/student/course/${s}`)},ee=s=>{const m=s.startsWith("http")?s:`/content/${s}`;window.open(m,"_blank")},se=s=>{var d;const m=(d=s.target.files)==null?void 0:d[0];m&&te(m)},te=async s=>{var B,R;if(!t||!(a!=null&&a.OrgID)){C("User ID is missing.");return}const m=sessionStorage.getItem("token");if(!m){C("User is not authenticated.");return}G(!0),C(null),V(0);const d=new FormData;d.append("image",s),d.append("orgID",a.OrgID.toString()),d.append("personId",t);try{const M=await f.post(`https://knowvara.com/api/api/auth/users/${t}/image`,d,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${m}`},onUploadProgress:j=>{if(j.total){const y=Math.round(j.loaded*100/j.total);V(y)}}});if(M.status===200){const{imageUrl:j}=M.data;h(y=>y&&{...y,imageUrl:j}),l&&A({imageUrl:j})}else C("Failed to upload image.")}catch(v){console.error("Error uploading image:",v),f.isAxiosError(v)?C(((R=(B=v.response)==null?void 0:B.data)==null?void 0:R.message)||"An Axios error occurred during upload."):C("An unexpected error occurred during upload.")}finally{G(!1)}};return a?e.jsxs(De.div,{className:"bg-white rounded shadow mb-4",variants:Z,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.5,ease:"easeOut"},children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white font-bold",children:"User Details"}),e.jsxs("div",{className:"flex flex-col 2xl:flex-row items-center space-y-4 md:space-y-0 md:space-x-4 p-2 w-full pl-4",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:a.imageUrl?`/content/${a.imageUrl}`:"/defaultUserIcon.webp",alt:`${a.FirstName} ${a.LastName}`,className:"w-28 h-28 rounded-full object-cover cursor-pointer self-center md:self-start",onError:s=>{s.currentTarget.onerror=null,s.currentTarget.src="/defaultUserIcon.webp"},onClick:()=>{var s;l&&((s=O.current)==null||s.click())}})}),l&&e.jsx("input",{type:"file",accept:"image/*",ref:O,onChange:se,className:"hidden"}),e.jsxs("div",{className:"text-center md:text-left w-full 2xl:w-3/5 pt-3 2xl: pt-0",children:[e.jsxs("h2",{className:"text-lg font-semibold",children:[a.FirstName," ",a.LastName]}),e.jsxs("div",{className:"font-semibold text-gray-700 italic",children:[a.jobTitle&&e.jsxs(e.Fragment,{children:[a.jobTitle,", "]}),a.department&&e.jsx(e.Fragment,{children:a.department})]}),i&&k&&e.jsxs("div",{className:"font-semibold text-gray-700",children:["Level: ",k]}),p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading user details..."})]}):P?e.jsx("p",{className:"text-red-500",children:P}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{children:["Completed Courses: ",N]}),e.jsxs("p",{children:["Incomplete Courses: ",S]}),i&&e.jsxs("p",{children:["Points Earned: ",L]})]}),l&&e.jsxs("div",{className:"mt-2",children:[X&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"animate-spin mr-2"}),e.jsxs("span",{children:["Uploading image... ",Y,"%"]})]}),H&&e.jsx("p",{className:"text-red-500 mt-2",children:H})]})]})]}),e.jsxs("div",{className:"p-4 pb-0",children:[e.jsx("h3",{className:"font-bold text-gray-700 mb-2",children:"Recent Courses In Progress"}),p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading recent courses..."})]}):U.length===0?e.jsx("p",{children:"No recent courses launched."}):e.jsx("table",{className:"min-w-full bg-white",children:e.jsx("tbody",{children:U.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"px-4 py-2 pl-2",children:[e.jsx("div",{className:"font-bold text-gray-700",children:s.courseName}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Launched on:"," ",q(new Date(s.timeStamp),"MMMM d, yyyy, h:mm a")]})]}),e.jsx("td",{className:"px-4 py-2 text-right",children:l&&e.jsx("button",{onClick:()=>_(s.courseId),className:"large-icon","aria-label":`Launch ${s.courseName}`,children:e.jsx(ke,{size:20})})})]},s.enrollmentId))})})]}),i&&e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold text-gray-700 mb-2",children:"Badges Earned"}),x?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading badges..."})]}):E?e.jsx("p",{className:"text-red-500",children:E}):c.length===0?e.jsx("p",{children:"No badges earned yet."}):e.jsx(Ee,{badges:c})]}),e.jsxs("div",{className:"p-4 pt-2",children:[e.jsx("h3",{className:"font-bold text-gray-700 mb-2",children:"Recent Certificates Achieved"}),p?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(D,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading certificates..."})]}):n.length===0?e.jsx("p",{children:"No certificates achieved yet."}):e.jsx("table",{className:"min-w-full bg-white",children:e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsxs("td",{className:"px-4 py-2 pl-2",children:[e.jsx("div",{className:"font-bold text-gray-700",children:s.courseName}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Completed on:"," ",q(new Date(s.completedDate),"MMMM d, yyyy")]})]}),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{onClick:()=>ee(s.certificateURL),className:"large-icon","aria-label":`View certificate for ${s.courseName}`,children:e.jsx(Ue,{size:20})})})]},s.completedDate))})})]})]}):e.jsx("div",{children:"Please log in"})};export{Ge as L,He as U};
