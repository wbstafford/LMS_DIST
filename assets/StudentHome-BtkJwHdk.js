import{c as I,r as o,d as M,w as _,j as e,x as O,y as G,F as E,f as y,M as $,z as C,B as j,C as V,D as W,E as K,G as Y,H as J,I as q,J as Q,K as X,L as Z,N as z,O as ee,P as te,Q as se,R as ae,S as re,T as ne,U as oe,V as le,W as ie,X as ce,Y as de,Z as me,$ as xe,a0 as ue,m as he}from"./index-BEzWJCG4.js";import{u as fe}from"./useSubscription-Cm2vNZwW.js";import{C as ge}from"./CourseCard-CDakVDli.js";import{C as pe}from"./CourseStatusBar-B09n0AHh.js";import{L as be,U as je}from"./UserDetails-By-urVPn.js";import{c as T,n as ye,s as L,f as Ne}from"./format-Dt71a7ij.js";const we=()=>{const{user:t}=I(),[a,s]=o.useState([]),[d]=o.useState("y"),[c,m]=o.useState("DueDate"),[x,h]=o.useState(""),[l,u]=o.useState(!1),[r,i]=o.useState(localStorage.getItem("courseFilter")||"all"),[p,b]=o.useState(localStorage.getItem("viewModeHome")||"grid"),F=M(),w=o.useMemo(()=>_(n=>{h(n)},300),[]);o.useEffect(()=>()=>{w.cancel()},[w]),o.useEffect(()=>{(async()=>{if(!(t!=null&&t.OrgID)||!(t!=null&&t.Id))return;const S=sessionStorage.getItem("token");if(!S){console.error("No token found, user is not authenticated.");return}u(!0);try{const f=await y.post(`https://knowvara.com/api/api/courses/catalog/${t.OrgID}`,{userId:t.Id,enrolled:d,sortBy:c},{headers:{Authorization:`Bearer ${S}`}}),g=Array.isArray(f.data)?f.data:[];s(g)}catch(f){console.error("Error fetching courses:",f)}finally{u(!1)}})()},[t==null?void 0:t.OrgID,t==null?void 0:t.Id,d,c]);const k=n=>n?new Date(n).getTime():1/0,N=o.useMemo(()=>{let n=a;if(x.trim()||r!=="all"){const f=x.trim().toLowerCase();n=a.filter(g=>{const U=g.Name.toLowerCase().includes(f),R=g.ShortDescription.toLowerCase().includes(f),H=r==="completed"?["completed","passed"].includes(g.completionStatus):r==="inProgress"?g.completionStatus!=="completed"&&g.completionStatus!=="passed":!0;return(U||R)&&H})}return[...n].sort((f,g)=>c==="DueDate"?k(f.dueDate)-k(g.dueDate):c==="Name"?f.Name.localeCompare(g.Name):c==="Likes"?(g.Likes||0)-(f.Likes||0):0)},[a,x,r,c]),A=()=>{F("/student/catalog")},v=n=>{i(n),localStorage.setItem("courseFilter",n)},D=n=>{b(n),localStorage.setItem("viewModeHome",n)},P=n=>{F(`/student/course/${n}`)};return e.jsxs("div",{className:"pl-2 pr-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700 mr-8 mb-3",children:"My Courses"}),e.jsxs("div",{className:"mb-2 md:mb-6 ml-auto flex flex-wrap items-center text-sm gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"search",className:"mr-2",children:"Search:"}),e.jsx("input",{type:"text",id:"search",placeholder:"Search courses...",onChange:n=>w(n.target.value),className:"p-1 border rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"sortBy",className:"mr-2",children:"Sort by:"}),e.jsxs("select",{id:"sortBy",value:c,onChange:n=>m(n.target.value),className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:"Name",children:"Name"}),e.jsx("option",{value:"Likes",children:"Popularity"}),e.jsx("option",{value:"DueDate",children:"Due Date"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{className:`mr-2 ${r==="all"?"font-bold underline":""}`,onClick:()=>v("all"),children:"All"}),"|",e.jsx("button",{className:`mr-2 ml-2 ${r==="inProgress"?"font-bold underline":""}`,onClick:()=>v("inProgress"),children:"In Progress"}),"|",e.jsx("button",{className:`ml-2 ${r==="completed"?"font-bold underline":""}`,onClick:()=>v("completed"),children:"Completed"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>D("grid"),className:`mr-2 ${p==="grid"?"text-blue-500":"text-gray-500"}`,"aria-label":"Grid View",children:e.jsx(O,{size:18})}),e.jsx("button",{onClick:()=>D("table"),className:`${p==="table"?"text-blue-500":"text-gray-500"}`,"aria-label":"Table View",children:e.jsx(G,{size:18})})]})]}),e.jsx("div",{children:l?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(E,{className:"animate-spin"}),e.jsx("span",{children:"Loading courses..."})]}):p==="grid"?N.length>0?e.jsx("div",{className:"flex flex-wrap justify-start gap-5 lg:gap-6 2xl:gap-12",children:N.map(n=>e.jsx(ge,{course:n,enrolled:n.enrolled,searchTerm:x,isEcomm:t==null?void 0:t.ecommerce},n.Id))}):e.jsxs("p",{className:"text-gray-500",children:["No courses found. Please go to the"," ",e.jsx("a",{href:"#",onClick:A,className:"text-blue-500 hover:underline cursor-pointer",children:"catalog"})," ","to find courses."]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left font-semibold text-gray-700 hidden md:table-cell",children:"Short Description"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left w-64 font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left"})]})}),e.jsx("tbody",{children:N.length>0?N.map(n=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-0 md:py-2 px-0 md:px-4 border-b border-gray-200 w-12 md:w-20",children:e.jsx("img",{src:n.ImageURL||"/GenericCourseIcon.webp",alt:n.Name,className:"w-12 h-8 object-cover rounded"})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:n.Name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 hidden md:table-cell",children:n.ShortDescription}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:n.enrolled&&e.jsx(pe,{courseId:n.Id})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 w-32",children:e.jsx("button",{onClick:()=>P(n.Id),className:"px-3 py-1 text-white text-sm rounded-sm lms-button",children:"Details"})})]},n.Id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No courses found."})})})]})})})]})};function ve(t){return T(t,Date.now())}function Se(t,a,s){const[d,c]=ye(s==null?void 0:s.in,t,a);return+L(d)==+L(c)}function Ce(t,a){return Se(T(t,t),ve(t))}const Fe=()=>{const[t,a]=o.useState([]),[s,d]=o.useState(!1),[c,m]=o.useState(!1),x="https://knowvara.com/api";o.useEffect(()=>{(async()=>{try{const u=sessionStorage.getItem("token");if(!u){j.error("Authentication token is missing. Please log in again.");return}const r=await y.get(`${x}/api/gamification/badge-notifications`,{headers:{Authorization:`Bearer ${u}`}});r.data.notifications.length>0?(a(r.data.notifications),d(!0),console.log("got notifications",r.data.notifications)):console.log("got no notifications")}catch(u){console.error("Error fetching badge notifications:",u),j.error("Failed to fetch badge notifications.")}})()},[x]);const h=async()=>{if(t.length===0){d(!1);return}m(!0);try{const l=sessionStorage.getItem("token");if(!l){j.error("Authentication token is missing. Please log in again."),m(!1);return}const u=t.map(r=>y.put(`${x}/api/gamification/badge-notifications/${r.id}/read`,{},{headers:{Authorization:`Bearer ${l}`}}));await Promise.all(u),a([]),d(!1)}catch(l){console.error("Error marking badge notifications as read:",l),j.error("Failed to mark badge notifications as read.")}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg hidden",children:"I'm right here"}),s&&e.jsx($,{title:"New Badges Earned!",onClose:()=>{c||h()},onConfirm:()=>{c||h()},singleButton:!0,confirmText:"OK",children:c?e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(C,{className:"animate-spin text-2xl text-blue-500"}),e.jsx("span",{className:"ml-2",children:"Processing..."})]}):e.jsx("div",{className:"space-y-4",children:t.map(l=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-[80px] h-[80px] rounded-full flex items-center justify-center",style:{backgroundColor:l.color},children:e.jsx("div",{className:"w-[75px] h-[75px] rounded-full bg-white flex items-center justify-center",children:e.jsx("div",{className:"w-[70px] h-[70px] rounded-full flex items-center justify-center text-white",style:{backgroundColor:l.color},children:ke(l.icon,26,"#ffffff")})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",style:{color:l.color},children:l.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Awarded on:"," ",De(l.notified_at)?new Date(B(l.notified_at)).toLocaleDateString():"Unknown Date"]})]})]},l.id))})})]})},ke=(t,a=20,s="#ffffff")=>({FaStar:e.jsx(V,{size:a,color:s}),FaHeart:e.jsx(W,{size:a,color:s}),FaCheckCircle:e.jsx(C,{size:a,color:s}),FaMedal:e.jsx(K,{size:a,color:s}),FaTrophy:e.jsx(Y,{size:a,color:s}),FaCrown:e.jsx(J,{size:a,color:s}),FaBolt:e.jsx(q,{size:a,color:s}),FaLeaf:e.jsx(Q,{size:a,color:s}),FaRocket:e.jsx(X,{size:a,color:s}),FaShieldAlt:e.jsx(Z,{size:a,color:s}),FaGlobe:e.jsx(z,{size:a,color:s}),FaLightbulb:e.jsx(ee,{size:a,color:s}),FaBook:e.jsx(te,{size:a,color:s}),FaLaptop:e.jsx(se,{size:a,color:s}),FaCamera:e.jsx(ae,{size:a,color:s}),FaMusic:e.jsx(re,{size:a,color:s}),FaCameraRetro:e.jsx(ne,{size:a,color:s}),FaCode:e.jsx(oe,{size:a,color:s}),FaCloud:e.jsx(le,{size:a,color:s}),FaComments:e.jsx(ie,{size:a,color:s}),FaCoffee:e.jsx(ce,{size:a,color:s}),FaDatabase:e.jsx(de,{size:a,color:s}),FaDice:e.jsx(me,{size:a,color:s}),FaGlasses:e.jsx(xe,{size:a,color:s}),FaHeartbeat:e.jsx(ue,{size:a,color:s})})[t]||e.jsx(C,{size:a,color:s}),B=t=>t?t.replace(" ","T"):"",De=t=>{if(!t)return!1;const a=new Date(B(t));return!isNaN(a.getTime())},Le=()=>{const[t,a]=o.useState(null),[s,d]=o.useState(!0),[c,m]=o.useState(""),x=async()=>{const r=sessionStorage.getItem("token");if(!r){m("User is not authenticated."),d(!1);return}try{const i=await y.get("https://knowvara.com/api/api/events/upcoming",{headers:{Authorization:`Bearer ${r}`}});a(i.data)}catch(i){console.error("Error fetching upcoming events:",i),m("Failed to load upcoming events.")}finally{d(!1)}};if(o.useEffect(()=>{x()},[]),s||c||!t)return null;const{registeredEvents:h,instructedEvents:l}=t;if(h.length===0&&l.length===0)return null;const u=({event:r})=>{const i=new Date(r.DateTime),p=Ce(i),b=Ne(i,"MMM d, yyyy h:mm a");return e.jsxs("li",{className:`flex flex-col sm:flex-row justify-between items-start sm:items-center p-2 mb-2 rounded ${p?"bg-green-50 border":"bg-gray-50"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:r.LessonName})," ",e.jsx("p",{className:"text-sm",children:b}),e.jsx("p",{className:"text-sm text-gray-600",children:r.Location}),r.OnlineMeetingLink&&r.OnlineMeetingLink.trim()!==""&&e.jsx("a",{href:r.OnlineMeetingLink,target:"_blank",rel:"noopener noreferrer",className:"mt-1 inline-block text-blue-500 hover:underline text-sm",children:"Join Meeting"})]}),p&&e.jsx("span",{className:"mt-1 sm:mt-0",children:"Today"})]},r.Id)};return e.jsxs("div",{className:"",children:[h.length>0&&e.jsxs("div",{className:"bg-white shadow-md rounded mb-3",children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white font-bold",children:"Upcoming Events"}),e.jsx("ul",{className:"p-2",children:h.map(r=>e.jsx(u,{event:r},r.Id))})]}),l.length>0&&e.jsxs("div",{className:"bg-white shadow-md rounded mb-4",children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white font-bold",children:"Events You Are Leading"}),e.jsx("ul",{className:"p-2",children:l.map(r=>e.jsx(u,{event:r},r.Id))})]})]})},Ie=()=>{const[t,a]=o.useState([]),[s,d]=o.useState(4),[c,m]=o.useState(!0),[x,h]=o.useState(null),l={hidden:{opacity:0,x:50},visible:{opacity:1,x:0},exit:{opacity:0,x:-50}},u=async()=>{try{m(!0);const i=sessionStorage.getItem("token");if(!i)throw new Error("User is not authenticated.");const b=await y.get("https://knowvara.com/api/api/reports/leaderboard",{headers:{Authorization:`Bearer ${i}`}});a(b.data)}catch(i){console.error("Error fetching leaderboard:",i),h("Failed to fetch leaderboard.")}finally{m(!1)}};o.useEffect(()=>{u()},[]);const r=()=>{d(i=>i===4?12:4)};return c?e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx(E,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading leaderboard..."})]}):x?e.jsx("div",{className:"text-red-500 p-4",children:x}):t.length===0?null:e.jsxs(he.div,{className:`bg-white rounded shadow mb-4 relative ${t.length>3?"pb-6":""}`,variants:l,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.5,ease:"easeOut"},children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white font-bold",children:"Leaderboard"}),e.jsx("div",{className:"p-2",children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-4 gap-2 gap-y-3",children:t.slice(0,s).map(i=>e.jsxs("div",{className:"flex flex-col items-center text-center shadow rounded p-1",children:[e.jsx("img",{src:i.imageUrl?`/content/${i.imageUrl}`:"/defaultUserIcon.webp",alt:`${i.firstName} ${i.lastName}`,className:"w-20 h-20 rounded-full object-cover mb-2",onError:p=>{p.currentTarget.onerror=null,p.currentTarget.src="/defaultUserIcon.webp"}}),e.jsxs("p",{className:"font-semibold",children:[i.firstName," ",i.lastName]}),e.jsxs("p",{className:"text-gray-600",children:[i.points," Points"]})]},i.id))})}),t.length>4&&e.jsx("button",{onClick:r,className:"absolute bottom-1 right-4 text-blue-600 hover:underline text-xs",children:s===4?"More...":"Less..."})]})},Pe=()=>{const{user:t}=I(),a=M(),{subscription:s,error:d}=fe(),[c,m]=o.useState(0),[x,h]=o.useState(!1);return o.useEffect(()=>{const l=sessionStorage.getItem("showWelcomeModal")==="true";console.log("Should Show Modal:",l),l&&(h(!0),sessionStorage.removeItem("showWelcomeModal"))},[]),o.useEffect(()=>{if(s&&s.subscription_plan.toLowerCase()==="free"&&s.trial_end){const l=new Date,r=new Date(s.trial_end).getTime()-l.getTime(),i=Math.ceil(r/(1e3*3600*24));i>0?m(i):m(0)}else m(0)},[s]),o.useEffect(()=>{d&&j.error(d)},[d]),e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsxs("div",{className:"flex flex-col items-start w-full md:w-3/4 border-r border-gray-300 p-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(be,{allowLaunch:!0})}),e.jsx("div",{className:"w-full",children:e.jsx(we,{})})]}),e.jsxs("div",{className:"w-full md:w-1/4 p-4 relative",children:[(t==null?void 0:t.Admin)==="y"&&s&&s.subscription_plan.toLowerCase()==="free"&&s.trial_end&&e.jsxs("div",{className:"bg-red-600 text-white text-xs px-4 py-2 rounded-md mb-2 text-center",children:["Your free trial expires in ",c," ",c===1?"day":"days",". Go to"," ",e.jsx("span",{className:"underline cursor-pointer",onClick:()=>a("/admin/settings"),children:"Settings"})," ","to upgrade your plan."]}),(t==null?void 0:t.Id)&&e.jsxs(e.Fragment,{children:[e.jsx(Le,{}),(t==null?void 0:t.gamify)&&e.jsx(Ie,{}),e.jsx(je,{userId:t.Id,gamify:t.gamify,isMe:!0})]}),e.jsx(Fe,{})]}),x&&e.jsxs($,{title:"Welcome to KnowVara",onClose:()=>h(!1),onConfirm:()=>h(!1),singleButton:!0,confirmText:"Get Started",widthClassName:"max-w-2xl",children:[e.jsx("p",{className:"mb-4 text-gray-700 text-md",children:"The custom URL for your account is:"}),e.jsxs("div",{className:"font-semibold mb-4 flex w-full text-center justify-center text-lg text-blue-900",children:["https://",t==null?void 0:t.Subdomain,".","knowvara.com"]}),e.jsx("p",{className:"mb-2 text-gray-700 text-md",children:"You're currently on the Student Home page. While there's no content here yet, adding content is simple and straightforward."}),e.jsxs("p",{className:"mb-4 text-gray-700 text-md",children:["In the top navigation bar, you'll find the"," ",e.jsx("strong",{className:"text-blue-900",children:"Home, Catalog, and Transcript"})," ","buttons, which are accessible to all users. As an admin, you also have access to the"," ",e.jsx("strong",{className:"text-blue-900",children:"Dashboard, Content, People, Reports, and Settings"})," ","buttons."]}),e.jsxs("p",{className:"mb-4 text-gray-700 text-md",children:["We hope you find KnowVara intuitive and easy to use. If you need any assistance or would like a guided tour, simply click"," ",e.jsx("strong",{className:"text-blue-900",children:"Settings"})," and submit a support request. We're here to help!"]})]})]})};export{Pe as default};
