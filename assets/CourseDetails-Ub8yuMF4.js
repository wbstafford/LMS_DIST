import{t as k,c as $,r as l,j as e,e as m}from"./index-BzFnb_De.js";import{C as D}from"./CourseLessons-WbFCqFWT.js";import{P as L}from"./PurchaseCourse-BIoGSjgU.js";import{C as A}from"./CourseStatusBar-D9EOazux.js";const F=()=>{const{courseId:o}=k(),{user:s}=$(),[n,j]=l.useState(null),[d,c]=l.useState(null),[h,x]=l.useState(null),[b,i]=l.useState(!1),[f,p]=l.useState(null),[w,N]=l.useState(!1);if(l.useEffect(()=>{(async()=>{if(!(s!=null&&s.OrgID)||!o)return;const a=sessionStorage.getItem("token");if(!a){console.error("No token found, user is not authenticated.");return}try{const[t,u]=await Promise.all([m.get(`https://knowvara.com/api/api/courses/${s.OrgID}/${o}`,{headers:{Authorization:`Bearer ${a}`}}),m.get(`https://knowvara.com/api/api/courses/enrollment/${s.Id}/${o}`,{headers:{Authorization:`Bearer ${a}`}})]);j(t.data),u.data.enrolled?(x(u.data.enrollment),console.log("Got enrollment ID: "+u.data.enrollment.id),c(!0)):c(!1)}catch(t){console.error("Error fetching course or enrollment:",t),c(null)}})()},[s==null?void 0:s.OrgID,s==null?void 0:s.Id,o]),!n||d===null)return e.jsx("div",{children:"Loading course details..."});const{Name:g,Description:I,ImageURL:v,Price:r,ShortDescription:y}=n,C=v||"/GenericCourseIcon.webp",S=()=>{N(!0),c(!0),p(null),s!=null&&s.Id&&o&&(async()=>{const a=sessionStorage.getItem("token");if(a)try{const t=await m.get(`https://knowvara.com/api/api/courses/enrollment/${s.Id}/${o}`,{headers:{Authorization:`Bearer ${a}`}});t.data.enrolled&&(x(t.data.enrollment),console.log("Updated enrollment ID: "+t.data.enrollment.id))}catch(t){console.error("Error fetching updated enrollment:",t)}})()},P=()=>{p("The Payment could not be processed. Please try again.")};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsx("div",{className:"flex flex-col items-start w-full md:w-1/4 border-r border-gray-300 p-2 shadow md:shadow-xl",children:e.jsxs("div",{className:"p-3",children:[e.jsx("img",{src:C,alt:g,className:"w-full h-auto shadow-lg rounded-lg mb-4"}),e.jsx("div",{className:"mb-2",children:y}),e.jsx("div",{className:"",children:e.jsx(A,{courseId:n.Id})})]})}),e.jsxs("div",{className:"w-full md:w-3/4 p-3 md:p-6",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:g}),e.jsx("div",{className:"mt-2 prose mb-2",dangerouslySetInnerHTML:{__html:I}}),!d&&r!==null&&r!==0&&(s==null?void 0:s.ecommerce)&&e.jsxs("div",{className:"mt-4 p-5 border rounded-lg shadow w-64 items-center text-center",children:[e.jsxs("p",{className:"text-xl",children:["Price: $",r.toFixed(2)]}),e.jsx("button",{onClick:()=>i(!0),className:"py-2 px-4 lms-button text-white rounded-md mt-2",children:"Purchase Now"})]}),e.jsx("div",{className:"py-4",children:e.jsx(D,{courseId:Number(o),enrollmentId:h?h.id:0,hideLaunchButtons:(s==null?void 0:s.ecommerce)&&r!==null&&r>0&&!d,orderLessons:n.orderLessons})})]}),b&&r!==null&&r!==0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-full md:w-1/3 m-4",children:w?e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Congratulations! You have successfully purchased this course."}),e.jsx("button",{onClick:()=>i(!1),className:"py-2 px-4 bg-green-500 text-white rounded-md",children:"Close"})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Purchase Course"}),f&&e.jsx("div",{className:"mb-2 text-red-600",children:f}),e.jsx(L,{courseId:n.Id,orgId:n.OrgID,amount:r,onSuccess:S,onFailure:P}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>i(!1),className:"py-2 px-4 bg-gray-300 text-black rounded-md mr-2",children:"Cancel"})})]})})})]})};export{F as default};
