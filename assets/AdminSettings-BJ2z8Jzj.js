import{c as Ae,d as pe,r,j as e,F as U,al as ve,am as ke,M as R,B as s,e as c,an as Ee,ap as Pe,b6 as Xe,ah as _e,aq as $e,A as X,aj as Fe,f as Ze,ab as es,ac as ss,y as ts,ad as ae,b7 as rs,b8 as os}from"./index-2WPDJfjq.js";const as=()=>{const{user:i}=Ae(),f=pe(),p=i==null?void 0:i.OrgID,[j,v]=r.useState({open:[],closed:[]}),[N,P]=r.useState(!1),[k,E]=r.useState(!1),[l,A]=r.useState(""),[_,h]=r.useState(""),[g,F]=r.useState(!1),[q,L]=r.useState(!1),[D,V]=r.useState(new Set),[B,O]=r.useState({}),[z,u]=r.useState(null),[C,b]=r.useState(!1);r.useEffect(()=>{(async()=>{var d;if(!p){s.error("Organization ID is missing."),f("/admin");return}P(!0);try{const m=sessionStorage.getItem("token");if(!m){s.error("Authentication token is missing. Please log in again."),f("/login");return}const T=await c.get("https://knowvara.com/api/api/support/support-requests",{headers:{Authorization:`Bearer ${m}`}});v(T.data)}catch(m){console.error("Error fetching support requests:",m),c.isAxiosError(m)?console.log(((d=m.response)==null?void 0:d.data.message)||"Failed to fetch support requests."):console.log("An unexpected error occurred while fetching support requests."),s.error(m instanceof Error?m.message:"Failed to fetch support requests.")}finally{P(!1)}})()},[p,f]);const Y=async a=>{var d;if(a.preventDefault(),!l.trim()||!_.trim()){s.error("Subject and description are required.");return}F(!0);try{const m=sessionStorage.getItem("token");if(!m){s.error("Authentication token is missing. Please log in again."),f("/login");return}await c.post("https://knowvara.com/api/api/support/support-requests",{subject:l,description:_},{headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"}}),A(""),h(""),E(!1),L(!0);const T=await c.get("https://knowvara.com/api/api/support/support-requests",{headers:{Authorization:`Bearer ${m}`}});v(T.data)}catch(m){console.error("Error submitting support request:",m),c.isAxiosError(m)?s.error(((d=m.response)==null?void 0:d.data.message)||"Failed to submit support request."):s.error("An unexpected error occurred while submitting support request.")}finally{F(!1)}},H=a=>{V(d=>{const m=new Set(d);return m.has(a)?m.delete(a):m.add(a),m})},y=(a,d)=>{O(m=>({...m,[d]:a.target.value}))},Z=async a=>{var m,T;const d=(m=B[a])==null?void 0:m.trim();if(!d){s.error("Response cannot be empty.");return}try{const M=sessionStorage.getItem("token");if(!M){s.error("Authentication token is missing. Please log in again."),f("/login");return}await c.post(`https://knowvara.com/api/api/support/support-requests/${a}/responses`,{response:d},{headers:{Authorization:`Bearer ${M}`,"Content-Type":"application/json"}}),O(W=>({...W,[a]:""}));const S=await c.get("https://knowvara.com/api/api/support/support-requests",{headers:{Authorization:`Bearer ${M}`}});v(S.data)}catch(M){console.error("Error adding response:",M),c.isAxiosError(M)?s.error(((T=M.response)==null?void 0:T.data.message)||"Failed to add response."):s.error("An unexpected error occurred while adding response.")}},ee=async()=>{var a;if(z!==null){b(!0);try{const d=sessionStorage.getItem("token");if(!d){s.error("Authentication token is missing. Please log in again."),f("/login");return}await c.put(`https://knowvara.com/api/api/support/support-requests/${z}/close`,{},{headers:{Authorization:`Bearer ${d}`}}),s.success("Support request closed successfully.");const m=await c.get("https://knowvara.com/api/api/support/support-requests",{headers:{Authorization:`Bearer ${d}`}});v(m.data)}catch(d){console.error("Error closing support request:",d),c.isAxiosError(d)?s.error(((a=d.response)==null?void 0:a.data.message)||"Failed to close support request."):s.error("An unexpected error occurred while closing support request.")}finally{b(!1),u(null)}}};return e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Get Support from KnowVara"}),e.jsxs("div",{className:"rounded border p-4",children:[e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:()=>E(a=>!a),className:"py-2 px-4 lms-button text-white rounded-md flex items-center",children:"Request Support"})}),k&&e.jsxs("form",{onSubmit:Y,className:"mb-8 border p-4 rounded-md",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Submit a Support Request"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Subject"}),e.jsx("input",{type:"text",value:l,onChange:a=>A(a.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{value:_,onChange:a=>h(a.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",rows:4,required:!0})]}),e.jsx("div",{className:"",children:e.jsxs("button",{type:"submit",className:"py-2 px-4 lms-button text-white rounded-md flex items-center",disabled:g,children:[g?e.jsx(U,{className:"animate-spin mr-2"}):"",g?"Submitting...":"Submit Request"]})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Open Support Requests"}),N?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(U,{className:"animate-spin text-2xl text-blue-500"})}):j.open.length===0?e.jsx("p",{children:"No open support requests."}):j.open.map(a=>e.jsxs("div",{className:"mb-4 border rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 cursor-pointer bg-gray-50",onClick:()=>H(a.id),children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700",children:a.subject}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Submitted by: ",a.submittedByName," on"," ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsx("div",{children:D.has(a.id)?e.jsx(ve,{}):e.jsx(ke,{})})]}),D.has(a.id)&&e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"mb-4",children:a.description}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Responses"}),a.responses.length===0?e.jsx("p",{children:"No responses yet."}):a.responses.map(d=>e.jsxs("div",{className:"mb-2 border-l-4 pl-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsxs("strong",{children:[d.adminName,":"]})," ",d.response]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(d.createdAt).toLocaleString()})]},d.id))]}),e.jsx("div",{className:"mb-4",children:e.jsx("textarea",{value:B[a.id]||"",onChange:d=>y(d,a.id),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",rows:3,placeholder:"Enter your response here..."})}),e.jsxs("div",{className:"flex flex-row mt-2",children:[e.jsx("button",{type:"button",onClick:()=>Z(a.id),className:"py-2 px-4 lms-button text-white rounded-md flex items-center mr-2",children:"Submit Response"}),e.jsx("button",{type:"button",onClick:()=>u(a.id),className:"py-2 px-4 lms-button text-white rounded-md flex items-center",children:"Close Request"})]})]})]},a.id))]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Closed Support Requests"}),N?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(U,{className:"animate-spin text-2xl text-blue-500"})}):j.closed.length===0?e.jsx("p",{children:"No closed support requests."}):j.closed.map(a=>e.jsxs("div",{className:"mb-4 border rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 cursor-pointer bg-gray-50",onClick:()=>H(a.id),children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-md font-semibold text-gray-700",children:a.subject}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Submitted by: ",a.submittedByName," on"," ",new Date(a.createdAt).toLocaleDateString()]})]}),e.jsx("div",{children:D.has(a.id)?e.jsx(ve,{}):e.jsx(ke,{})})]}),D.has(a.id)&&e.jsxs("div",{className:"p-4",children:[e.jsx("p",{className:"mb-4",children:a.description}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Responses"}),a.responses.length===0?e.jsx("p",{children:"No responses yet."}):a.responses.map(d=>e.jsxs("div",{className:"mb-2 border-l-4 pl-2",children:[e.jsxs("p",{className:"text-sm text-gray-700",children:[e.jsxs("strong",{children:[d.adminName,":"]})," ",d.response]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(d.createdAt).toLocaleString()})]},d.id))]})]})]},a.id))]}),q&&e.jsx(R,{title:"Thank You",onClose:()=>L(!1),onConfirm:()=>L(!1),singleButton:!0,confirmText:"Close",widthClassName:"max-w-md",children:e.jsx("p",{children:"Thank you for contacting us. Someone will respond soon."})}),z!==null&&e.jsx(R,{title:"Confirm Close Request",onClose:()=>u(null),onConfirm:ee,confirmText:C?"Closing...":"Confirm Close",isConfirmDisabled:C,widthClassName:"max-w-md",children:e.jsx("p",{children:"Are you sure you want to close this support request?"})})]})]})},ns=({storefronts:i,onDelete:f})=>{const p=pe(),j="https://lms.knowvara.com",v=g=>{p(`/admin/storefronts/edit/${g.id}`)},N=()=>{p("/admin/storefronts/create")},[P,k]=Ee.useState(!1),[E,l]=Ee.useState(null),A=g=>{l(g),k(!0)},_=()=>{k(!1),l(null)},h=()=>{E&&f(E.id),_()};return e.jsxs("div",{className:"w-full md:w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"Storefronts"}),e.jsxs("button",{type:"button",onClick:N,className:"flex items-center py-2 px-4 lms-button text-white","aria-label":"Create Storefront",children:[e.jsx(Pe,{className:"mr-1"}),"Create Storefront"]})]}),i.length===0?e.jsx("p",{children:"No storefronts available."}):e.jsx("div",{className:"overflow-x-auto mb-6",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border",children:"Title"}),e.jsx("th",{className:"py-2 px-4 border",children:"Store Code"}),e.jsx("th",{className:"py-2 px-4 border",children:"Store Link"}),e.jsx("th",{className:"py-2 px-4 border w-32",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(g=>{const F=`${j}/store/${g.storecode}`;return e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"py-2 px-4 border",children:g.title}),e.jsx("td",{className:"py-2 px-4 border",children:g.storecode}),e.jsx("td",{className:"py-2 px-4 border",children:e.jsxs("a",{href:F,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center justify-center",children:[F,e.jsx(Xe,{className:"ml-1 text-sm"})]})}),e.jsxs("td",{className:"py-2 px-4 border",children:[e.jsx("button",{type:"button",onClick:()=>v(g),className:"mr-2 lms-icon","aria-label":"Edit Storefront",title:"Edit Storefront",children:e.jsx(_e,{})}),e.jsx("button",{type:"button",onClick:()=>A(g),className:"lms-icon","aria-label":"Delete Storefront",title:"Delete Storefront",children:e.jsx($e,{})})]})]},g.id)})})]})}),e.jsx(X,{children:P&&e.jsx(R,{title:"Confirm Delete",onClose:_,onConfirm:h,children:e.jsxs("p",{children:['Are you sure you want to delete the storefront "',E==null?void 0:E.title,'"?']})})})]})},is=({coupon:i,onClose:f,onSave:p})=>{const[j,v]=r.useState(i?i.code:""),[N,P]=r.useState(i?i.percent_off:10),[k,E]=r.useState(i&&i.expiration_date?i.expiration_date:""),[l,A]=r.useState(""),_=()=>{if(A(""),!j.trim()){A("Coupon code is required.");return}if(N<1||N>100){A("Percent off must be between 1 and 100.");return}if(k){const h=new Date,g=new Date(k);if(g.setHours(23,59,59,999),g<h){A("Expiration date cannot be in the past.");return}}p({code:j.trim(),percent_off:N,expiration_date:k||void 0})};return e.jsxs(R,{title:i?"Edit Coupon Code":"Create Coupon Code",onClose:f,onConfirm:_,confirmText:i?"Update Coupon":"Create Coupon",singleButton:!1,widthClassName:"max-w-md",isConfirmDisabled:!1,children:[l&&e.jsxs("div",{className:"flex items-center mb-4 text-red-500",children:[e.jsx(Fe,{className:"mr-2"}),e.jsx("span",{children:l})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1 font-semibold",children:"Coupon Code"}),e.jsx("input",{type:"text",value:j,onChange:h=>v(h.target.value),className:"mb-4 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"ENTERCODE",required:!0}),e.jsx("label",{className:"mb-1 font-semibold",children:"Percent Off (%)"}),e.jsx("input",{type:"number",value:N,onChange:h=>P(Number(h.target.value)),className:"mb-4 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"10",min:1,max:100,required:!0}),e.jsx("label",{className:"mb-1 font-semibold",children:"Expiration Date (Optional)"}),e.jsx("input",{type:"date",value:k,onChange:h=>E(h.target.value),className:"mb-4 p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})},ls=async i=>(await c.get("https://knowvara.com/api/api/orgs/coupons",{headers:{Authorization:`Bearer ${i}`}})).data,cs=async(i,f)=>(await c.post("https://knowvara.com/api/api/orgs/coupons",f,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).data,ds=async(i,f,p)=>(await c.put(`https://knowvara.com/api/api/orgs/coupons/${f}`,p,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"}})).data,ms=async(i,f)=>{await c.delete(`https://knowvara.com/api/api/orgs/coupons/${f}`,{headers:{Authorization:`Bearer ${i}`}})},us=()=>{const[i,f]=r.useState([]),[p,j]=r.useState(!1),[v,N]=r.useState(""),[P,k]=r.useState(!1),[E,l]=r.useState(null),[A,_]=r.useState(!1),[h,g]=r.useState(null),F=r.useCallback(async()=>{var u,C;j(!0),N("");try{const b=sessionStorage.getItem("token");if(!b){s.error("Authentication token is missing. Please log in again.");return}const Y=await ls(b);f(Y)}catch(b){console.error("Error fetching coupons:",b),c.isAxiosError(b)?(N(((u=b.response)==null?void 0:u.data.message)||"Failed to fetch coupons."),s.error(((C=b.response)==null?void 0:C.data.message)||"Failed to fetch coupons.")):(N("An unexpected error occurred while fetching coupons."),s.error("Failed to fetch coupons."))}finally{j(!1)}},[]);r.useEffect(()=>{F()},[F]);const q=()=>{l(null),k(!0)},L=u=>{l(u),k(!0)},D=()=>{l(null),k(!1)},V=async u=>{var C;try{const b=sessionStorage.getItem("token");if(!b){s.error("Authentication token is missing. Please log in again.");return}E?(await ds(b,E.Id,u),s.success("Coupon updated successfully.")):(await cs(b,u),s.success("Coupon created successfully.")),F(),D()}catch(b){console.error("Error saving coupon:",b),c.isAxiosError(b)?s.error(((C=b.response)==null?void 0:C.data.message)||"Failed to save coupon code."):s.error("An unexpected error occurred.")}},B=u=>{g(u),_(!0)},O=()=>{_(!1),g(null)},z=async()=>{var u;if(h)try{const C=sessionStorage.getItem("token");if(!C){s.error("Authentication token is missing. Please log in again.");return}await ms(C,h.Id),s.success("Coupon deleted successfully."),F(),O()}catch(C){console.error("Error deleting coupon:",C),c.isAxiosError(C)?s.error(((u=C.response)==null?void 0:u.data.message)||"Failed to delete coupon code."):s.error("An unexpected error occurred.")}};return e.jsxs("div",{className:"w-full md:w-full",children:[e.jsxs("div",{className:"flex w-full justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Coupon Codes"}),e.jsxs("button",{type:"button",onClick:q,className:"flex items-center py-2 px-4 lms-button text-white mb-4",children:[e.jsx(Pe,{className:"mr-1"}),"Create Coupon Code"]})]}),e.jsx("div",{className:"mb-6",children:p?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(U,{className:"animate-spin text-2xl text-blue-500"})}):v?e.jsx("div",{className:"text-red-500 text-center",children:v}):i.length===0?e.jsx("p",{children:"No coupon codes found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border",children:"Code"}),e.jsx("th",{className:"py-2 px-4 border",children:"Percent Off (%)"}),e.jsx("th",{className:"py-2 px-4 border",children:"Expiration Date"}),e.jsx("th",{className:"py-2 px-4 border",children:"Usage Count"}),e.jsx("th",{className:"py-2 px-4 border w-32",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(u=>e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"py-2 px-4 border",children:u.code}),e.jsx("td",{className:"py-2 px-4 border",children:u.percent_off}),e.jsx("td",{className:"py-2 px-4 border",children:u.expiration_date?new Date(u.expiration_date).toLocaleDateString():"N/A"}),e.jsx("td",{className:"py-2 px-4 border",children:u.usage_count}),e.jsxs("td",{className:"py-2 px-4 border",children:[e.jsx("button",{type:"button",onClick:()=>L(u),className:"mr-2 lms-icon",title:"Edit Coupon",children:e.jsx(_e,{})}),e.jsx("button",{type:"button",onClick:()=>B(u),className:"lms-icon",title:"Delete Coupon",children:e.jsx($e,{})})]})]},u.Id))})]})})}),e.jsx(X,{children:P&&e.jsx(is,{coupon:E,onClose:D,onSave:V})}),e.jsx(X,{children:A&&e.jsx(R,{title:"Confirm Delete",onClose:O,onConfirm:z,children:e.jsxs("p",{children:['Are you sure you want to delete the coupon code "',h==null?void 0:h.code,'"?']})})})]})},xs=()=>{const{user:i,updateUser:f}=Ae(),p=pe(),j=Ze(),v=es(),N=ss(),P=i==null?void 0:i.OrgID,[k,E]=r.useState([]),[l,A]=r.useState({id:0,Name:"",companyLogoUrl:"",ecommerce:!1,gamify:!0,selfRegister:!1,contact_email:"",contact_phone:"",theme_color1:"#FFFFFF",theme_color2:"#000000",timezone:"UTC",stripe_account_id:"",stripe_customer_id:"",stripe_subscription_id:"",subscription_plan:"",subscription_status:"",trial_end:"",created_at:"",updated_at:"",subdomain:"",master_from_email:"",master_from_name:""}),[_,h]=r.useState(!1),[g,F]=r.useState(!1),[q,L]=r.useState(""),[D,V]=r.useState(""),[B,O]=r.useState(!1),[z,u]=r.useState(!1),[C,b]=r.useState(""),[Y,H]=r.useState("success"),[y,Z]=r.useState(null),[ee,a]=r.useState([]),[d,m]=r.useState(!1),[T,M]=r.useState(!1),[S,W]=r.useState(null),[se,G]=r.useState(!1),[Ie,xe]=r.useState(!1),[he,K]=r.useState(!1),[De,Me]=r.useState([]),[Ue,Re]=r.useState(!0),[te,fe]=r.useState(""),[Le,ge]=r.useState(!1),[ne,ie]=r.useState(""),[re,le]=r.useState((i==null?void 0:i.Email)||""),[oe,ce]=r.useState(""),[J,de]=r.useState(!1),be=async()=>{try{const t=await rs();E(t)}catch(t){console.error("Error fetching storefronts:",t),s.error("Failed to load storefronts.")}};r.useEffect(()=>{be()},[]);const Te=async t=>{try{await os(t),s.success("Storefront deleted successfully."),be()}catch(o){console.error("Error deleting storefront:",o),s.error("Failed to delete storefront.")}};r.useEffect(()=>{(async()=>{var o;try{const n=sessionStorage.getItem("token");if(!n){s.error("Authentication token is missing. Please log in again."),p("/login");return}const w=await c.get("https://knowvara.com/api/api/orgs/plans",{headers:{Authorization:`Bearer ${n}`}});Me(w.data)}catch(n){console.error("Error fetching plans:",n),c.isAxiosError(n)?fe(((o=n.response)==null?void 0:o.data.message)||"Failed to fetch subscription plans."):fe("An unexpected error occurred while fetching plans."),s.error(te||"Failed to load subscription plans.")}finally{Re(!1)}})()},[p,te]);const Oe=[{id:"enterprise",name:"Enterprise",price:"Contact Us",description:"Custom solutions for your organization.",users:"Unlimited users",storage:"Unlimited Courses"}],ze=[...De.map(t=>({id:t.id.toString(),name:t.name,price:`$${Number(t.price).toFixed(2)}/month`,description:t.description,users:`Up to ${t.users_limit} users`,storage:t.storage_limit,priceId:t.price_id})),...Oe];r.useEffect(()=>{(async()=>{var o;if(!P){p("/admin");return}h(!0),L("");try{const n=sessionStorage.getItem("token");if(!n){s.error("Authentication token is missing. Please log in again."),p("/login");return}const w=await c.get("https://knowvara.com/api/api/orgs/org",{headers:{Authorization:`Bearer ${n}`}});A(w.data),m(!0);const x=await c.get("https://knowvara.com/api/api/orgs/subscription",{headers:{Authorization:`Bearer ${n}`}});Z(x.data),m(!1);const $=await c.get("https://knowvara.com/api/api/orgs/payment-history",{headers:{Authorization:`Bearer ${n}`}});$.data&&Array.isArray($.data.payments)?a($.data.payments):(a([]),console.error("Unexpected payment history response structure:",$.data),s.error("Failed to load payment history."))}catch(n){console.error(n),c.isAxiosError(n)?s.error(((o=n.response)==null?void 0:o.data.message)||"Error fetching organization or subscription data."):s.error("An unexpected error occurred.")}finally{h(!1),m(!1)}})()},[P,p]),r.useEffect(()=>{O(!!l.stripe_account_id)},[l.stripe_account_id]),r.useEffect(()=>{const t=new URLSearchParams(j.search),o=t.get("connected"),n=t.get("error");o==="true"&&(console.log("Stripe connected successfully."),b("Your Stripe account has been connected successfully! You are ready to accept payments."),H("success"),u(!0)),n&&(console.log("Stripe connection error."),b(`We were unable to connect your Stripe account. The error received was: ${n}. Please try again or contact Technical Support.`),H("error"),u(!0))},[j.search]);const qe=async()=>{var t;try{const o=sessionStorage.getItem("token");if(!o){s.error("Authentication token is missing. Please log in again."),p("/login");return}const n=await c.get("https://knowvara.com/api/api/orgs/stripe/connect",{headers:{Authorization:`Bearer ${o}`}});window.location.href=n.data.url}catch(o){c.isAxiosError(o)?s.error(((t=o.response)==null?void 0:t.data.message)||"Error initiating Stripe Connect."):s.error("An unexpected error occurred.")}},I=t=>{const o=t.target,{name:n,type:w}=o;let x="";w==="checkbox"&&o instanceof HTMLInputElement?x=o.checked:(o instanceof HTMLInputElement||o instanceof HTMLSelectElement)&&(x=o.value),A($=>({...$,[n]:x}))},Be=async t=>{var o;t.preventDefault(),h(!0),L(""),V("");try{const n=sessionStorage.getItem("token");if(!n){s.error("Authentication token is missing. Please log in again."),p("/login");return}await c.put("https://knowvara.com/api/api/orgs/org",l,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}}),i&&f({ecommerce:l.ecommerce,gamify:l.gamify,theme_color1:l.theme_color1,theme_color2:l.theme_color2}),s.success("Organization settings updated successfully."),console.log("Called toast success")}catch(n){console.error(n),c.isAxiosError(n)?s.error(((o=n.response)==null?void 0:o.data.message)||"Error updating organization settings."):s.error("An unexpected error occurred.")}finally{h(!1)}},Ye=async t=>{var w;const o=t.target.files&&t.target.files[0];if(!o){s.error("No file selected.");return}const n=new FormData;n.append("logo",o),F(!0);try{const x=sessionStorage.getItem("token");if(!x){s.error("Authentication token is missing. Please log in again."),p("/login");return}const $=await c.post("https://knowvara.com/api/api/orgs/upload-logo",n,{headers:{Authorization:`Bearer ${x}`,"Content-Type":"multipart/form-data"}});A(me=>({...me,companyLogoUrl:$.data.companyLogoUrl})),i&&f({companyLogoUrl:$.data.companyLogoUrl}),s.success("Company logo uploaded successfully.")}catch(x){c.isAxiosError(x)?s.error(((w=x.response)==null?void 0:w.data.message)||"Error uploading company logo."):s.error("An unexpected error occurred.")}finally{F(!1),t.target.value=""}},ye=()=>{u(!1),b(""),H("success"),p(j.pathname,{replace:!0})},He=()=>{W(null),M(!0)},Q=()=>{W(null),M(!1)},Ge=()=>{xe(!0)},je=()=>{xe(!1)},Ne=()=>{ge(!0),ie(""),le((i==null?void 0:i.Email)||""),ce(""),de(!1)},Ce=()=>{ge(!1),ie(""),le((i==null?void 0:i.Email)||""),ce(""),de(!1)},Ke=async()=>{var n,w;if(!ne.trim()){s.error("Please enter a message.");return}if(!re.trim()){s.error("Please enter your contact email.");return}if(!/\S+@\S+\.\S+/.test(re)){s.error("Please enter a valid email address.");return}if(oe.trim()&&!/^[+\d]?(?:[\d-.\s()]*)$/.test(oe)){s.error("Please enter a valid phone number.");return}const o=sessionStorage.getItem("token");if(!o){s.error("Authentication token is missing. Please log in again."),p("/login");return}try{h(!0),await c.post("https://knowvara.com/api/api/orgs/contactEnterprise",{orgId:P,message:ne,contactEmail:re,contactPhone:oe},{headers:{Authorization:`Bearer ${o}`}}),de(!0)}catch(x){if(console.error(x),c.isAxiosError(x)){const $=x;(w=(n=$.response)==null?void 0:n.data)!=null&&w.error?s.error($.response.data.error):s.error("Failed to send inquiry.")}else s.error("Failed to send inquiry.")}finally{h(!1)}},Ve=()=>{var o;console.log("Subscription Plan:",l.subscription_plan),console.log("Stripe Subscription ID:",l.stripe_subscription_id);const t=((o=l.subscription_plan)==null?void 0:o.toLowerCase())||"";return!l.stripe_subscription_id&&(t==="free"||t==="free trial")},We=async()=>{var t,o;if(!S){s.error("Please select a plan.");return}G(!0);try{const n=sessionStorage.getItem("token");if(!n){s.error("Authentication token is missing. Please log in again."),p("/login");return}if(S.id==="enterprise"){Ne(),Q();return}if(S.id==="free"){try{(await c.post("https://knowvara.com/api/api/orgs/selectFreeTrial",{orgId:P},{headers:{Authorization:`Bearer ${n}`}})).status===200&&(s.success("Free Trial selected successfully!"),f({subscription_plan:"free"}),p("/admin"),Q())}catch(x){console.error(x),c.isAxiosError(x)?s.error(((t=x.response)==null?void 0:t.data.message)||"Failed to select Free Trial."):s.error("Failed to select Free Trial.")}finally{G(!1)}return}const w=await c.post("https://knowvara.com/api/api/orgs/update-subscription",{orgId:P,priceId:S.priceId},{headers:{Authorization:`Bearer ${n}`}});if(w.status===200){const{clientSecret:x,message:$}=w.data;if(s.success($||"Subscription updated successfully!"),x){if(!v||!N){s.error("Stripe has not loaded yet. Please try again."),G(!1);return}const Se=N.getElement(ae);if(!Se){s.error("Payment information is incomplete."),G(!1);return}const{error:ue,paymentIntent:we}=await v.confirmCardPayment(x,{payment_method:{card:Se,billing_details:{email:i==null?void 0:i.Email}}});if(ue){console.error("[confirmCardPayment error]",ue),s.error(ue.message||"Payment confirmation failed."),G(!1);return}we&&we.status==="succeeded"?s.success("Payment confirmed successfully!"):s.error("Payment confirmation incomplete. Please check your payment method.")}const me=await c.get("https://knowvara.com/api/api/orgs/org",{headers:{Authorization:`Bearer ${n}`}});A(me.data);const Qe=await c.get("https://knowvara.com/api/api/orgs/subscription",{headers:{Authorization:`Bearer ${n}`}});Z(Qe.data),Q()}}catch(n){console.error(n),c.isAxiosError(n)?s.error(((o=n.response)==null?void 0:o.data.message)||"Error changing subscription plan."):s.error("An unexpected error occurred.")}finally{G(!1)}},Je=async()=>{var t;if(!v||!N){s.error("Stripe has not loaded yet. Please try again.");return}K(!0);try{const o=N.getElement(ae);if(!o){s.error("Payment information is incomplete."),K(!1);return}const{error:n,paymentMethod:w}=await v.createPaymentMethod({type:"card",card:o,billing_details:{email:i==null?void 0:i.Email}});if(n){console.error("[createPaymentMethod error]",n),s.error(n.message||"Payment method creation failed."),K(!1);return}if(!w){s.error("Payment method creation failed."),K(!1);return}const x=sessionStorage.getItem("token");if(!x){s.error("Authentication token is missing. Please log in again."),p("/login"),K(!1);return}(await c.post("https://knowvara.com/api/api/orgs/update-payment-method",{orgId:P,paymentMethodId:w.id},{headers:{Authorization:`Bearer ${x}`}})).status===200&&(s.success("Payment information updated successfully!"),je())}catch(o){console.error(o),c.isAxiosError(o)?s.error(((t=o.response)==null?void 0:t.data.message)||"Error updating payment information."):s.error("An unexpected error occurred.")}finally{K(!1)}};return _&&!l.Name?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(U,{className:"animate-spin text-4xl text-blue-500"})}):e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsx("div",{className:"flex flex-col items-start w-full md:w-3/5 border-r border-gray-300 p-4",children:e.jsxs("form",{onSubmit:Be,className:"w-full",id:"org-settings-form",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-600",children:"Edit Organization Settings"}),D&&e.jsx("div",{className:"mb-4 text-green-500",children:D}),q&&e.jsx("div",{className:"mb-4 text-red-500",children:q}),e.jsxs("div",{className:"mb-6 rounded-lg border p-4",children:[e.jsxs("div",{className:"flex flex-row w-full",children:[e.jsxs("div",{className:"flex flex-col w-1/5 items-center mr-6",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Company Logo"}),e.jsx("img",{src:l.companyLogoUrl?"/content"+l.companyLogoUrl:"/defaultOrgLogo.png",alt:"Company Logo",className:"w-48 h-24 object-contain mb-4"}),e.jsxs("div",{className:"w-full flex justify-center",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:Ye,className:"hidden",id:"logo-upload"}),e.jsx("label",{htmlFor:"logo-upload",className:"py-1 px-4 lms-button text-xs cursor-pointer flex items-center justify-center",children:g?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"animate-spin mr-2"})," Uploading..."]}):"Select Logo"})]})]}),e.jsxs("div",{className:"w-4/5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Organization Name"}),e.jsx("input",{type:"text",name:"Name",value:l.Name,onChange:I,required:!0,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300"})]}),e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Subdomain"}),e.jsx("input",{type:"text",name:"subdomain",value:l.subdomain||"",onChange:I,className:"w-1/2 px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300 mr-1",placeholder:"yourcompany"}),e.jsx("span",{className:"",children:".knowvara.com"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Contact Email"}),e.jsx("input",{type:"email",name:"contact_email",value:l.contact_email||"",onChange:I,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",placeholder:"support@example.com"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Contact Phone"}),e.jsx("input",{type:"text",name:"contact_phone",value:l.contact_phone||"",onChange:I,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",placeholder:"+1234567890"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"System Emails From (Email Address)"}),e.jsx("input",{type:"email",name:"master_from_email",value:l.master_from_email||"",onChange:I,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",placeholder:"noreply@yourcompany.com"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"System Emails From (Name)"}),e.jsx("input",{type:"text",name:"master_from_name",value:l.master_from_name||"",onChange:I,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",placeholder:"Learning Management System"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Theme Color 1"}),e.jsx("input",{type:"color",name:"theme_color1",value:l.theme_color1,onChange:I,className:"w-full h-10 p-0 border-0"})]}),e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Theme Color 2"}),e.jsx("input",{type:"color",name:"theme_color2",value:l.theme_color2,onChange:I,className:"w-full h-10 p-0 border-0"})]})]})]})]}),e.jsxs("div",{className:"flex flex-col space-y-4 mb-6",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"selfRegister",checked:l.selfRegister,onChange:I,className:"mr-2",id:"selfRegister"}),e.jsx("label",{htmlFor:"selfRegister",className:"text-gray-700 font-semibold",children:"Allow Users to Self Register"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"ecommerce",checked:l.ecommerce,onChange:I,className:"mr-2",id:"ecommerce"}),e.jsx("label",{htmlFor:"ecommerce",className:"text-gray-700 font-semibold",children:"Enable E-commerce"})]}),l.ecommerce&&e.jsxs("div",{className:"ml-2 mt-2 border rounded p-4",children:[B?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-green-600 text-lg mb-2",children:"Your Stripe account is connected."}),e.jsx("p",{children:"You can now assign prices to courses and bundles. You can also create external storefronts and coupon codes below."})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"mb-2",children:"To enable the collection of payments, you must link your Stripe account below."}),e.jsx("button",{type:"button",onClick:qe,className:"py-2 px-4 bg-blue-500 text-white rounded-md",children:"Connect Stripe Account"})]}),e.jsx("div",{className:"mt-4 mb-4",children:e.jsx(ns,{storefronts:k,onDelete:Te})}),e.jsx("div",{className:"w-full md:w-full",children:e.jsx(us,{})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"gamify",checked:l.gamify,onChange:I,className:"mr-2",id:"gamify"}),e.jsx("label",{htmlFor:"gamify",className:"text-gray-700 font-semibold",children:"Enable Gamification"})]}),l.gamify&&e.jsx("div",{className:"ml-2 mt-2 border rounded p-4",children:e.jsx("button",{type:"button",onClick:()=>p("/admin/gamification"),className:"py-2 px-4 lms-button text-white rounded-md",children:"Manage Gamification"})})]})]})]})}),e.jsxs("div",{className:"w-full md:w-2/5 p-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:"Subscription Details"}),e.jsxs("div",{className:"border p-4 rounded-md mb-6",children:[d?e.jsx("div",{className:"flex justify-center items-center",children:e.jsx(U,{className:"animate-spin text-2xl text-blue-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-lg mt-0 pt-0",children:[e.jsx("strong",{children:"Current Plan:"})," ",(y==null?void 0:y.subscription_plan)||"No Active Subscription"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Next Payment Date:"})," ",y!=null&&y.next_payment_date?new Date(y.next_payment_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"User Accounts:"})," ",y==null?void 0:y.number_of_users," ","used of"," ",(()=>{var o;const t=(o=y==null?void 0:y.subscription_plan)==null?void 0:o.toLowerCase();return t==="free"||t==="basic"?"100":t==="plus"?"250":t==="premium"?"1000":"N/A"})()," ","available."]}),(y==null?void 0:y.trial_end)&&e.jsxs("p",{children:[e.jsx("strong",{children:"Free Trial Expires On:"})," ",new Date(y.trial_end).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),e.jsx("button",{onClick:He,className:"mt-4 py-2 px-4 bg-green-500 text-white rounded mr-2 mb-4",children:"Change Plan"}),l.subscription_plan&&l.subscription_plan.toLowerCase()!=="free"&&e.jsx("button",{onClick:Ge,className:"py-2 px-4 lms-button text-white rounded-md",children:"Update Payment Info"})]}),e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Payment History"}),e.jsx("div",{className:"border p-2 rounded-md mb-2",children:ee.length===0?e.jsx("p",{children:"No payments found."}):e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1",children:"Date"}),e.jsx("th",{className:"py-1",children:"Amount"}),e.jsx("th",{className:"py-1",children:"Status"})]})}),e.jsx("tbody",{children:ee.map(t=>e.jsxs("tr",{className:"text-center",children:[e.jsx("td",{className:"py-1",children:new Date(t.created).toLocaleDateString()}),e.jsxs("td",{className:"py-1",children:["$",t.amount.toFixed(2)," ",t.currency.toUpperCase()]}),e.jsx("td",{className:"py-1 capitalize",children:t.status})]},t.id))})]})})]}),e.jsx("div",{className:"w-full",children:e.jsx(as,{})})]}),e.jsx(X,{children:z&&e.jsxs(R,{title:Y==="success"?"Success":"Stripe Connection Error",onClose:ye,onConfirm:ye,singleButton:!0,confirmText:"OK",widthClassName:"max-w-md",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[Y==="success"?e.jsx(ts,{className:"text-green-500 text-2xl mr-2"}):e.jsx(Fe,{className:"text-red-500 text-2xl mr-2"}),e.jsx("h2",{className:"text-xl font-semibold",children:"Notification"})]}),e.jsx("p",{className:"mb-6",children:C})]})}),e.jsx(X,{children:T&&e.jsxs(R,{title:"Change Your KnowVara Subscription",onClose:Q,onConfirm:We,confirmText:se?"Changing...":"Confirm Change",isConfirmDisabled:!S||se,widthClassName:"max-w-5xl",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 overflow-y-auto max-h-96",children:Ue?e.jsx("div",{className:"flex justify-center items-center col-span-4",children:e.jsx(U,{className:"animate-spin text-2xl text-blue-500"})}):te?e.jsx("div",{className:"col-span-4 text-red-500 text-center",children:te}):ze.map(t=>{const o=t.name===l.subscription_plan;return e.jsxs("div",{className:`border rounded-lg p-4 flex flex-col ${o?"border-green-500 bg-green-50 cursor-default":(S==null?void 0:S.id)===t.id?"border-blue-500 shadow-lg cursor-pointer":"border-gray-300 cursor-pointer"}`,onClick:o?void 0:()=>W(t),children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:t.name}),e.jsx("p",{className:"text-lg mb-4",children:t.price}),e.jsxs("ul",{className:"list-disc list-inside mb-3",children:[e.jsx("li",{className:"text-sm mb-3 font-semibold",children:t.users}),e.jsx("li",{className:"text-sm mb-3",children:t.storage}),e.jsx("li",{className:"text-sm mb-3",children:"Custom Branding"})]}),t.id!=="enterprise"?e.jsx("button",{className:`mt-auto py-2 px-4 rounded-md text-white ${o?"bg-gray-400 cursor-not-allowed":(S==null?void 0:S.id)===t.id?"bg-green-500 hover:bg-green-600":"lms-button"}`,disabled:o||se,children:o?"Current Plan":(S==null?void 0:S.id)===t.id?"Selected":"Select"}):e.jsx("button",{onClick:()=>{Ne(),Q()},className:"mt-auto py-2 px-4 text-white rounded-md lms-button",disabled:se,children:"Contact Us"})]},t.id)})}),e.jsx("p",{className:"italic text-xs mt-2 ml-2",children:"Note: If you upgrade your subscription plan, a prorated amount will be calculated and charged for the remaining period of your current subscription."}),S&&Ve()&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-4",children:"Enter Payment Details"}),e.jsx("div",{className:"p-4 border rounded-md",children:e.jsx(ae,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"},padding:"10px 12px",fontFamily:"inherit"},invalid:{color:"#9e2146"}}},className:"mb-4 p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})})]})]})}),Ie&&e.jsx(R,{title:"Update Payment Information",onClose:je,onConfirm:Je,confirmText:he?"Updating...":"Update Payment",isConfirmDisabled:he,widthClassName:"max-w-2xl",children:e.jsx("div",{className:"p-4 border rounded-md",children:e.jsx(ae,{options:{style:{base:{fontSize:"16px",color:"#424770","::placeholder":{color:"#aab7c4"},padding:"10px 12px",fontFamily:"inherit"},invalid:{color:"#9e2146"}}},className:"mb-4 p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})})}),Le&&e.jsx(R,{title:J?"Thank You":"Contact Us for Enterprise Plan",onClose:Ce,onConfirm:J?Ce:Ke,singleButton:J,confirmText:J?"Close":"Submit",widthClassName:"max-w-md",children:J?e.jsx("p",{children:"Thank you for your inquiry. Someone will contact you right away."}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{children:"Need more from your LMS than the standard plans provide? No Problem! Tell us a little bit about your requirements in the form below, and someone will contact you right away."}),e.jsxs("label",{className:"mt-4 mb-1 text-sm font-medium text-gray-700",children:["Contact Email ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",value:re,onChange:t=>le(t.target.value),className:"mb-4 p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"you@example.com",required:!0}),e.jsx("label",{className:"mb-1 text-sm font-medium text-gray-700",children:"Contact Phone Number (Optional)"}),e.jsx("input",{type:"tel",value:oe,onChange:t=>ce(t.target.value),className:"mb-4 p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"123-456-7890"}),e.jsxs("label",{className:"mb-1 text-sm font-medium text-gray-700",children:["Message ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:ne,onChange:t=>ie(t.target.value),className:"mt-4 p-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Your message here...",rows:4,required:!0})]})}),e.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white p-4 flex justify-end space-x-4 items-center border-t",children:e.jsx("button",{type:"submit",form:"org-settings-form",className:"py-2 px-4 lms-button text-white flex items-center",disabled:_,children:_?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"animate-spin mr-2"})," Saving..."]}):"Save Changes"})})]})};export{xs as default};
