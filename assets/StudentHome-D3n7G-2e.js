import{c as L,r as l,d as M,w as U,j as e,x as _,y as G,F as O,f as y,M as E,z as C,B as j,C as W,D as V,E as K,G as Y,H as J,I as q,J as Q,K as X,L as Z,N as z,O as ee,P as te,Q as se,R as ae,S as re,T as ne,U as oe,V as le,W as ie,X as ce,Y as de,Z as me,$ as xe,a0 as ue}from"./index-B2UKM2Im.js";import{u as he}from"./useSubscription-3G8-xUl1.js";import{C as fe}from"./CourseCard-DH9Odnat.js";import{C as ge}from"./CourseStatusBar-Diq6B_dB.js";import{L as pe,U as je}from"./UserDetails-BIfHD9xE.js";import{c as B,n as be,s as I,f as ye}from"./format-Dt71a7ij.js";const Ne=()=>{const{user:t}=L(),[a,s]=l.useState([]),[c]=l.useState("y"),[i,m]=l.useState("DueDate"),[x,u]=l.useState(""),[o,d]=l.useState(!1),[n,h]=l.useState(localStorage.getItem("courseFilter")||"all"),[p,N]=l.useState(localStorage.getItem("viewModeHome")||"grid"),v=M(),w=l.useMemo(()=>U(r=>{u(r)},300),[]);l.useEffect(()=>()=>{w.cancel()},[w]),l.useEffect(()=>{(async()=>{if(!(t!=null&&t.OrgID)||!(t!=null&&t.Id))return;const F=sessionStorage.getItem("token");if(!F){console.error("No token found, user is not authenticated.");return}d(!0);try{const f=await y.post(`https://knowvara.com/api/api/courses/catalog/${t.OrgID}`,{userId:t.Id,enrolled:c,sortBy:i},{headers:{Authorization:`Bearer ${F}`}}),g=Array.isArray(f.data)?f.data:[];s(g)}catch(f){console.error("Error fetching courses:",f)}finally{d(!1)}})()},[t==null?void 0:t.OrgID,t==null?void 0:t.Id,c,i]);const D=r=>r?new Date(r).getTime():1/0,b=l.useMemo(()=>{let r=a;if(x.trim()||n!=="all"){const f=x.trim().toLowerCase();r=a.filter(g=>{const P=g.Name.toLowerCase().includes(f),R=g.ShortDescription.toLowerCase().includes(f),H=n==="completed"?["completed","passed"].includes(g.completionStatus):n==="inProgress"?g.completionStatus!=="completed"&&g.completionStatus!=="passed":!0;return(P||R)&&H})}return[...r].sort((f,g)=>i==="DueDate"?D(f.dueDate)-D(g.dueDate):i==="Name"?f.Name.localeCompare(g.Name):i==="Likes"?(g.Likes||0)-(f.Likes||0):0)},[a,x,n,i]),A=()=>{v("/student/catalog")},S=r=>{h(r),localStorage.setItem("courseFilter",r)},k=r=>{N(r),localStorage.setItem("viewModeHome",r)},$=r=>{v(`/student/course/${r}`)};return e.jsxs("div",{className:"pl-2 pr-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700 mr-8 mb-3",children:"My Courses"}),e.jsxs("div",{className:"mb-2 md:mb-6 ml-auto flex flex-wrap items-center text-sm gap-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"search",className:"mr-2",children:"Search:"}),e.jsx("input",{type:"text",id:"search",placeholder:"Search courses...",onChange:r=>w(r.target.value),className:"p-1 border rounded text-sm"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"sortBy",className:"mr-2",children:"Sort by:"}),e.jsxs("select",{id:"sortBy",value:i,onChange:r=>m(r.target.value),className:"p-1 border rounded text-sm",children:[e.jsx("option",{value:"Name",children:"Name"}),e.jsx("option",{value:"Likes",children:"Popularity"}),e.jsx("option",{value:"DueDate",children:"Due Date"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{className:`mr-2 ${n==="all"?"font-bold underline":""}`,onClick:()=>S("all"),children:"All"}),"|",e.jsx("button",{className:`mr-2 ml-2 ${n==="inProgress"?"font-bold underline":""}`,onClick:()=>S("inProgress"),children:"In Progress"}),"|",e.jsx("button",{className:`ml-2 ${n==="completed"?"font-bold underline":""}`,onClick:()=>S("completed"),children:"Completed"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>k("grid"),className:`mr-2 ${p==="grid"?"text-blue-500":"text-gray-500"}`,"aria-label":"Grid View",children:e.jsx(_,{size:18})}),e.jsx("button",{onClick:()=>k("table"),className:`${p==="table"?"text-blue-500":"text-gray-500"}`,"aria-label":"Table View",children:e.jsx(G,{size:18})})]})]}),e.jsx("div",{children:o?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"animate-spin"}),e.jsx("span",{children:"Loading courses..."})]}):p==="grid"?b.length>0?e.jsx("div",{className:"flex flex-wrap justify-start gap-5 lg:gap-6 2xl:gap-12",children:b.map(r=>e.jsx(fe,{course:r,enrolled:r.enrolled,searchTerm:x,isEcomm:t==null?void 0:t.ecommerce},r.Id))}):e.jsxs("p",{className:"text-gray-500",children:["No courses found. Please go to the"," ",e.jsx("a",{href:"#",onClick:A,className:"text-blue-500 hover:underline cursor-pointer",children:"catalog"})," ","to find courses."]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left font-semibold text-gray-700",children:"Name"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left font-semibold text-gray-700 hidden md:table-cell",children:"Short Description"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left w-64 font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-left"})]})}),e.jsx("tbody",{children:b.length>0?b.map(r=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-0 md:py-2 px-0 md:px-4 border-b border-gray-200 w-12 md:w-20",children:e.jsx("img",{src:r.ImageURL||"/GenericCourseIcon.webp",alt:r.Name,className:"w-12 h-8 object-cover rounded"})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:r.Name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 hidden md:table-cell",children:r.ShortDescription}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:r.enrolled&&e.jsx(ge,{courseId:r.Id})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 w-32",children:e.jsx("button",{onClick:()=>$(r.Id),className:"px-3 py-1 text-white text-sm rounded-sm lms-button",children:"Details"})})]},r.Id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No courses found."})})})]})})})]})};function we(t){return B(t,Date.now())}function Se(t,a,s){const[c,i]=be(s==null?void 0:s.in,t,a);return+I(c)==+I(i)}function Fe(t,a){return Se(B(t,t),we(t))}const Ce=()=>{const[t,a]=l.useState([]),[s,c]=l.useState(!1),[i,m]=l.useState(!1),x="https://knowvara.com/api";l.useEffect(()=>{(async()=>{try{const d=sessionStorage.getItem("token");if(!d){j.error("Authentication token is missing. Please log in again.");return}const n=await y.get(`${x}/api/gamification/badge-notifications`,{headers:{Authorization:`Bearer ${d}`}});n.data.notifications.length>0?(a(n.data.notifications),c(!0),console.log("got notifications",n.data.notifications)):console.log("got no notifications")}catch(d){console.error("Error fetching badge notifications:",d),j.error("Failed to fetch badge notifications.")}})()},[x]);const u=async()=>{if(t.length===0){c(!1);return}m(!0);try{const o=sessionStorage.getItem("token");if(!o){j.error("Authentication token is missing. Please log in again."),m(!1);return}const d=t.map(n=>y.put(`${x}/api/gamification/badge-notifications/${n.id}/read`,{},{headers:{Authorization:`Bearer ${o}`}}));await Promise.all(d),a([]),c(!1)}catch(o){console.error("Error marking badge notifications as read:",o),j.error("Failed to mark badge notifications as read.")}finally{m(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-lg hidden",children:"I'm right here"}),s&&e.jsx(E,{title:"New Badges Earned!",onClose:()=>{i||u()},onConfirm:()=>{i||u()},singleButton:!0,confirmText:"OK",children:i?e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx(C,{className:"animate-spin text-2xl text-blue-500"}),e.jsx("span",{className:"ml-2",children:"Processing..."})]}):e.jsx("div",{className:"space-y-4",children:t.map(o=>e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-[80px] h-[80px] rounded-full flex items-center justify-center",style:{backgroundColor:o.color},children:e.jsx("div",{className:"w-[75px] h-[75px] rounded-full bg-white flex items-center justify-center",children:e.jsx("div",{className:"w-[70px] h-[70px] rounded-full flex items-center justify-center text-white",style:{backgroundColor:o.color},children:ve(o.icon,26,"#ffffff")})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold",style:{color:o.color},children:o.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Awarded on:"," ",De(o.notified_at)?new Date(T(o.notified_at)).toLocaleDateString():"Unknown Date"]})]})]},o.id))})})]})},ve=(t,a=20,s="#ffffff")=>({FaStar:e.jsx(W,{size:a,color:s}),FaHeart:e.jsx(V,{size:a,color:s}),FaCheckCircle:e.jsx(C,{size:a,color:s}),FaMedal:e.jsx(K,{size:a,color:s}),FaTrophy:e.jsx(Y,{size:a,color:s}),FaCrown:e.jsx(J,{size:a,color:s}),FaBolt:e.jsx(q,{size:a,color:s}),FaLeaf:e.jsx(Q,{size:a,color:s}),FaRocket:e.jsx(X,{size:a,color:s}),FaShieldAlt:e.jsx(Z,{size:a,color:s}),FaGlobe:e.jsx(z,{size:a,color:s}),FaLightbulb:e.jsx(ee,{size:a,color:s}),FaBook:e.jsx(te,{size:a,color:s}),FaLaptop:e.jsx(se,{size:a,color:s}),FaCamera:e.jsx(ae,{size:a,color:s}),FaMusic:e.jsx(re,{size:a,color:s}),FaCameraRetro:e.jsx(ne,{size:a,color:s}),FaCode:e.jsx(oe,{size:a,color:s}),FaCloud:e.jsx(le,{size:a,color:s}),FaComments:e.jsx(ie,{size:a,color:s}),FaCoffee:e.jsx(ce,{size:a,color:s}),FaDatabase:e.jsx(de,{size:a,color:s}),FaDice:e.jsx(me,{size:a,color:s}),FaGlasses:e.jsx(xe,{size:a,color:s}),FaHeartbeat:e.jsx(ue,{size:a,color:s})})[t]||e.jsx(C,{size:a,color:s}),T=t=>t?t.replace(" ","T"):"",De=t=>{if(!t)return!1;const a=new Date(T(t));return!isNaN(a.getTime())},ke=()=>{const[t,a]=l.useState(null),[s,c]=l.useState(!0),[i,m]=l.useState(""),x=async()=>{const n=sessionStorage.getItem("token");if(!n){m("User is not authenticated."),c(!1);return}try{const h=await y.get("https://knowvara.com/api/api/events/upcoming",{headers:{Authorization:`Bearer ${n}`}});a(h.data)}catch(h){console.error("Error fetching upcoming events:",h),m("Failed to load upcoming events.")}finally{c(!1)}};if(l.useEffect(()=>{x()},[]),s||i||!t)return null;const{registeredEvents:u,instructedEvents:o}=t;if(u.length===0&&o.length===0)return null;const d=({event:n})=>{const h=new Date(n.DateTime),p=Fe(h),N=ye(h,"MMM d, yyyy h:mm a");return e.jsxs("li",{className:`flex flex-col sm:flex-row justify-between items-start sm:items-center p-2 mb-2 rounded ${p?"bg-green-50 border":"bg-gray-50"}`,children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:n.LessonName})," ",e.jsx("p",{className:"text-sm",children:N}),e.jsx("p",{className:"text-sm text-gray-600",children:n.Location}),n.OnlineMeetingLink&&n.OnlineMeetingLink.trim()!==""&&e.jsx("a",{href:n.OnlineMeetingLink,target:"_blank",rel:"noopener noreferrer",className:"mt-1 inline-block text-blue-500 hover:underline text-sm",children:"Join Meeting"})]}),p&&e.jsx("span",{className:"mt-1 sm:mt-0",children:"Today"})]},n.Id)};return e.jsxs("div",{className:"",children:[u.length>0&&e.jsxs("div",{className:"bg-white shadow-md rounded mb-3",children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white font-bold",children:"Upcoming Events"}),e.jsx("ul",{className:"p-2",children:u.map(n=>e.jsx(d,{event:n},n.Id))})]}),o.length>0&&e.jsxs("div",{className:"bg-white shadow-md rounded mb-4",children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white font-bold",children:"Events You Are Leading"}),e.jsx("ul",{className:"p-2",children:o.map(n=>e.jsx(d,{event:n},n.Id))})]})]})},Ae=()=>{const{user:t}=L(),a=M(),{subscription:s,error:c}=he(),[i,m]=l.useState(0),[x,u]=l.useState(!1);return l.useEffect(()=>{const o=sessionStorage.getItem("showWelcomeModal")==="true";console.log("Should Show Modal:",o),o&&(u(!0),sessionStorage.removeItem("showWelcomeModal"))},[]),l.useEffect(()=>{if(s&&s.subscription_plan.toLowerCase()==="free"&&s.trial_end){const o=new Date,n=new Date(s.trial_end).getTime()-o.getTime(),h=Math.ceil(n/(1e3*3600*24));h>0?m(h):m(0)}else m(0)},[s]),l.useEffect(()=>{c&&j.error(c)},[c]),e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsxs("div",{className:"flex flex-col items-start w-full md:w-3/4 border-r border-gray-300 p-4",children:[e.jsx("div",{className:"w-full",children:e.jsx(pe,{allowLaunch:!0})}),e.jsx("div",{className:"w-full",children:e.jsx(Ne,{})})]}),e.jsxs("div",{className:"w-full md:w-1/4 p-4 relative",children:[(t==null?void 0:t.Admin)==="y"&&s&&s.subscription_plan.toLowerCase()==="free"&&s.trial_end&&e.jsxs("div",{className:"bg-red-600 text-white text-xs px-4 py-2 rounded-md mb-2 text-center",children:["Your free trial expires in ",i," ",i===1?"day":"days",". Go to"," ",e.jsx("span",{className:"underline cursor-pointer",onClick:()=>a("/admin/settings"),children:"Settings"})," ","to upgrade your plan."]}),(t==null?void 0:t.Id)&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{}),e.jsx(je,{userId:t.Id,gamify:t.gamify,isMe:!0})]}),e.jsx(Ce,{})]}),x&&e.jsxs(E,{title:"Welcome to KnowVara",onClose:()=>u(!1),onConfirm:()=>u(!1),singleButton:!0,confirmText:"Get Started",widthClassName:"max-w-2xl",children:[e.jsx("p",{className:"mb-4 text-gray-700 text-md",children:"The custom URL for your account is:"}),e.jsxs("div",{className:"font-semibold mb-4 flex w-full text-center justify-center text-lg text-blue-900",children:["https://",t==null?void 0:t.Subdomain,".","knowvara.com"]}),e.jsx("p",{className:"mb-2 text-gray-700 text-md",children:"You're currently on the Student Home page. While there's no content here yet, adding content is simple and straightforward."}),e.jsxs("p",{className:"mb-4 text-gray-700 text-md",children:["In the top navigation bar, you'll find the"," ",e.jsx("strong",{className:"text-blue-900",children:"Home, Catalog, and Transcript"})," ","buttons, which are accessible to all users. As an admin, you also have access to the"," ",e.jsx("strong",{className:"text-blue-900",children:"Dashboard, Content, People, Reports, and Settings"})," ","buttons."]}),e.jsxs("p",{className:"mb-4 text-gray-700 text-md",children:["We hope you find KnowVara intuitive and easy to use. If you need any assistance or would like a guided tour, simply click"," ",e.jsx("strong",{className:"text-blue-900",children:"Settings"})," and submit a support request. We're here to help!"]})]})]})};export{Ae as default};
