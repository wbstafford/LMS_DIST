import{v as D,c as W,d as J,r as c,j as t,f as u,b4 as X}from"./index-qxcGHeRB.js";import{P as Y}from"./PageObject-C2xNrQh1.js";const Z=[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link"],[{color:[]},{background:[]}],[{align:[]}]],_={toolbar:Z},y={textOnly:{title:"Text Only",layout:[{field:"content",width:"full"}],contentClass:"text-only-content",imageClass:""},imageRightHalf:{title:"Image Right Half",layout:[{field:"content",width:"half"},{field:"image",width:"half"}],contentClass:"image-right-half-content",imageClass:"image-right-half-image"},imageLeftHalf:{title:"Image Left Half",layout:[{field:"image",width:"half"},{field:"content",width:"half"}],contentClass:"image-left-half-content",imageClass:"image-left-half-image"}},ee=["Multiple Choice","Multiple Answer","True or False","Text Entry","AI Graded Response"],ne=()=>{const{lessonId:m,pageId:i}=D(),{user:d}=W(),p=J(),[s,l]=c.useState(null),[h,b]=c.useState("textOnly"),[$,N]=c.useState("Multiple Choice"),[I,T]=c.useState(!1),[x,C]=c.useState(""),[w,v]=c.useState(!1),[Q,E]=c.useState(""),[r,F]=c.useState({});c.useEffect(()=>{i&&i!=="0"?(console.log("Looking up page id: "+i),(async()=>{const o=sessionStorage.getItem("token");if(!o){console.error("No token found, user is not authenticated.");return}try{const a=await u.get(`https://knowvara.com/api/api/pages/page/${i}`,{headers:{Authorization:`Bearer ${o}`}}),g={...a.data,Type:"question",QuestionType:a.data.QuestionType||"Multiple Choice"};console.log("Fetched Page:",g),l(g),b(g.Template||"textOnly"),N(g.QuestionType||"Multiple Choice")}catch(a){console.error("Error fetching question:",a)}})()):(async()=>{console.log(d==null?void 0:d.Email);const n=sessionStorage.getItem("token");if(!n){console.error("No token found, user is not authenticated.");return}try{const a=(await u.post("https://knowvara.com/api/api/pages/createTemporaryPage",{lessonId:m,Type:"question",QuestionType:"Multiple Choice"},{headers:{Authorization:`Bearer ${n}`}})).data.pageId;p(`/admin/question-creator/${m}/${a}`)}catch(o){console.error("Error creating temporary question:",o)}})()},[i,m,d==null?void 0:d.Email,p]);const S=e=>{b(e),l(n=>n?{...n,Template:e}:null)},M=e=>{const n=e.target.value;N(n),l(o=>o?{...o,QuestionType:n}:null)},k=e=>{const{name:n,value:o}=e.target;l(a=>a?{...a,[n]:o}:null)},q=e=>{l(n=>n?{...n,PageContent:e}:null)},P=e=>{l(n=>n?{...n,ImageURL:e}:null)},j=[1,2,3,4],O=(e,n)=>{const o=`Option${e}`;l(a=>a?{...a,[o]:n}:null)},f=e=>{if(s)if(s.QuestionType==="Multiple Choice")l({...s,CorrectOption:e});else if(s.QuestionType==="Multiple Answer"){const n=s.CorrectOptions?s.CorrectOptions.split(",").map(Number):[],o=n.includes(e)?n.filter(a=>a!==e):[...n,e];l({...s,CorrectOptions:o.join(",")})}else s.QuestionType==="True or False"&&l({...s,TrueFalseAnswer:e===1?"True":"False"})},R=e=>{const{value:n}=e.target;l(o=>o?{...o,TextEntryAnswer:n}:null)},z=()=>{p(`/admin/lesson-builder/${m}`)},L=()=>{const e={};switch(s!=null&&s.Title.trim()||(e.Title="Title is required."),s==null?void 0:s.QuestionType){case"Multiple Choice":case"Multiple Answer":j.forEach(n=>{var a;const o=`Option${n}`;(!s[o]||!((a=s[o])!=null&&a.trim()))&&(e[o]=`Option ${n} is required.`)}),s.QuestionType==="Multiple Choice"&&s.CorrectOption===null&&(e.CorrectOption="Please select the correct option."),s.QuestionType==="Multiple Answer"&&(s.CorrectOptions?s.CorrectOptions.split(",").map(Number):[]).length===0&&(e.CorrectOptions="Please select at least one correct option.");break;case"True or False":s.TrueFalseAnswer||(e.TrueFalseAnswer="Please select an answer.");break;case"Text Entry":(!s.TextEntryAnswer||!s.TextEntryAnswer.trim())&&(e.TextEntryAnswer="Please enter the correct answer.");break;case"AI Graded Response":break;default:e.QuestionType="Please select a valid question type.";break}return F(e),Object.keys(e).length===0},B=async()=>{try{if(!s){console.error("No page data available to submit.");return}if(!L()){console.error("Validation failed:",r);return}const n={...s,temporary:"n",Type:"question"};console.log("Submitting page:",n);const o=sessionStorage.getItem("token");if(!o){console.error("No token found, user is not authenticated.");return}i&&i!=="0"?await u.put(`https://knowvara.com/api/api/pages/${i}`,n,{headers:{Authorization:`Bearer ${o}`}}):await u.post("https://knowvara.com/api/api/pages",n,{headers:{Authorization:`Bearer ${o}`}}),p(`/admin/lesson-builder/${m}`)}catch(e){console.error("Error saving question:",e)}},H=()=>{T(!0)},U=async()=>{if(!x){alert("Please enter a description.");return}v(!0),E("Generating question. Please wait...");const e=sessionStorage.getItem("token");if(!e){console.error("No token found, user is not authenticated.");return}try{await u.post("https://knowvara.com/api/api/content/createAIQuestion",{pageId:i,description:x},{headers:{Authorization:`Bearer ${e}`}});const n=await u.get(`https://knowvara.com/api/api/pages/page/${i}`,{headers:{Authorization:`Bearer ${e}`}}),o={...n.data,Type:"question",QuestionType:n.data.QuestionType||"Multiple Choice"};l(o),b("imageRightHalf"),T(!1),C("")}catch(n){console.error("Error generating question with AI:",n)}finally{v(!1)}},G=()=>{T(!1),C("")},A=(e,n=!1)=>{switch(e.field){case"title":return t.jsx("input",{type:"text",name:"Title",value:(s==null?void 0:s.Title)||"",onChange:k,placeholder:"Title: "+(s==null?void 0:s.Id),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300 mb-8 text-lg font-semibold"});case"content":return t.jsxs("div",{className:`mb-14 w-full ${y[h].contentClass}`,children:[t.jsx(X,{value:(s==null?void 0:s.PageContent)||"",onChange:q,placeholder:"Content",modules:_,className:"mb-20 question-half-content"}),n&&V()]});case"image":return t.jsx(Y,{pageId:(s==null?void 0:s.Id)||0,initialImageURL:(s==null?void 0:s.ImageURL)||"",onImageUpload:P,className:y[h].imageClass});default:return null}},K=()=>{const e=y[h].layout,n=e.length>1;return t.jsx("div",{className:n?"flex flex-row":"flex flex-col",children:e.map((o,a)=>t.jsx("div",{className:`mb-4 ${o.width==="half"?"w-1/2":"w-full"} px-2`,children:o.field==="content"?A(o,!0):A(o)},a))})},V=()=>{if(!s)return null;switch(s.QuestionType){case"Multiple Choice":return t.jsxs("div",{className:"mt-4",children:[j.map(e=>{const n=`Option${e}`;return t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("input",{type:"radio",name:"CorrectOption",checked:s.CorrectOption===e,onChange:()=>f(e),className:"mr-2"}),t.jsx("input",{type:"text",placeholder:`Option ${e}`,value:s[n]||"",onChange:o=>O(e,o.target.value),className:"flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300"}),r[n]&&t.jsx("p",{className:"text-red-500 text-sm ml-2",children:r[n]})]},e)}),r.CorrectOption&&t.jsx("p",{className:"text-red-500 text-sm",children:r.CorrectOption})]});case"Multiple Answer":return t.jsxs("div",{className:"mt-4",children:[j.map(e=>{const n=`Option${e}`,o=s.CorrectOptions?s.CorrectOptions.split(",").map(Number).includes(e):!1;return t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("input",{type:"checkbox",checked:o,onChange:()=>f(e),className:"mr-2"}),t.jsx("input",{type:"text",placeholder:`Option ${e}`,value:s[n]||"",onChange:a=>O(e,a.target.value),className:"flex-1 px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300"}),r[n]&&t.jsx("p",{className:"text-red-500 text-sm ml-2",children:r[n]})]},e)}),r.CorrectOptions&&t.jsx("p",{className:"text-red-500 text-sm",children:r.CorrectOptions})]});case"True or False":return t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"flex items-center mb-2",children:[t.jsx("input",{type:"radio",name:"TrueFalseAnswer",checked:s.TrueFalseAnswer==="True",onChange:()=>f(1),className:"mr-2"}),t.jsx("span",{children:"True"})]}),t.jsxs("div",{className:"flex items-center",children:[t.jsx("input",{type:"radio",name:"TrueFalseAnswer",checked:s.TrueFalseAnswer==="False",onChange:()=>f(2),className:"mr-2"}),t.jsx("span",{children:"False"})]}),r.TrueFalseAnswer&&t.jsx("p",{className:"text-red-500 text-sm",children:r.TrueFalseAnswer})]});case"Text Entry":return t.jsxs("div",{className:"mt-4",children:[t.jsx("input",{type:"text",name:"TextEntryAnswer",value:s.TextEntryAnswer||"",onChange:R,placeholder:"Correct Answer",className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300"}),r.TextEntryAnswer&&t.jsx("p",{className:"text-red-500 text-sm",children:r.TextEntryAnswer})]});case"AI Graded Response":return t.jsx("div",{className:"mt-4",children:t.jsx("p",{className:"text-gray-600",children:"This question and the user's response will be sent to an AI grading system and the AI will determine if the user answered correctly."})});default:return null}};return t.jsxs("div",{className:"flex",children:[t.jsxs("div",{className:"w-1/5 p-4 border-r",children:[t.jsx("h3",{className:"font-semibold mb-2",children:"Templates"}),Object.entries(y).map(([e,n])=>t.jsx("div",{className:`p-4 cursor-pointer ${h===e?"bg-violet-100":""}`,onClick:()=>S(e),children:n.title},e)),t.jsx("h3",{className:"font-semibold mt-6 mb-2",children:"Question Types"}),t.jsx("select",{value:$,onChange:M,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",children:ee.map(e=>t.jsx("option",{value:e,children:e},e))}),r.QuestionType&&t.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.QuestionType})]}),t.jsxs("div",{className:"w-4/5 p-4",children:[s&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("input",{type:"text",name:"Title",value:(s==null?void 0:s.Title)||"",onChange:k,placeholder:"Title: "+(s==null?void 0:s.Id),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300 mb-2 text-lg font-semibold"}),r.Title&&t.jsx("p",{className:"text-red-500 text-sm",children:r.Title})]}),K(),t.jsxs("div",{className:"text-right mt-6",children:[t.jsx("button",{onClick:z,className:"lms-button text-white py-2 px-4 rounded-sm mr-2 text-sm",children:"Cancel"}),t.jsx("button",{onClick:H,className:"lms-button text-white py-2 px-4 rounded-sm mr-2 text-sm",children:"Build this question for me"}),t.jsx("button",{onClick:B,className:"lms-button text-white py-2 px-4 rounded-sm text-sm",children:"Save Question"})]})]}),I&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:t.jsx("div",{className:"bg-white p-6 shadow-lg w-1/2 mx-auto",children:w?t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"loader mb-4"})," ",t.jsx("p",{children:Q})]}):t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"What should this question be about?"}),t.jsx("textarea",{className:"w-full p-3 border rounded-md",rows:5,value:x,onChange:e=>C(e.target.value),placeholder:"Describe what the question should be about..."}),t.jsxs("div",{className:"mt-4 flex justify-end",children:[t.jsx("button",{onClick:G,className:"lms-button py-2 px-4 mr-2 rounded-sm text-sm",children:"Cancel"}),t.jsx("button",{onClick:U,disabled:w||!x,className:`lms-button py-2 px-4 rounded-sm ${w?"bg-gray-300":"bg-blue-500 text-sm"}`,children:"Submit"})]})]})})})]})]})};export{ne as default};
