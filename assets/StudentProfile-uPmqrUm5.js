import{c as P,r as c,j as e,O as p,an as U,D as E,e as b,B as k,F as L}from"./index-BzFnb_De.js";import{f as F}from"./format-Dt71a7ij.js";const $=()=>{const{user:l}=P(),[N,a]=c.useState(null),[y,h]=c.useState(!0),[u,x]=c.useState("");if(c.useEffect(()=>{(async()=>{var i,r,n,o;if(!(l!=null&&l.Id)){x("User not authenticated."),h(!1);return}try{const s=sessionStorage.getItem("token");if(!s){x("Authentication token is missing."),h(!1);return}const f=await b.get(`https://knowvara.com/api/api/reports/student-profile-details/${l.Id}`,{headers:{Authorization:`Bearer ${s}`}});a(f.data.profileDetails)}catch(s){if(console.error("Error fetching profile details:",s),b.isAxiosError(s)){const f=s,m=((r=(i=f.response)==null?void 0:i.data)==null?void 0:r.error)||((o=(n=f.response)==null?void 0:n.data)==null?void 0:o.message)||"An unexpected error occurred.";x(m),k.error(m||"Failed to load profile details.")}else x("An unexpected error occurred."),k.error("Failed to load profile details.")}finally{h(!1)}})()},[l==null?void 0:l.Id]),y)return e.jsxs("div",{className:"flex justify-center items-center h-full",children:[e.jsx(p,{className:"animate-spin text-blue-500 text-3xl"}),e.jsx("span",{className:"ml-2 text-blue-500",children:"Loading profile details..."})]});if(u)return e.jsx("div",{className:"text-red-500 p-4 bg-red-100 rounded",children:u});if(!N)return e.jsx("div",{className:"text-gray-500 p-4 bg-yellow-100 rounded",children:"No profile details available."});const{dateJoined:d,memberFor:w,lastLogin:v,coursesCompleted:C,coursesInProgress:D,certificatesReceived:g,badgesEarned:I,level:t,recentlyCompletedCourses:S}=N;return e.jsx("div",{className:"w-full",children:e.jsxs("div",{className:"bg-white shadow rounded-lg mb-4",children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white",children:"Profile Details"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Key Metrics"}),e.jsxs("ul",{className:"space-y-2 mb-4",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(p,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Date Joined:"})," ",new Date(d).toLocaleDateString()]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(p,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Last Log In:"})," ",v?new Date(v).toLocaleString():"Never"]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(p,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Member For:"})," ",w]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(p,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Courses Completed:"})," ",C]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(p,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Courses In Progress:"})," ",D]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Certificates Received:"})," ",g]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(E,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Badges Earned:"})," ",I]})]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(p,{className:"mr-2 lms-icon"}),e.jsxs("span",{children:[e.jsx("strong",{children:"Level:"})," ",t||"N/A"]})]})]}),e.jsx("h3",{className:"text-lg font-semibold mb-2 text-gray-700",children:"Recently Completed Courses"}),S.length===0?e.jsx("p",{className:"text-gray-500",children:"No completed courses found."}):e.jsx("ul",{className:"space-y-2",children:S.map((j,i)=>e.jsxs("li",{className:"flex justify-between items-center",children:[e.jsx("span",{children:j.courseName}),e.jsx("span",{className:"text-sm text-gray-400",children:F(new Date(j.completedDate),"MMMM do, yyyy")})]},i))})]})]})})},M=()=>{const{user:l}=P(),{updateUser:N}=P(),[a,y]=c.useState({FirstName:"",LastName:"",Email:"",Password:"",PhoneNumber:"",JobTitle:"",Department:"",DOB:"",Address:"",City:"",State:"",Country:"",ZipCode:"",OrgID:(l==null?void 0:l.OrgID)||0,imageUrl:""}),[h,u]=c.useState(!1),[x,d]=c.useState(""),[w,v]=c.useState(null),[C,D]=c.useState(""),[g,I]=c.useState(0);c.useEffect(()=>{l!=null&&l.Id&&(async()=>{var n;const r=sessionStorage.getItem("token");if(!r){d("Authentication token is missing. Please log in again.");return}try{const s=(await b.get(`https://knowvara.com/api/api/auth/users/${l.Id}`,{headers:{Authorization:`Bearer ${r}`}})).data;y({FirstName:s.FirstName||"",LastName:s.LastName||"",Email:s.Email||"",Password:"",PhoneNumber:s.PhoneNumber||"",JobTitle:s.jobTitle||"",Department:s.department||"",DOB:s.DOB?s.DOB.split("T")[0]:"",Address:s.Address||"",City:s.City||"",State:s.State||"",Country:s.Country||"",ZipCode:s.ZipCode||"",OrgID:s.OrgID||0,imageUrl:s.imageUrl||""}),s.imageUrl&&D(`/content${s.imageUrl}`)}catch(o){b.isAxiosError(o)?d(`Error fetching profile data: ${((n=o.response)==null?void 0:n.data)||o.message}`):d("An unexpected error occurred while fetching profile data.")}})()},[l==null?void 0:l.Id]);const t=i=>{const{name:r,value:n}=i.target;y({...a,[r]:n})},S=async i=>{var o;i.preventDefault(),u(!0),d(""),I(0);const r=sessionStorage.getItem("token");if(!r){d("Authentication token is missing. Please log in again."),u(!1);return}const n={Authorization:`Bearer ${r}`};try{if(l!=null&&l.Id)await b.put(`https://knowvara.com/api/api/auth/users/${l.Id}`,{...a},{headers:n});else{d("User ID is missing."),u(!1);return}if(w&&(l!=null&&l.Id)){const s=new FormData;s.append("image",w),s.append("orgID",a.OrgID.toString()),s.append("personId",l.Id.toString());const f=await b.post(`https://knowvara.com/api/api/auth/users/${l.Id}/image`,s,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${r}`},onUploadProgress:m=>{if(m.total){const A=Math.round(m.loaded*100/m.total);I(A)}}});if(f.status===200){const{imageUrl:m}=f.data;N({imageUrl:m})}}console.log("Profile Updated Successfully."),k.success("Profile Updated Successfully.")}catch(s){b.isAxiosError(s)?d(`Error saving profile: ${((o=s.response)==null?void 0:o.data)||s.message}`):d("An unexpected error occurred while saving the profile.")}finally{u(!1)}},j=i=>{var n;const r=(n=i.target.files)==null?void 0:n[0];if(r){v(r);const o=URL.createObjectURL(r);D(o)}};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsx("div",{className:"flex flex-col items-start w-full md:w-2/3 border-r border-gray-300 p-4",children:e.jsxs("form",{onSubmit:S,className:"w-full",children:[e.jsx("h2",{className:"text-xl font-semibold mb-6 text-gray-600",children:l?"Edit Your Profile":"Profile"}),x&&e.jsx("div",{className:"mb-4 text-red-500",children:x}),e.jsxs("div",{className:"flex flex-col md:flex-row mb-6",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start mr-6 mb-4 md:mb-0 w-full md:w-1/6",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[C?e.jsx("img",{src:C,alt:"User Preview",className:"w-32 h-32 object-cover rounded-full mb-2"}):e.jsx("div",{className:"w-32 h-32 bg-gray-200 rounded-full mb-2 flex items-center justify-center",children:"No Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:j,className:"hidden",id:"upload-image-input"}),e.jsx("label",{htmlFor:"upload-image-input",className:"px-3 py-2 lms-button text-xs cursor-pointer ",children:"Select Image"})]}),g>0&&g<100&&e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-500 h-2 rounded-full",style:{width:`${g}%`}})})]}),e.jsxs("div",{className:"flex flex-col w-full md:w-5/6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"First Name"}),e.jsx("input",{type:"text",name:"FirstName",value:a.FirstName,onChange:t,required:!0,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Last Name"}),e.jsx("input",{type:"text",name:"LastName",value:a.LastName,onChange:t,required:!0,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Email"}),e.jsx("input",{type:"email",name:"Email",value:a.Email,onChange:t,required:!0,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Password"}),e.jsx("input",{type:"password",name:"Password",value:a.Password,onChange:t,required:!1,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400",placeholder:"Leave blank to keep current password"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:space-x-4 mb-4",children:[e.jsxs("div",{className:"flex-1 mb-4 md:mb-0",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Job Title"}),e.jsx("input",{type:"text",name:"JobTitle",value:a.JobTitle,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Department"}),e.jsx("input",{type:"text",name:"Department",value:a.Department,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Date of Birth"}),e.jsx("input",{type:"date",name:"DOB",value:a.DOB,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Address"}),e.jsx("input",{type:"text",name:"Address",value:a.Address,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"City"}),e.jsx("input",{type:"text",name:"City",value:a.City,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"State"}),e.jsx("input",{type:"text",name:"State",value:a.State,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-4",children:[e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Country"}),e.jsx("input",{type:"text",name:"Country",value:a.Country,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]}),e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Zip Code"}),e.jsx("input",{type:"text",name:"ZipCode",value:a.ZipCode,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]})]}),e.jsx("div",{className:"flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 mb-4",children:e.jsxs("div",{className:"w-full md:w-1/2",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",children:"Phone Number"}),e.jsx("input",{type:"text",name:"PhoneNumber",value:a.PhoneNumber,onChange:t,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-blue-400"})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",className:"py-2 px-4 lms-button text-sm",disabled:h,children:h?e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"animate-spin mr-2"}),"Saving..."]}):"Save Profile"})})]})]})]})}),e.jsx("div",{className:"w-full md:w-1/3 p-4",children:e.jsx($,{})})]})};export{M as default};
