import{c as b,r as l,j as e,f as v,F as D,ai as E,z as y,aj as A,ak as $,al as F,am as R,v as T,d as U}from"./index-DiVl5c6T.js";import{U as z,L as B}from"./UserDetails-kEFycTJO.js";import{A as M,a as P}from"./AdminDashboardActivityChart-D4PATaaT.js";import{f as O}from"./format-Dt71a7ij.js";import"./CourseStatusBar-CQoXbtou.js";import"./AreaChart-CEJS3viS.js";import"./parseISO-BQ4LyrE0.js";const G=({userId:c})=>{const{user:a}=b(),[x,d]=l.useState(null),[h,m]=l.useState(!0),[o,u]=l.useState(null);l.useEffect(()=>{(async()=>{const p=sessionStorage.getItem("token");if(!p){u("Authentication token is missing. Please log in again."),m(!1);return}if(a){if(!a.OrgID){u("Organization ID is missing."),m(!1);return}try{m(!0);const j=(await v.get(`https://knowvara.com/api/api/reports/user-statistics/${c}`,{headers:{Authorization:`Bearer ${p}`}})).data;d(j)}catch(f){console.error("Error fetching user statistics:",f),u("Failed to fetch user statistics.")}finally{m(!1)}}})()},[c]);const n=i=>i?O(new Date(i),"MMMM d, yyyy h:mm a"):"N/A";return a?e.jsxs("div",{className:"bg-white rounded shadow mb-4",children:[e.jsx("div",{className:"w-full p-2 subnav-gradient text-white",children:"Statistics"}),h?e.jsx("p",{children:"Loading user statistics..."}):o?e.jsx("p",{className:"text-red-500",children:o}):x?e.jsxs("div",{className:"flex flex-col space-y-2 mt-1 p-2",children:[e.jsx("div",{children:e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Most Recent Log In:"})," ",n(x.mostRecentLogIn)]})}),e.jsx("div",{children:e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Most Recent Enrollment:"})," ",n(x.mostRecentEnrollment)]})}),e.jsx("div",{children:e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Most Recent Completion:"})," ",n(x.mostRecentCompletion)]})})]}):e.jsx("p",{children:"No user statistics available."})]}):e.jsx("div",{children:"Access Denied."})},V=({enrollmentId:c})=>{const[a,x]=l.useState([]),[d,h]=l.useState(!1),[m,o]=l.useState(null);l.useEffect(()=>{(async()=>{h(!0),o(null);try{const i=sessionStorage.getItem("token");if(!i){o("User is not authenticated.");return}const p=await v.get(`https://knowvara.com/api/api/enrollments/${c}/lessons`,{headers:{Authorization:`Bearer ${i}`}});x(p.data.lessons)}catch(i){console.error("Error fetching lessons:",i),o("Failed to load lessons.")}finally{h(!1)}})()},[c]);const u=n=>{switch(n.toLowerCase()){case"completed":return e.jsx(y,{className:"text-green-500 inline"});case"incomplete":return e.jsx(A,{className:"text-yellow-500 inline"});case"passed":return e.jsx(y,{className:"text-green-500 inline"});case"not attempted":default:return e.jsx(E,{className:"text-gray-500 inline"})}};return d?e.jsxs("div",{className:"flex items-center space-x-2 p-4",children:[e.jsx(D,{className:"animate-spin"}),e.jsx("span",{children:"Loading lessons..."})]}):m?e.jsx("div",{className:"text-red-500 p-4",children:m}):e.jsx("div",{className:"m-1 mt-2",children:e.jsx("table",{className:"min-w-full bg-white border",children:e.jsx("tbody",{children:a.length>0?a.map(n=>n.type.toLowerCase()==="header"?e.jsx("tr",{className:"bg-gray-100",children:e.jsx("td",{colSpan:3,className:"py-2 px-2 font-semibold text-gray-700",children:n.lessonName})},n.lessonId):e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 border-b",children:n.lessonName}),e.jsxs("td",{className:"py-2 px-4 border-b flex items-center",children:[u(n.status)," ",e.jsx("span",{className:"ml-2 capitalize",children:n.status})]}),e.jsx("td",{className:"py-2 px-4 border-b",children:n.completedDate?new Date(n.completedDate).toLocaleDateString():"N/A"})]},n.lessonId)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 px-4 border-b text-center",children:"No lessons found."})})})})})},_=({studentId:c})=>{const[a,x]=l.useState([]),[d,h]=l.useState(!1),[m,o]=l.useState(null),[u,n]=l.useState(new Set),[i,p]=l.useState("name"),[f,j]=l.useState({}),w=s=>s?new Date(s).getTime():1/0;l.useEffect(()=>{c?(async()=>{h(!0),o(null);try{const t=sessionStorage.getItem("token");if(!t){o("User is not authenticated.");return}const r=await v.get(`https://knowvara.com/api/api/enrollments/student/${c}/courses`,{headers:{Authorization:`Bearer ${t}`},params:{sortBy:i}});x(r.data.courses)}catch(t){console.error("Error fetching courses:",t),o("Failed to load courses.")}finally{h(!1)}})():o("Student ID is missing.")},[c,i]);const C=s=>{if(s){const t=s.startsWith("http")?s:`/content/${s}`;window.open(t,"_blank")}},I=l.useMemo(()=>{if(!a)return[];const s=[...a];switch(i){case"name":return s.sort((t,r)=>t.courseName.localeCompare(r.courseName));case"enrollDate":return s.sort((t,r)=>new Date(r.enrollDate).getTime()-new Date(t.enrollDate).getTime());case"completedDate":return s.sort((t,r)=>{const N=t.completedDate?new Date(t.completedDate).getTime():0;return(r.completedDate?new Date(r.completedDate).getTime():0)-N});case"dueDate":return s.sort((t,r)=>w(t.dueDate)-w(r.dueDate));default:return s}},[a,i]),g=s=>{n(t=>{const r=new Set(t);return r.has(s)?r.delete(s):r.add(s),r})},S=s=>{switch(s){case"Overdue":return"text-red-600";case"Completed":case"Passed":return"text-green-600";case"Incomplete":return"text-yellow-700";case"Not Attempted":default:return"text-gray-500"}},L=s=>{switch(s){case"Overdue":return"Overdue";case"Completed":return"Completed";case"Incomplete":return"In Progress";case"Not Attempted":default:return"Not Attempted"}},k=s=>{p(s.target.value)};return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Courses"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 md:mt-0",children:[e.jsx("label",{htmlFor:"sortBy",className:"text-sm",children:"Sort By:"}),e.jsxs("select",{id:"sortBy",value:i,onChange:k,className:"p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"enrollDate",children:"Enroll Date"}),e.jsx("option",{value:"completedDate",children:"Completed Date"}),e.jsx("option",{value:"dueDate",children:"Due Date"})," "]})]})]}),d?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"animate-spin"}),e.jsx("span",{children:"Loading courses..."})]}):m?e.jsx("div",{className:"text-red-500",children:m}):a.length===0?e.jsx("div",{children:"No courses enrolled."}):e.jsx("ul",{className:"space-y-2",children:I.map(s=>e.jsxs("li",{className:"border p-2 rounded-md bg-white shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex space-x-4 w-2/3",children:[e.jsxs("div",{className:"relative w-16 h-16",children:[!f[s.enrollmentId]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"loader"})}),e.jsx("img",{src:s.imageURL||"/GenericCourseIcon.webp",alt:`Course image for ${s.courseName}`,loading:"lazy",className:`w-16 h-16 object-cover rounded cursor-pointer transition-opacity duration-500 ${f[s.enrollmentId]?"opacity-100":"opacity-0"}`,onLoad:()=>{j(t=>({...t,[s.enrollmentId]:!0}))},onError:t=>{const r=t.target;r.src="/GenericCourseIcon.webp",j(N=>({...N,[s.enrollmentId]:!0}))},onClick:()=>g(s.enrollmentId)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-md font-semibold text-gray-700 cursor-pointer",onClick:()=>g(s.enrollmentId),children:s.courseName}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsx("span",{className:`mt-1 font-semibold ${S(s.status)}`,children:L(s.status)}),s.completedDate&&e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["Completed on:"," ",new Date(s.completedDate).toLocaleDateString()]}),s.dueDate&&e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["Due Date:"," ",new Date(s.dueDate).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end w-1/3",children:[s.certificateURL&&e.jsx("a",{onClick:()=>C(s.certificateURL),target:"_blank",rel:"noopener noreferrer",className:"lms-icon cursor-pointer",title:"View Certificate","aria-label":`View Certificate for ${s.courseName}`,children:e.jsx($,{size:20})}),e.jsx("button",{className:"text-gray-600 ml-2 focus:outline-none mr-3",onClick:()=>g(s.enrollmentId),"aria-expanded":u.has(s.enrollmentId),"aria-controls":`course-lessons-${s.enrollmentId}`,title:u.has(s.enrollmentId)?"Collapse Lessons":"Expand Lessons",children:u.has(s.enrollmentId)?e.jsx(F,{size:20}):e.jsx(R,{size:20})})]})]}),u.has(s.enrollmentId)&&e.jsx("div",{id:`course-lessons-${s.enrollmentId}`,className:"mt-4",children:e.jsx(V,{enrollmentId:s.enrollmentId})})]},s.enrollmentId))}),e.jsx("hr",{className:"mt-6"})]})},Z=()=>{const{personId:c}=T(),{user:a}=b(),x=U(),d=c||(a==null?void 0:a.Id);if(!d)return e.jsx("div",{children:"Loading..."});const h=!c,m=()=>{const o=sessionStorage.getItem("origin");o?(x(o),sessionStorage.removeItem("origin")):x("/student")};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsxs("div",{className:"flex flex-col items-start w-full md:w-1/5 md:border-r border-gray-300 p-2 md:p-4",children:[c&&e.jsx("button",{onClick:m,className:"mb-2 px-3 py-1 text-xs lms-button",children:"Return"}),e.jsx("div",{className:"w-full",children:e.jsx(z,{userId:d,gamify:a==null?void 0:a.gamify,isMe:h})})]}),e.jsx("div",{className:"w-full md:w-3/5 p-2 md:p-4 md:border-r border-gray-300",children:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsx("div",{className:"w-full",children:e.jsx(_,{studentId:d})}),e.jsx("div",{className:"w-full",children:e.jsx(B,{allowLaunch:!1,userId:d})})]})}),e.jsx("div",{className:"w-full md:w-1/5 p-2 md:p-4",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("div",{children:e.jsx(M,{userId:d,height:175,outerRadius:62,innerRadius:10})}),e.jsx("div",{children:e.jsx(P,{userId:d,height:150})}),e.jsx("div",{children:e.jsx(G,{userId:d})})]})})]})};export{Z as default};
