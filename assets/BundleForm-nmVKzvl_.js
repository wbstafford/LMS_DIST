import{c as z,d as M,v as R,r as o,j as e,b4 as T,B as n,f as m}from"./index-BEzWJCG4.js";const G={toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["link","image"],["clean"]]},H=["header","bold","italic","underline","strike","list","bullet","link","image"],U=()=>{const{user:s}=z(),N=M(),{bundleID:l}=R(),d=!!l,[h,j]=o.useState(""),[u,v]=o.useState(""),[y,C]=o.useState(""),[x,p]=o.useState(0),[w,k]=o.useState(!1),[c,f]=o.useState([]),[I,O]=o.useState([]),[g,$]=o.useState(""),[D,i]=o.useState(""),B=async()=>{const t=sessionStorage.getItem("token");if(!t||!(s!=null&&s.OrgID)){i("Authentication token or OrgID is missing."),n.error("Authentication token or OrgID is missing.");return}try{const r=await m.get(`https://knowvara.com/api/api/courses/${s.OrgID}`,{headers:{Authorization:`Bearer ${t}`}});O(r.data)}catch(r){console.error("Error fetching courses:",r),i("Failed to fetch courses."),n.error("Failed to fetch courses.")}},F=async()=>{if(!d||!l)return;const t=sessionStorage.getItem("token");if(!t||!(s!=null&&s.OrgID)){i("Authentication token or OrgID is missing."),n.error("Authentication token or OrgID is missing.");return}try{const a=(await m.get(`https://knowvara.com/api/api/bundles/${s.OrgID}/${l}`,{headers:{Authorization:`Bearer ${t}`}})).data;j(a.Name),v(a.ShortDescription),C(a.Description),p(a.Price||0),k(a.OnCatalog),f(a.courses.map(b=>b.Id))}catch(r){console.error("Error fetching bundle:",r),i("Failed to fetch bundle details."),n.error("Failed to fetch bundle details.")}};o.useEffect(()=>{B(),d&&F()},[s==null?void 0:s.OrgID,l]);const A=async t=>{t.preventDefault();const r=sessionStorage.getItem("token");if(!r||!(s!=null&&s.OrgID)){i("Authentication token or OrgID is missing."),n.error("Authentication token or OrgID is missing.");return}if(!u||u.length>128){i("ShortDescription is required and must be at most 128 characters."),n.error("ShortDescription is required and must be at most 128 characters.");return}if(!h||s!=null&&s.ecommerce&&x<0||c.length===0){i("Please fill in all required fields."),n.error("Please fill in all required fields.");return}const a={OrgID:s.OrgID,Name:h,ShortDescription:u,Description:y,OnCatalog:w,CourseIds:c};s!=null&&s.ecommerce&&(a.Price=x);try{d&&l?(await m.patch(`https://knowvara.com/api/api/bundles/${s.OrgID}/${l}`,a,{headers:{Authorization:`Bearer ${r}`}}),n.success("Bundle updated successfully.")):(await m.post("https://knowvara.com/api/api/bundles",a,{headers:{Authorization:`Bearer ${r}`}}),n.success("Bundle created successfully.")),N("/admin/courses")}catch(b){console.error("Error saving bundle:",b),i("Failed to save bundle."),n.error("Failed to save bundle.")}},E=t=>{c.includes(t)?f(c.filter(r=>r!==t)):f([...c,t])},q=t=>{const r=parseFloat(t.target.value);isNaN(r)?p(0):p(r)},P=()=>{N("/admin/courses")},L=t=>{$(t.target.value)},S=I.filter(t=>t.Name.toLowerCase().includes(g.toLowerCase())||t.Description.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{className:"relative pb-16",children:[" ",e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%] pb-16",children:[e.jsxs("div",{className:"w-full md:w-1/2 p-6 border-r border-gray-300",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:d?"Edit Bundle":"Create New Bundle"}),D&&e.jsx("div",{className:"mb-4 text-red-500",children:D}),e.jsxs("form",{onSubmit:A,id:"bundle-form",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"name",children:["Bundle Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{id:"name",type:"text",value:h,onChange:t=>j(t.target.value),required:!0,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"shortDescription",children:["Short Description",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{id:"shortDescription",value:u,onChange:t=>v(t.target.value),maxLength:128,required:!0,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("div",{className:"text-gray-600 text-xs mt-1",children:[128-u.length," characters left"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"description",children:"Description"}),e.jsx(T,{id:"description",value:y,onChange:C,modules:G,formats:H,placeholder:"Enter detailed description here...",className:"h-40 mb-14"})]}),(s==null?void 0:s.ecommerce)&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"price",children:"Price ($)"}),s.stripeActive?e.jsx("input",{id:"price",type:"number",value:x,onChange:q,min:"0",step:"0.01",className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",required:!0}):e.jsxs("p",{className:"text-red-500 text-sm",children:["Stripe account not connected. Go to"," ",e.jsx("a",{href:"/admin/settings",className:"underline",children:"settings"})," ","and connect your Stripe account"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"onCatalog",type:"checkbox",checked:w,onChange:t=>k(t.target.checked),className:"mr-2 form-checkbox h-5 w-5 text-blue-600"}),e.jsx("label",{htmlFor:"onCatalog",className:"text-gray-700 text-sm font-bold",children:"Visible on Catalog"})]})]})]}),e.jsxs("div",{className:"w-full md:w-1/2 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Select Courses"}),e.jsx("div",{className:"mb-4",children:e.jsx("input",{type:"text",placeholder:"Search courses...",value:g,onChange:L,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"})}),S.length===0?e.jsx("div",{children:"No courses match your search."}):e.jsx("div",{style:{maxHeight:"550px"},className:"overflow-y-auto border rounded-md p-4",children:S.map(t=>e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("input",{type:"checkbox",id:`course-${t.Id}`,checked:c.includes(t.Id),onChange:()=>E(t.Id),className:"mr-2 form-checkbox h-5 w-5 text-blue-600"}),e.jsx("label",{htmlFor:`course-${t.Id}`,className:"text-sm cursor-pointer",children:t.Name})]},t.Id))})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white p-4 flex justify-end space-x-4 items-center border-t shadow-md",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:P,className:"lms-cancel-button py-2 px-4 text-white mr-2 w-48",children:"Cancel"}),e.jsx("button",{type:"submit",form:"bundle-form",className:"lms-button py-2 px-4 text-white w-full sm:w-48",children:d?"Update Bundle":"Create Bundle"})]})})]})};export{U as default};
