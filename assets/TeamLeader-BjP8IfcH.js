import{c as L,r,j as e,F as Q,f as b,w as X,B as j,ae as te,d as ae,h as re,af as U,ag as ne,ah as oe}from"./index-qxcGHeRB.js";import{R as q,P as ie,a as le,C as ce,T as J,L as V,A as de,b as me,X as ue,Y as xe,c as K}from"./AreaChart-CEMTxWTN.js";import{p as G}from"./parseISO-BQ4LyrE0.js";import{f as Y}from"./format-Dt71a7ij.js";const _=["#FF8042","#FFBB28","#00C49F","#0088FE"],he=({teamId:l,height:d=260,outerRadius:p=100,innerRadius:f=40,refreshKey:g})=>{const{user:c}=L(),[v,N]=r.useState([]),[w,y]=r.useState(!0),[m,u]=r.useState(null);return r.useEffect(()=>{(async()=>{const a=sessionStorage.getItem("token");if(!a){u("Authentication token is missing. Please log in again."),y(!1);return}if(c){if(!c.OrgID){u("Organization ID is missing."),y(!1);return}try{y(!0);const t=`https://knowvara.com/api/api/reports/completion-status/team/${l}`,o=await b.get(t,{headers:{Authorization:`Bearer ${a}`}});console.log("Team Completion Status Response:",o.data);const n=o.data.completionStatusData;if(Array.isArray(n)){const C=n.map(A=>({name:A.name,value:Number(A.value)}));N(C)}else console.warn("Unexpected completionStatusData format:",n),N([]),u("Unexpected data format received.")}catch(t){console.error("Error fetching team completion status data:",t),b.isAxiosError(t)&&t.response?u(`Error ${t.response.status}: ${t.response.data.error||"Failed to fetch team completion status data."}`):u("Failed to fetch team completion status data.")}finally{y(!1)}}})()},[c,l,g]),!c||c.Admin!=="y"?e.jsx("div",{children:"Access Denied. Admins only."}):e.jsxs("div",{className:"bg-white rounded shadow mb-4 flex flex-col items-center",children:[e.jsx("div",{className:"w-full p-2 subnav-gradient text-white",children:"Team Course Completion Status"}),e.jsx("div",{className:"w-full flex justify-center items-center p-2",children:w?e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading completion status data..."})]}):m?e.jsx("p",{className:"text-red-500",children:m}):v.length===0?e.jsx("p",{children:"No completion status data available."}):e.jsx(q,{width:"100%",height:d,children:e.jsxs(ie,{children:[e.jsx(le,{data:v,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:p,innerRadius:f,fill:"#8884d8",label:({cx:i,cy:a,midAngle:t,innerRadius:o,outerRadius:n,value:C})=>{if(C===0)return null;const A=Math.PI/180,S=o+(n-o)*.5,T=i+S*Math.cos(-t*A),E=a+S*Math.sin(-t*A);return e.jsx("text",{x:T,y:E,fill:"white",fontSize:16,textAnchor:T>i?"start":"end",dominantBaseline:"central",children:C})},labelLine:!1,children:v.map((i,a)=>e.jsx(ce,{fill:_[a%_.length]},`cell-${a}`))}),e.jsx(J,{}),e.jsx(V,{})]})})})]})},pe=({teamId:l,height:d=235})=>{const{user:p}=L(),[f,g]=r.useState([]),[c,v]=r.useState(7),[N,w]=r.useState(!0),[y,m]=r.useState(null);r.useEffect(()=>{(async()=>{const a=sessionStorage.getItem("token");if(!a){m("Authentication token is missing. Please log in again."),w(!1);return}if(p){if(!p.OrgID){m("Organization ID is missing."),w(!1);return}try{w(!0);const t=`https://knowvara.com/api/api/reports/activity/team/${l}?days=${c}`,o=await b.get(t,{headers:{Authorization:`Bearer ${a}`}});console.log("Team Activity Data Response:",o.data);const n=o.data.activityData;Array.isArray(n)?g(n):(console.warn("Unexpected activityData format:",n),g([]),m("Unexpected data format received."))}catch(t){console.error("Error fetching team activity data:",t),b.isAxiosError(t)&&t.response?m(`Error ${t.response.status}: ${t.response.data.error||"Failed to fetch team activity data."}`):m("Failed to fetch team activity data.")}finally{w(!1)}}})()},[p,c,l]);const u=i=>{v(i)};return!p||p.Admin!=="y"?e.jsx("div",{children:"Access Denied. Admins only."}):e.jsxs("div",{className:"bg-white rounded shadow mb-4 flex flex-col",children:[e.jsxs("div",{className:"flex w-full p-2 subnav-gradient text-white justify-between items-center",children:[e.jsx("span",{children:"Team Activity Overview"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>u(7),className:`px-3 py-1 rounded ${c===7?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Past 7 Days"}),e.jsx("button",{onClick:()=>u(30),className:`px-3 py-1 rounded ${c===30?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Past 30 Days"})]})]}),e.jsx("div",{className:"flex-1 py-4 px-1",children:N?e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"animate-spin mr-2"}),e.jsx("span",{children:"Loading activity data..."})]}):y?e.jsx("p",{className:"mt-4 text-red-500",children:y}):f.length===0?e.jsx("p",{className:"mt-4",children:"No activity data found."}):e.jsx(q,{width:"100%",height:d,children:e.jsxs(de,{data:f,margin:{top:10,right:30,left:0,bottom:0},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorLogins",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#8884d8",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#8884d8",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorCompletions",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),e.jsx("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})]})]}),e.jsx(me,{strokeDasharray:"3 3"}),e.jsx(ue,{dataKey:"date",tickFormatter:i=>Y(G(i),"MMM d")}),e.jsx(xe,{}),e.jsx(J,{labelFormatter:i=>Y(G(i),"MMMM d, yyyy")}),e.jsx(V,{}),e.jsx(K,{type:"monotone",dataKey:"logins",name:"Logins",stroke:"#8884d8",fillOpacity:1,fill:"url(#colorLogins)"}),e.jsx(K,{type:"monotone",dataKey:"completions",name:"Course Completions",stroke:"#82ca9d",fillOpacity:1,fill:"url(#colorCompletions)"})]})})})]})},fe=({teamId:l,teamName:d,onEnrollmentSuccess:p})=>{const{user:f}=L(),[g,c]=r.useState(null),[v,N]=r.useState([]),[w,y]=r.useState(!1),m="https://knowvara.com/api",u=r.useCallback(X(async a=>{var t,o;if(a.length<2){N([]);return}y(!0);try{const n=sessionStorage.getItem("token");if(!n){j.error("Authentication token is missing. Please log in again.");return}const A=(await b.get(`${m}/api/enrollments/search-courses`,{params:{q:a},headers:{Authorization:`Bearer ${n}`}})).data.courses.map(S=>({value:S.Id,label:S.Name}));N(A)}catch(n){if(console.error("Error fetching courses:",n),b.isAxiosError(n)){const C=n;(o=(t=C.response)==null?void 0:t.data)!=null&&o.error?j.error(C.response.data.error):j.error("Failed to fetch courses.")}else j.error("An unexpected error occurred while fetching courses.")}finally{y(!1)}},300),[m]);r.useEffect(()=>()=>{u.cancel()},[u]);const i=async()=>{var a,t;if(!g){j.error("Please select a course.");return}try{const o=sessionStorage.getItem("token");if(!o){j.error("Authentication token is missing. Please log in again.");return}await b.post(`${m}/api/enrollments/enroll-team`,{teamId:l,courseId:g.value},{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}}),console.log("Team enrolled successfully"),p(),j.success(`Team '${d}' enrolled successfully in course '${g.label}'.`),c(null),N([])}catch(o){if(console.error("Error enrolling team:",o),b.isAxiosError(o)){const n=o;(t=(a=n.response)==null?void 0:a.data)!=null&&t.error?j.error(n.response.data.error):j.error("Failed to enroll team.")}else j.error("An unexpected error occurred while enrolling the team.")}};return!f||f.Admin!=="y"?e.jsx("div",{children:"Access Denied. Admins only."}):e.jsxs("div",{className:"bg-white rounded shadow mb-2",children:[e.jsx("div",{className:"flex w-full p-2 subnav-gradient text-white",children:"Team Quick Enrollment"}),e.jsxs("div",{className:"flex items-center space-x-2 p-4 flex-wrap",children:[e.jsx("span",{children:"Enroll the team:"}),e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("div",{className:"p-2 border rounded bg-gray-100 font-semibold",children:d})}),e.jsx("span",{children:"in the course:"}),e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx(te,{value:g,onChange:a=>c(a),onInputChange:a=>{u(a)},options:v,isLoading:w,placeholder:"Search for a course...",noOptionsMessage:()=>"No courses found.",isClearable:!0})}),e.jsx("button",{onClick:i,className:"px-4 py-2 lms-button",children:"Go"})]})]})},ge=({teamId:l})=>{const{user:d}=L(),p=ae(),f=re(),[g,c]=r.useState([]),[v,N]=r.useState(""),[w,y]=r.useState(""),[m,u]=r.useState(""),[i,a]=r.useState(1),[t,o]=r.useState(10),[n,C]=r.useState({key:"FirstName",direction:"ascending"}),[A,S]=r.useState(0),T=()=>{S(s=>s+1)},E=s=>j.error(s),O=r.useCallback(async()=>{var x,k;const s=sessionStorage.getItem("token");if(!s){E("Authentication token is missing. Please log in again.");return}if(!(d!=null&&d.OrgID)){E("User organization ID is undefined.");return}try{const h=await b.get(`https://knowvara.com/api/api/auth/teams/${l}/members/details`,{headers:{Authorization:`Bearer ${s}`}});c(h.data);const D=await b.get(`https://knowvara.com/api/api/auth/teams/${l}/info`,{headers:{Authorization:`Bearer ${s}`}});N(D.data.name)}catch(h){if(b.isAxiosError(h)){const D=typeof((x=h.response)==null?void 0:x.data)=="string"?h.response.data:JSON.stringify((k=h.response)==null?void 0:k.data)||h.message;E(`Error fetching team data: ${D}`)}else E("Unexpected error fetching team data.");console.error("Error fetching team data:",h)}},[l,d]);r.useEffect(()=>{O()},[O]);const P=r.useCallback(X(s=>{u(s),a(1)},300),[]);r.useEffect(()=>()=>{P.cancel()},[P]);const H=s=>{y(s.target.value),P(s.target.value)},I=s=>{let x="ascending";n.key===s&&n.direction==="ascending"&&(x="descending"),C({key:s,direction:x});const k=[...g].sort((h,D)=>{const z=h[s]??"",B=D[s]??"";return z<B?x==="ascending"?-1:1:z>B?x==="ascending"?1:-1:0});c(k)},F=g.filter(s=>{const x=`${s.FirstName} ${s.LastName}`.toLowerCase(),k=s.Email.toLowerCase(),h=m.toLowerCase();return x.includes(h)||k.includes(h)}),$=t==="All"?1:Math.ceil(F.length/t),M=t==="All"?F.length:i*t,W=t==="All"?0:M-t,R=t==="All"?F:F.slice(W,M),Z=s=>{const x=s.target.value;o(x==="All"?"All":Number(x)),a(1)},ee=s=>{sessionStorage.setItem("origin",f.pathname+f.search),p(`/admin/person-form/${s}`)},se=s=>{sessionStorage.setItem("origin",f.pathname+f.search),p(`/student/transcript/${s}`)};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto",children:[e.jsxs("div",{className:"w-full md:w-1/2 p-4 md:border-r border-gray-300 mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:v||"Team Name"}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search by name or email...",value:w,onChange:H,className:"w-full md:w-64 px-4 py-2 mb-4 md:mb-0 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm",children:"Show:"}),e.jsxs("select",{value:t,onChange:Z,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>I("FirstName"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2"}),"First Name"]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>I("LastName"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2"}),"Last Name"]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm",children:"Email"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm w-8"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm w-8"})]})}),e.jsx("tbody",{children:R.length>0?R.map(s=>e.jsxs("tr",{className:"hover:bg-gray-100",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.FirstName}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.LastName}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.Email}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(ne,{size:20,className:"cursor-pointer lms-icon ",onClick:()=>se(s.Id),title:"Transcript","aria-label":"Edit User"})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(oe,{size:20,className:"cursor-pointer lms-icon ",onClick:()=>ee(s.Id),title:"Edit User","aria-label":"Edit User"})})]},s.Id)):e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"py-2 px-4 border-b border-gray-200 text-center text-gray-500",children:"No team members available"})})})]})}),$>1&&e.jsx("div",{className:"flex justify-center items-center mt-4 w-full",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>a(s=>Math.max(s-1,1)),disabled:i===1,className:`px-3 py-1 border rounded-md text-sm ${i===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:$},(s,x)=>x+1).map(s=>e.jsx("button",{onClick:()=>a(s),className:`px-3 py-1 border rounded-md text-sm ${i===s?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:s},s)),e.jsx("button",{onClick:()=>a(s=>Math.min(s+1,$)),disabled:i===$,className:`px-3 py-1 border rounded-md text-sm ${i===$?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]})})]}),e.jsxs("div",{className:"w-full md:w-1/2 p-4 flex flex-col space-y-4 md:space-y-0",children:[e.jsx("div",{className:"w-full",children:e.jsx(fe,{teamId:l,teamName:v,onEnrollmentSuccess:T})}),e.jsxs("div",{className:"w-full flex flex-row space-x-4",children:[e.jsx("div",{className:"w-full md:w-1/3",children:e.jsx(he,{teamId:l,refreshKey:A})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx(pe,{teamId:l})})]})]})]})},Ne=()=>{const{user:l}=L();return!l||!l.teamsAsLeader||l.teamsAsLeader.length===0?e.jsx("p",{children:"You are not leading any teams."}):e.jsx("div",{className:"team-leader",children:l.teamsAsLeader.map(d=>e.jsx("div",{className:"mb-6",children:e.jsx(ge,{teamId:d})},d))})};export{Ne as default};
