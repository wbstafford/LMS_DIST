import{t as B,c as C,r as a,j as e,a0 as O,a9 as z,e as i,B as b}from"./index-BzFnb_De.js";import{P as A}from"./PurchaseCourse-BIoGSjgU.js";const U=()=>{const{bundleId:n}=B(),{user:s}=C(),[u,I]=a.useState(null),[j,l]=a.useState(null),[y,h]=a.useState(!1),[x,m]=a.useState(null),[N,k]=a.useState(!1),[w,g]=a.useState(!0);if(a.useEffect(()=>{const t=async()=>{if(console.log("org ID: "+(s==null?void 0:s.OrgID)+" bundleId: "+n),!(s!=null&&s.OrgID)||!n){console.error("User OrgID or bundleId is missing.");return}const d=sessionStorage.getItem("token");if(!d){console.error("No token found, user is not authenticated.");return}try{console.log("Fetching bundle with ID:",n);const r=await i.get(`https://knowvara.com/api/api/bundles/${s.OrgID}/${n}`,{headers:{Authorization:`Bearer ${d}`}});console.log("Bundle fetched successfully:",r.data),I(r.data)}catch(r){console.error("Error fetching bundle:",r)}},o=async()=>{if(!(s!=null&&s.Id)||!n){console.error("User ID or bundleId is missing."),l(!1),g(!1);return}const d=sessionStorage.getItem("token");if(!d){console.error("No token found, user is not authenticated."),l(!1),g(!1);return}try{console.log("Checking enrollment for user ID:",s.Id,"and bundle ID:",n);const r=await i.get(`https://knowvara.com/api/api/bundles/${s.OrgID}/${n}/enrollment`,{headers:{Authorization:`Bearer ${d}`}});console.log("Enrollment check response:",r.data),r.data.enrolled?l(!0):l(!1)}catch(r){console.error("Error checking enrollment:",r),l(!1)}finally{g(!1)}};t(),o()},[s==null?void 0:s.OrgID,s==null?void 0:s.Id,n]),!u)return e.jsx("div",{children:"Loading bundle details..."});const{Name:v,Description:D,Price:c,ShortDescription:E,courses:f}=u,S=async()=>{if(k(!0),l(!0),m(null),s!=null&&s.Id&&n)try{const t=sessionStorage.getItem("token");if(!t)return;const o=await i.get(`https://knowvara.com/api/api/bundles/${s.OrgID}/${n}/enrollment`,{headers:{Authorization:`Bearer ${t}`}});o.data.enrolled&&console.log("Updated enrollment:",o.data.enrollment)}catch(t){console.error("Error fetching updated enrollment:",t)}},P=()=>{m("The payment could not be processed. Please try again.")},$=async()=>{if(!(s!=null&&s.Id)||!n){console.error("User ID or bundleId is missing.");return}const t=sessionStorage.getItem("token");if(!t){console.error("No token found, user is not authenticated.");return}try{const o=await i.post(`https://knowvara.com/api/api/bundles/${s.OrgID}/${n}/enroll`,{dueDate:null},{headers:{Authorization:`Bearer ${t}`}});console.log("Enrollment response:",o.data),l(!0),b.success("Successfully enrolled in the bundle!")}catch(o){console.error("Error enrolling in bundle:",o),m("Enrollment failed. Please try again."),b.error("Enrollment failed. Please try again.")}},p=t=>t!=null;return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsx("div",{className:"flex flex-col items-start w-full md:w-1/4 border-r border-gray-300 p-2 shadow-xl",children:e.jsxs("div",{className:"p-3 w-full",children:[e.jsx(O,{courses:f,imgHeight:96}),e.jsx("p",{className:"mt-4 text-gray-600",children:E})]})}),e.jsxs("div",{className:"md:w-3/4 p-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:v}),e.jsx("div",{className:"mt-4 text-gray-700",dangerouslySetInnerHTML:{__html:D}}),e.jsx("div",{className:"mt-6",children:w?e.jsx("div",{children:"Checking enrollment status..."}):j?e.jsx("p",{className:"text-green-600 font-semibold",children:"You are already enrolled in this bundle."}):s!=null&&s.ecommerce&&p(c)&&c>0?e.jsxs("div",{className:"mt-4 p-5 border rounded-lg shadow w-64 items-center text-center",children:[e.jsxs("p",{className:"text-xl",children:["Price: $",c.toFixed(2)]}),e.jsx("button",{onClick:()=>h(!0),className:"py-2 px-4 lms-button text-white rounded-md mt-2",children:"Purchase Now"})]}):e.jsx("button",{onClick:$,className:"py-2 px-4 lms-button",children:"Enroll In This Bundle"})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 mb-4",children:"Courses in this Bundle"}),e.jsx(z,{courses:f})]})]}),y&&p(c)&&c>0&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:e.jsx("div",{className:"bg-white rounded-lg p-6 w-11/12 md:w-1/3",children:N?e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Congratulations! You have successfully purchased this bundle."}),e.jsx("button",{onClick:()=>h(!1),className:"py-2 px-4 bg-green-500 text-white rounded-md",children:"Close"})]}):e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"Purchase Bundle"}),x&&e.jsx("div",{className:"mb-2 text-red-600",children:x}),e.jsx(A,{courseId:Number(n),orgId:u.OrgID,amount:c,onSuccess:S,onFailure:P,isBundle:!0}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:()=>h(!1),className:"py-2 px-4 bg-gray-300 text-black rounded-md mr-2",children:"Cancel"})})]})})})]})};export{U as default};
