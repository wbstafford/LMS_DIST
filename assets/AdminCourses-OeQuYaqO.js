import{c as te,d as re,r as s,w as ne,j as e,ap as ae,af as K,ah as oe,aq as le,B as u,f as G,M as fe,A as we,al as de,am as ue,ar as me}from"./index-BSiKmnSf.js";/* empty css              */const Se=()=>{const{user:r}=te(),A=re(),[N,b]=s.useState([]),[z,H]=s.useState({key:"name",direction:"ascending"}),[j,m]=s.useState(""),[M,L]=s.useState(!1),[v,D]=s.useState(!1),[p,$]=s.useState(""),[d,f]=s.useState(1),[l,w]=s.useState(10),[g,y]=s.useState(1),[E,P]=s.useState(!1),[C,B]=s.useState(null),I=ne(n=>{$(n),f(1)},300);s.useEffect(()=>()=>{I.cancel()},[]);const V=async()=>{const n=sessionStorage.getItem("token");if(!n){m("Authentication token is missing. Please log in again."),u.error("Authentication token is missing. Please log in again.");return}if(!(r!=null&&r.OrgID)){m("User organization ID is undefined."),u.error("User organization ID is undefined.");return}L(!0),m("");try{const a=(await G.get("https://knowvara.com/api/api/learning-plans",{headers:{Authorization:`Bearer ${n}`},params:{search:p,page:d,limit:l,orgId:r.OrgID}})).data;a&&Array.isArray(a.data)?(b(a.data),y(a.totalPages)):(console.error("Fetched Learning Plans data is not valid"),b([]),y(1))}catch(x){console.error("Error fetching Learning Plans:",x),b([]),y(1),m("Failed to fetch Learning Plans."),u.error("Failed to fetch Learning Plans.")}finally{L(!1)}};s.useEffect(()=>{V()},[p,d,l]);const S=s.useMemo(()=>N.filter(n=>n.name.toLowerCase().includes(p.toLowerCase())||n.description&&n.description.toLowerCase().includes(p.toLowerCase())||n.objective&&n.objective.toLowerCase().includes(p.toLowerCase())),[N,p]);s.useEffect(()=>{y(l==="All"?1:Math.ceil(S.length/l)),f(1)},[S,l]);const R=s.useMemo(()=>{if(l==="All")return S;const n=d*l,x=n-l;return S.slice(x,n)},[S,d,l]),W=n=>{let x="ascending";z.key===n&&z.direction==="ascending"&&(x="descending"),H({key:n,direction:x});const a=[...S].sort((h,X)=>{var se,U;const F=((se=h[n])==null?void 0:se.toString().toLowerCase())||"",O=((U=X[n])==null?void 0:U.toString().toLowerCase())||"";return F<O?x==="ascending"?-1:1:F>O?x==="ascending"?1:-1:0});b(a)},J=async n=>{const x=sessionStorage.getItem("token");if(!x){console.error("No token found"),m("Authentication token is missing. Please log in again."),u.error("Authentication token is missing. Please log in again.");return}D(!0);try{await G.delete(`https://knowvara.com/api/api/learning-plans/${n}`,{headers:{Authorization:`Bearer ${x}`}}),b(N.filter(a=>a.id!==n)),u.success("Learning Plan deleted successfully.")}catch(a){console.error("Error deleting Learning Plan:",a),m("Failed to delete Learning Plan."),u.error("Failed to delete Learning Plan.")}finally{D(!1),P(!1),B(null)}},Q=n=>{const x=n.target.value;if(x==="All")w("All"),y(1);else{const a=Number(x);w(a),y(Math.ceil(S.length/a))}f(1)},q=n=>{I(n.target.value)},o=()=>{A("/admin/learning-plan-form")},i=n=>{A(`/admin/learning-plan-form/${n}`)};return e.jsxs("div",{className:"pb-6",children:[" ",e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-4",children:[e.jsx("input",{type:"text",placeholder:"Search learning plans...",onChange:q,className:"w-64 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm ml-2",children:"Show:"}),e.jsxs("select",{value:l,onChange:Q,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:25,children:"25"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),e.jsxs("button",{className:"flex items-center px-4 py-2 lms-button text-xs",onClick:o,children:[e.jsx(ae,{className:"mr-2"}),"Create Learning Plan"]})]}),j&&e.jsx("div",{className:"mb-4 text-red-500",children:j}),M?e.jsx("div",{children:"Loading Learning Plans..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>W("name"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Name"]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>W("objective"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Objective"]})}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-center text-sm"}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-center text-sm"})]})}),e.jsx("tbody",{children:R.length>0?R.map((n,x)=>e.jsxs("tr",{className:x%2===0?"bg-gray-50":"",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer",onClick:()=>i(n.id),children:n.name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:n.objective||"N/A"}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(oe,{size:18,className:"cursor-pointer lms-icon",onClick:()=>i(n.id),title:"Edit Learning Plan","aria-label":"Edit Learning Plan"})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(le,{size:18,className:"cursor-pointer lms-icon",onClick:()=>{B(n.id),P(!0)},title:"Delete Learning Plan","aria-label":"Delete Learning Plan"})})]},n.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No Learning Plans available"})})})]})}),g>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>f(n=>Math.max(n-1,1)),disabled:d===1,className:`px-2 py-1 text-sm border rounded-md ${d===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:g},(n,x)=>x+1).map(n=>e.jsx("button",{onClick:()=>f(n),className:`px-2 py-1 text-sm border rounded-md ${d===n?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:n},n)),e.jsx("button",{onClick:()=>f(n=>Math.min(n+1,g)),disabled:d===g,className:`px-2 py-1 text-sm border rounded-md ${d===g?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]}),E&&C!==null&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",role:"dialog","aria-modal":"true","aria-labelledby":"delete-lp-modal-title",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md",role:"document",children:[e.jsx("h2",{id:"delete-lp-modal-title",className:"text-xl font-semibold mb-4",children:"Confirm Deletion"}),e.jsx("p",{children:"Are you sure you want to delete this Learning Plan? This action cannot be undone."}),j&&e.jsx("div",{className:"mt-4 text-red-500",children:j}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{className:`bg-red-600 text-white px-4 py-2 rounded mr-2 hover:bg-red-700 ${v?"opacity-50 cursor-not-allowed":""}`,onClick:()=>J(C),disabled:v,children:v?"Deleting...":"Yes, Delete"}),e.jsx("button",{className:"bg-gray-300 text-black px-4 py-2 rounded hover:bg-gray-400",onClick:()=>{P(!1),B(null),m("")},disabled:v,children:"Cancel"})]})]})})]})},Pe=()=>{const{user:r}=te(),A=re(),[N,b]=s.useState([]),[z,H]=s.useState(!1),[j,m]=s.useState(""),[M,L]=s.useState(!1),[v,D]=s.useState(null),[p,$]=s.useState(""),[d,f]=s.useState(""),[l,w]=s.useState(1),[g,y]=s.useState(15),[E,P]=s.useState(1),[C,B]=s.useState(null),T=s.useMemo(()=>ne(a=>{f(a),w(1)},300),[]);s.useEffect(()=>()=>{T.cancel()},[T]);const I=a=>{$(a.target.value),T(a.target.value)},V=a=>{const h=a.target.value;y(h==="All"?"All":Number(h)),w(1)},S=async()=>{const a=sessionStorage.getItem("token");if(!a||!(r!=null&&r.OrgID)){u.error("Authentication token is missing or user is not authenticated.");return}H(!0),m("");try{const h=await G.get(`https://knowvara.com/api/api/certificates/${r.OrgID}`,{headers:{Authorization:`Bearer ${a}`}});b(h.data)}catch(h){console.error("Error fetching certificates:",h),m("Failed to fetch certificates."),u.error("Failed to fetch certificates.")}finally{H(!1)}};s.useEffect(()=>{r!=null&&r.OrgID&&S()},[r==null?void 0:r.OrgID]);const R=a=>{D(a),L(!0)},W=async()=>{if(!v)return;const a=sessionStorage.getItem("token");if(!a){u.error("Authentication token is missing."),L(!1),D(null);return}try{await G.delete(`https://knowvara.com/api/api/certificates/${v.id}`,{headers:{Authorization:`Bearer ${a}`}}),u.success("Certificate deleted successfully."),S()}catch(h){console.error("Error deleting certificate:",h),u.error("Failed to delete certificate.")}finally{L(!1),D(null)}},J=()=>{L(!1),D(null)},Q=a=>{A(`/admin/certificate-form/${a}`)},q=()=>{A("/admin/certificate-form")},o=s.useMemo(()=>N.filter(a=>a.name.toLowerCase().includes(d.toLowerCase())),[N,d]),i=s.useMemo(()=>C!==null?[...o].sort((h,X)=>{const F=h[C.key],O=X[C.key];return typeof F=="string"&&typeof O=="string"?F.toLowerCase()<O.toLowerCase()?C.direction==="ascending"?-1:1:F.toLowerCase()>O.toLowerCase()?C.direction==="ascending"?1:-1:0:0}):o,[o,C]);s.useEffect(()=>{P(g==="All"?1:Math.ceil(i.length/g))},[i,g]);const n=s.useMemo(()=>{if(g==="All")return i;const a=l*g,h=a-g;return i.slice(h,a)},[i,l,g]),x=a=>{let h="ascending";C&&C.key===a&&C.direction==="ascending"&&(h="descending"),B({key:a,direction:h})};return e.jsxs("div",{className:"mt-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex flex-row items-center space-x-4",children:[e.jsx("input",{type:"text",placeholder:"Search certificates by name...",value:p,onChange:I,className:"w-64 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm",children:"Show:"}),e.jsxs("select",{value:g,onChange:V,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),e.jsxs("button",{onClick:q,className:"flex items-center px-4 py-2 lms-button text-xs",children:[e.jsx(ae,{className:"mr-2"}),"Create Certificate"]})]}),z?e.jsx("div",{children:"Loading certificates..."}):j?e.jsx("div",{className:"text-red-500",children:j}):e.jsxs(e.Fragment,{children:[o.length===0?e.jsx("div",{children:"No certificates found."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>x("name"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Name"]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm",children:"Description"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm",children:"Actions"})]})}),e.jsx("tbody",{children:n.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:a.name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:a.description}),e.jsxs("td",{className:"py-2 px-4 border-b border-gray-200 w-24",children:[e.jsx("button",{onClick:()=>Q(a.id),className:"text-blue-600 hover:text-blue-800 mr-2",title:"Edit Certificate",children:e.jsx(oe,{size:18,className:"cursor-pointer lms-icon"})}),e.jsx("button",{onClick:()=>R(a),className:"text-red-600 hover:text-red-800",title:"Delete Certificate",children:e.jsx(le,{size:18,className:"cursor-pointer lms-icon"})})]})]},a.id))})]})}),E>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>w(a=>Math.max(a-1,1)),disabled:l===1,className:`px-2 py-1 text-sm border rounded-md ${l===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:E},(a,h)=>h+1).map(a=>e.jsx("button",{onClick:()=>w(a),className:`px-2 py-1 text-sm border rounded-md ${l===a?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:a},a)),e.jsx("button",{onClick:()=>w(a=>Math.min(a+1,E)),disabled:l===E,className:`px-2 py-1 text-sm border rounded-md ${l===E?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]})]}),M&&v&&e.jsx(fe,{title:"Delete Certificate",onClose:J,onConfirm:W,children:e.jsxs("p",{children:["Are you sure you want to delete the certificate"," ",e.jsx("strong",{children:v.name}),"?"]})})]})},Ie=()=>{const{user:r}=te(),A=re(),[N,b]=s.useState([]),[z,H]=s.useState({key:"Name",direction:"ascending"}),[j,m]=s.useState(""),[M,L]=s.useState(!1),[v,D]=s.useState(""),[p,$]=s.useState(1),[d,f]=s.useState(15),[l,w]=s.useState(1),[g,y]=s.useState(!1),[E,P]=s.useState(null),B=ne(o=>{D(o),$(1)},300);s.useEffect(()=>()=>{B.cancel()},[]);const T=async()=>{const o=sessionStorage.getItem("token");if(!o){m("Authentication token is missing. Please log in again."),u.error("Authentication token is missing. Please log in again.");return}if(!(r!=null&&r.OrgID)){m("User organization ID is undefined."),u.error("User organization ID is undefined.");return}L(!0),m("");try{const i=await G.get(`https://knowvara.com/api/api/bundles/${r.OrgID}`,{headers:{Authorization:`Bearer ${o}`}});console.log("Fetched bundles:",i.data),Array.isArray(i.data)?b(i.data):(console.error("Fetched data is not an array"),b([]))}catch(i){console.error("Error fetching bundles:",i),b([]),m("Failed to fetch bundles."),u.error("Failed to fetch bundles.")}finally{L(!1)}};s.useEffect(()=>{r!=null&&r.OrgID&&T()},[r==null?void 0:r.OrgID]);const I=s.useMemo(()=>N.filter(o=>o.Name.toLowerCase().includes(v.toLowerCase())),[N,v]);s.useEffect(()=>{w(d==="All"?1:Math.ceil(I.length/d)),$(1)},[I,d]);const V=s.useMemo(()=>{if(d==="All")return I;const o=p*d,i=o-d;return I.slice(i,o)},[I,p,d]),S=o=>{let i="ascending";z.key===o&&z.direction==="ascending"&&(i="descending"),H({key:o,direction:i});const n=[...I].sort((x,a)=>{var F,O;const h=((F=x[o])==null?void 0:F.toString().toLowerCase())||"",X=((O=a[o])==null?void 0:O.toString().toLowerCase())||"";return h<X?i==="ascending"?-1:1:h>X?i==="ascending"?1:-1:0});b(n)},R=async o=>{const i=sessionStorage.getItem("token");if(!i){console.error("No token found"),m("Authentication token is missing. Please log in again."),u.error("Authentication token is missing. Please log in again.");return}try{await G.delete(`https://knowvara.com/api/api/bundles/${r==null?void 0:r.OrgID}/${o}`,{headers:{Authorization:`Bearer ${i}`}}),b(N.filter(n=>n.Id!==o)),u.success("Bundle deleted successfully.")}catch(n){console.error("Error deleting bundle:",n),m("Failed to delete bundle."),u.error("Failed to delete bundle.")}finally{y(!1),P(null)}},W=o=>{const i=o.target.value;if(i==="All")f("All"),w(1);else{const n=Number(i);f(n),w(Math.ceil(I.length/n))}$(1)},J=o=>{B(o.target.value)},Q=()=>{A("/admin/bundle-form")},q=o=>{A(`/admin/bundle-form/${o}`)};return e.jsx("div",{className:"flex flex-col h-auto",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex flex-row justify-between items-center mb-2",children:[e.jsx("input",{type:"text",placeholder:"Search bundles by name...",onChange:J,className:"w-64 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm ml-2",children:"Show:"}),e.jsxs("select",{value:d,onChange:W,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),e.jsxs("button",{className:"flex items-center px-4 py-2 lms-button text-xs",onClick:Q,children:[e.jsx(ae,{className:"mr-2"}),"Create New Bundle"]})]}),j&&e.jsx("div",{className:"mb-4 text-red-500",children:j}),M?e.jsx("div",{children:"Loading bundles..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>S("Name"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Name"]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm",children:"Short Description"}),(r==null?void 0:r.ecommerce)&&e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>S("Price"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Price"]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm w-28",children:"# Courses"}),e.jsx("th",{className:"py-2 px-2 border-b border-gray-200 text-center text-sm"}),e.jsx("th",{className:"py-2 px-2 border-b border-gray-200 text-center text-sm"})]})}),e.jsx("tbody",{children:V.length>0?V.map((o,i)=>{var n;return e.jsxs("tr",{className:i%2===0?"bg-gray-50":"",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer",onClick:()=>q(o.Id),children:o.Name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:o.ShortDescription}),(r==null?void 0:r.ecommerce)&&e.jsxs("td",{className:"py-2 px-4 border-b border-gray-200 text-center",children:["$",(n=o.Price)==null?void 0:n.toFixed(2)]}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 text-center",children:o.courses.length}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(oe,{size:18,className:"cursor-pointer lms-icon",onClick:()=>q(o.Id),title:"Edit Bundle","aria-label":"Edit Bundle"})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(le,{size:18,className:"cursor-pointer lms-icon",onClick:()=>{P(o.Id),y(!0)},title:"Delete Bundle","aria-label":"Delete Bundle"})})]},o.Id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No bundles available"})})})]})}),l>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>$(o=>Math.max(o-1,1)),disabled:p===1,className:`px-2 py-1 text-sm border rounded-md ${p===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:l},(o,i)=>i+1).map(o=>e.jsx("button",{onClick:()=>$(o),className:`px-2 py-1 text-sm border rounded-md ${p===o?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:o},o)),e.jsx("button",{onClick:()=>$(o=>Math.min(o+1,l)),disabled:p===l,className:`px-2 py-1 text-sm border rounded-md ${p===l?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]}),g&&E!==null&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-50",role:"dialog","aria-modal":"true","aria-labelledby":"delete-bundle-modal-title",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-11/12 max-w-md",role:"document",children:[e.jsx("h2",{id:"delete-bundle-modal-title",className:"text-xl font-semibold mb-4",children:"Confirm Deletion"}),e.jsx("p",{children:"Are you sure you want to delete this bundle? This action cannot be undone."}),j&&e.jsx("div",{className:"mt-4 text-red-500",children:j}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{className:`bg-red-600 text-white px-4 py-2 rounded mr-2 hover:bg-red-700 ${M?"opacity-50 cursor-not-allowed":""}`,onClick:()=>R(E),disabled:M,children:M?"Deleting...":"Yes, Delete"}),e.jsx("button",{className:"bg-gray-300 text-black px-4 py-2 rounded hover:bg-gray-400",onClick:()=>{y(!1),P(null),m("")},disabled:M,children:"Cancel"})]})]})})]})})},ke=()=>{const{user:r}=te(),A=re(),[N,b]=s.useState([]),[z,H]=s.useState({key:"Name",direction:"ascending"}),[j,m]=s.useState(""),[M,L]=s.useState(!1),[v,D]=s.useState(!1),[p,$]=s.useState(""),[d,f]=s.useState(1),[l,w]=s.useState(12),[g,y]=s.useState(1),[E,P]=s.useState(!1),[C,B]=s.useState(null),[T,I]=s.useState(!1),[V,S]=s.useState(!1),[R,W]=s.useState(!1),[J,Q]=s.useState([]),[q,o]=s.useState(""),[i,n]=s.useState(!1),x=()=>{I(t=>!t)},a=()=>{S(t=>!t)},h=()=>{W(t=>!t)},F=ne(t=>{$(t),f(1)},300);s.useEffect(()=>()=>{F.cancel()},[]);const O=async()=>{const t=sessionStorage.getItem("token");if(!t){o("Authentication token is missing. Please log in again."),u.error("Authentication token is missing. Please log in again.");return}if(!(r!=null&&r.OrgID)){o("User organization ID is undefined."),u.error("User organization ID is undefined.");return}n(!0),o("");try{const c=await G.get(`https://knowvara.com/api/api/courses/${r.OrgID}/recently-edited`,{headers:{Authorization:`Bearer ${t}`}});console.log("recent data: ",c.data),Q(c.data)}catch(c){console.error("Error fetching recent courses:",c),o("Failed to fetch recently edited courses."),u.error("Failed to fetch recently edited courses.")}finally{n(!1)}};s.useEffect(()=>{r!=null&&r.OrgID&&O()},[A,r==null?void 0:r.OrgID]);const se=async()=>{const t=sessionStorage.getItem("token");if(!t){m("Authentication token is missing. Please log in again."),u.error("Authentication token is missing. Please log in again.");return}if(!(r!=null&&r.OrgID)){m("User organization ID is undefined."),u.error("User organization ID is undefined.");return}L(!0),m("");try{const c=await G.get(`https://knowvara.com/api/api/courses/${r.OrgID}`,{headers:{Authorization:`Bearer ${t}`}});console.log("Fetched courses:",c.data),Array.isArray(c.data)?b(c.data):(console.error("Fetched data is not an array"),b([]))}catch(c){console.error("Error fetching courses:",c),b([]),m("Failed to fetch courses."),u.error("Failed to fetch courses.")}finally{L(!1)}};s.useEffect(()=>{r!=null&&r.OrgID&&se()},[r==null?void 0:r.OrgID]);const U=s.useMemo(()=>N.filter(t=>t.Name.toLowerCase().includes(p.toLowerCase())),[N,p]);s.useEffect(()=>{y(l==="All"?1:Math.ceil(U.length/l)),f(1)},[U,l]);const xe=s.useMemo(()=>{if(l==="All")return U;const t=(d-1)*l,c=t+l;return U.slice(t,c)},[U,d,l]),ie=t=>{let c="ascending";z.key===t&&z.direction==="ascending"&&(c="descending"),H({key:t,direction:c});const k=[...U].sort((_,Z)=>{var be,pe;const ee=_[t]==="y"?1:_[t]==="n"?0:((be=_[t])==null?void 0:be.toString().toLowerCase())||"",Y=Z[t]==="y"?1:Z[t]==="n"?0:((pe=Z[t])==null?void 0:pe.toString().toLowerCase())||"";return ee<Y?c==="ascending"?-1:1:ee>Y?c==="ascending"?1:-1:0});b(k)},je=async(t,c)=>{const k=sessionStorage.getItem("token");if(!k){console.error("No token found");return}const _=N.find(Y=>Y.Id===t);if(!_)return;const Z=r==null?void 0:r.OrgID,ee=_[c]==="y"?"n":"y";try{await G.patch(`https://knowvara.com/api/api/courses/${Z}/${t}`,{[c]:ee},{headers:{Authorization:`Bearer ${k}`}}),b(N.map(Y=>Y.Id===t?{...Y,[c]:ee}:Y)),u.success(`Course ${c} status updated successfully.`)}catch(Y){console.error("Error updating course:",Y),u.error("Failed to update course status.")}},ye=async t=>{const c=sessionStorage.getItem("token");if(!c){console.error("No token found"),m("Authentication token is missing. Please log in again."),u.error("Authentication token is missing. Please log in again.");return}D(!0);try{await G.delete(`https://knowvara.com/api/api/courses/${t}`,{headers:{Authorization:`Bearer ${c}`}}),b(N.filter(k=>k.Id!==t)),u.success("Course deleted successfully.")}catch(k){console.error("Error deleting course:",k),m("Failed to delete course."),u.error("Failed to delete course.")}finally{D(!1),P(!1),B(null)}},Ne=t=>{const c=t.target.value;if(c==="All")w("All"),y(1);else{const k=Number(c);w(k),y(Math.ceil(U.length/k))}f(1)},Ce=t=>{F(t.target.value)},ve=()=>{A("/admin/course-form")},ce=t=>{A(`/admin/course-form/${t}`)},[he,ge]=s.useState({});return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsxs("div",{className:"flex flex-col w-full md:w-3/5 p-4 md:border-r border-gray-300",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-600",children:"Courses"}),e.jsxs("button",{className:"flex items-center px-4 py-2 lms-button text-sm",onClick:ve,children:[e.jsx(ae,{className:"mr-2"}),"Create New Course"]})]}),j&&e.jsx("div",{className:"mb-3 text-red-500",children:j}),e.jsxs("div",{className:"flex flex-row justify-between items-center mb-3",children:[e.jsx("input",{type:"text",placeholder:"Search courses by name...",onChange:Ce,className:"w-64 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm",children:"Show:"}),e.jsxs("select",{value:l,onChange:Ne,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:12,children:"12"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),M?e.jsx("div",{children:"Loading courses..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"hidden sm:table-cell w-28 py-2 px-4 border-b border-gray-200",style:{minWidth:"26px"}}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>ie("Name"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Name"]})}),(r==null?void 0:r.ecommerce)&&e.jsx("th",{className:"w-24 py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>ie("Price"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"mr-2"}),"Price"]})}),e.jsx("th",{className:"w-24 py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>ie("Activated"),children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(K,{className:"mr-2"}),"Active"]})}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-center text-sm"}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-center text-sm"})]})}),e.jsx("tbody",{children:xe.length>0?xe.map((t,c)=>{var k;return e.jsxs("tr",{className:c%2===0?"bg-gray-50":"",children:[e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 hidden sm:table-cell",children:e.jsxs("div",{className:"relative w-28 h-14 object-cover rounded cursor-pointer",children:[!he[t.Id]&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"loader"})}),e.jsx("img",{src:t.ImageURL||"/GenericCourseIcon.webp",alt:`Course image for ${t.Name}`,loading:"lazy",className:`w-full h-full object-cover transition-opacity rounded duration-500 ${he[t.Id]?"opacity-100":"opacity-0"}`,onLoad:()=>{ge(_=>({..._,[t.Id]:!0}))},onError:_=>{const Z=_.target;Z.src="/GenericCourseIcon.webp",ge(ee=>({...ee,[t.Id]:!0}))}})]})}),e.jsxs("td",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer",onClick:()=>ce(t.Id),children:[e.jsx("div",{className:"text-md font-semibold text-gray-800",children:t.Name}),e.jsx("div",{className:"hidden lg:block text-xs",children:t.ShortDescription})]}),(r==null?void 0:r.ecommerce)&&e.jsxs("td",{className:"w-24 py-2 px-4 border-b border-gray-200 text-center",children:["$",(k=t.Price)==null?void 0:k.toFixed(2)]}),e.jsx("td",{className:"w-24 py-2 px-4 border-b border-gray-200 text-center",children:e.jsx("div",{className:"ml-10",children:e.jsx("input",{type:"checkbox",checked:t.Activated==="y",onChange:()=>je(t.Id,"Activated"),className:"custom-checkbox"})})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(oe,{size:18,className:"cursor-pointer lms-icon",onClick:()=>ce(t.Id),title:"Edit Course","aria-label":"Edit Course"})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(le,{size:18,className:"cursor-pointer lms-icon",onClick:()=>{B(t.Id),P(!0)},title:"Delete Course","aria-label":"Delete Course"})})]},t.Id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:r!=null&&r.ecommerce?6:5,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No courses available"})})})]})}),g>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>f(t=>Math.max(t-1,1)),disabled:d===1,className:`px-2 py-1 text-sm border rounded-md ${d===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:g},(t,c)=>c+1).map(t=>e.jsx("button",{onClick:()=>f(t),className:`px-2 py-1 text-sm border rounded-md ${d===t?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:t},t)),e.jsx("button",{onClick:()=>f(t=>Math.min(t+1,g)),disabled:d===g,className:`px-2 py-1 text-sm border rounded-md ${d===g?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]}),e.jsx(we,{children:E&&C!==null&&e.jsxs(fe,{title:"Confirm Deletion",onClose:()=>{P(!1),B(null),m("")},onConfirm:()=>ye(C),confirmText:v?"Deleting...":"Yes, Delete",isConfirmDisabled:v,singleButton:!1,widthClassName:"max-w-md",children:[e.jsx("p",{children:"Are you sure you want to delete this course? This action cannot be undone."}),j&&e.jsx("div",{className:"mt-4 text-red-500",children:j})]})})]}),e.jsxs("div",{className:"w-full md:w-2/5 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-600",children:"Additional Content"}),e.jsx("hr",{className:"mb-4"}),e.jsx("div",{className:"mt-1",children:e.jsx("button",{type:"button",onClick:a,className:"flex items-center text-lg font-semibold text-gray-600  mb-1 border w-full p-2","aria-expanded":V,"aria-controls":"assign-to-certificates",children:V?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"ml-1 mr-2"})," Certificates"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"ml-1 mr-2"})," Certificates"]})})}),e.jsx(me.Collapse,{isOpened:V,theme:{collapse:"ReactCollapse--collapse"},children:e.jsx("div",{id:"assign-to-certificates",className:"mb-6 border w-full rounded-lg p-4 bg-gray-50",children:e.jsx(Pe,{})})}),e.jsx("div",{className:"mt-1",children:e.jsx("button",{type:"button",onClick:x,className:"flex items-center text-lg font-semibold text-gray-600  mb-1 border w-full p-2","aria-expanded":T,"aria-controls":"assign-to-lps",children:T?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"ml-1 mr-2"})," Learning Plans"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"ml-1 mr-2"})," Learning Plans"]})})}),e.jsx(me.Collapse,{isOpened:T,theme:{collapse:"ReactCollapse--collapse"},children:e.jsx("div",{id:"assign-to-lps",className:"mb-6 border w-full rounded-lg p-4 bg-gray-50",children:e.jsx(Se,{})})}),e.jsx("div",{className:"mt-1",children:e.jsx("button",{type:"button",onClick:h,className:"flex items-center text-lg font-semibold text-gray-600  mb-1 border w-full p-2","aria-expanded":R,"aria-controls":"assign-to-bundles",children:R?e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"ml-1 mr-2"})," Bundles"]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"ml-1 mr-2"})," Bundles"]})})}),e.jsx(me.Collapse,{isOpened:R,theme:{collapse:"ReactCollapse--collapse"},children:e.jsx("div",{id:"assign-to-bundles",className:"mb-6 border w-full rounded-lg p-4 bg-gray-50",children:e.jsx(Ie,{})})}),e.jsxs("div",{className:"mt-6 p-3 rounded-lg border shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-600",children:"Recently Edited Courses"}),i?e.jsx("div",{children:"Loading recently edited courses..."}):q?e.jsx("div",{className:"text-red-500",children:q}):J.length>0?e.jsx("ul",{className:"space-y-2",children:J.map(t=>e.jsxs("li",{className:"flex justify-between items-center bg-white border-b pb-1",children:[e.jsx("span",{children:t.Name}),e.jsx("button",{onClick:()=>ce(t.Id),className:"px-2 py-1 text-white rounded text-xs lms-button",children:"Edit"})]},t.Id))}):e.jsx("div",{children:"No recently edited courses."})]})]})]})},De=()=>e.jsx("div",{className:"p-0",children:e.jsx(ke,{})});export{De as default};
