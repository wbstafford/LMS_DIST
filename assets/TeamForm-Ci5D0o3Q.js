import{c as Me,d as Te,v as Oe,r,w as xe,j as e,B as d,f as h}from"./index-BEzWJCG4.js";/* empty css              */const Re=()=>{const{user:i,refreshUser:ge}=Me(),q=Te(),{teamId:x}=Oe(),[F,R]=r.useState(""),[H,W]=r.useState(""),[G,J]=r.useState([]),[K,pe]=r.useState(""),[Q,E]=r.useState([]),[b,f]=r.useState(1),[m,V]=r.useState(15),[y,be]=r.useState("firstName"),[g,X]=r.useState("asc"),[U,Y]=r.useState(new Set),[D,Z]=r.useState(new Set),[ee,M]=r.useState([]),[se,k]=r.useState([]),[te,fe]=r.useState(""),[N,j]=r.useState(1),[u,re]=r.useState(15),[T,ae]=r.useState(new Set),[O,ye]=r.useState("name"),[C,oe]=r.useState("asc"),[S,w]=r.useState(!1),[ne,c]=r.useState(""),[v,z]=r.useState(1),[A,L]=r.useState(1),ie=xe(s=>{pe(s),f(1)},300),ce=xe(s=>{fe(s),j(1)},300);r.useEffect(()=>()=>{ie.cancel(),ce.cancel()},[]);const Ne=async()=>{var t;const s=sessionStorage.getItem("token");if(!s){c("Authentication token is missing. Please log in again."),d.error("Authentication token is missing. Please log in again.");return}if(!(i!=null&&i.OrgID)){c("User organization ID is undefined."),d.error("User organization ID is undefined.");return}w(!0),c("");try{const a=(await h.get(`https://knowvara.com/api/api/auth/org/${i.OrgID}/users`,{headers:{Authorization:`Bearer ${s}`}})).data.map(n=>({...n,Id:String(n.Id)}));J(a),E(a),z(m==="All"?1:Math.ceil(a.length/m))}catch(o){if(h.isAxiosError(o)){const a=((t=o.response)==null?void 0:t.data)||o.message;c(`Error fetching users: ${a}`),d.error(`Error fetching users: ${a}`)}else c("Unexpected error fetching users."),d.error("Unexpected error fetching users.");J([]),E([]),z(1)}finally{w(!1)}},je=async()=>{const s=sessionStorage.getItem("token");if(!s){console.error("No token found");return}try{const t=await h.get(`https://knowvara.com/api/api/courses/${i==null?void 0:i.OrgID}`,{headers:{Authorization:`Bearer ${s}`}});console.log("Fetched courses:",t.data),Array.isArray(t.data)?(M(t.data),k(t.data),L(u==="All"?1:Math.ceil(t.data.length/u))):(console.error("Fetched data is not an array"),M([]),k([]),L(1))}catch(t){console.error("Error fetching courses:",t),M([]),k([]),L(1)}},we=async s=>{var o;const t=sessionStorage.getItem("token");if(!t){c("Authentication token is missing. Please log in again."),d.error("Authentication token is missing. Please log in again.");return}if(!(i!=null&&i.OrgID)){c("User organization ID is undefined."),d.error("User organization ID is undefined.");return}w(!0),c("");try{const a=await h.get(`https://knowvara.com/api/api/auth/teams/${s}`,{headers:{Authorization:`Bearer ${t}`}});R(a.data.name),W(a.data.description||"");const n=await h.get(`https://knowvara.com/api/api/auth/teams/${s}/members`,{headers:{Authorization:`Bearer ${t}`}}),p=new Set,l=new Set;n.data.forEach(_=>{const he=String(_.user_id);_.is_member&&p.add(he),_.is_leader&&l.add(he)}),Y(p),Z(l);const I=await h.get(`https://knowvara.com/api/api/auth/teams/${s}/courses`,{headers:{Authorization:`Bearer ${t}`}}),De=new Set(I.data);ae(De)}catch(a){if(h.isAxiosError(a)){const n=((o=a.response)==null?void 0:o.data)||a.message;c(`Error fetching team details: ${n}`),d.error(`Error fetching team details: ${n}`)}else c("Unexpected error fetching team details."),d.error("Unexpected error fetching team details.")}finally{w(!1)}};r.useEffect(()=>{i!=null&&i.OrgID&&(Ne(),je(),x&&we(x))},[i==null?void 0:i.OrgID,x]);const Ce=s=>{const t=new Set(U);t.has(s)?t.delete(s):t.add(s),Y(t)},Se=s=>{const t=new Set(D);t.has(s)?t.delete(s):t.add(s),Z(t)},ve=s=>{const t=new Set(T);t.has(s)?t.delete(s):t.add(s),ae(t)},Ae=s=>{const t=s.target.value;V(t==="All"?"All":Number(t)),f(1)},ke=s=>{const t=s.target.value;re(t==="All"?"All":Number(t)),j(1)},Le=s=>{ie(s.target.value)},$e=s=>{ce(s.target.value)};r.useEffect(()=>{const s=K.toLowerCase(),t=G.filter(o=>{const a=o.FirstName.toLowerCase(),n=o.LastName.toLowerCase(),p=o.Email.toLowerCase();return a.includes(s)||n.includes(s)||p.includes(s)});E(t),z(m==="All"?1:Math.ceil(t.length/m)),f(1)},[K,G,m]),r.useEffect(()=>{const s=te.toLowerCase(),t=ee.filter(o=>o.Name.toLowerCase().includes(s));k(t),L(u==="All"?1:Math.ceil(t.length/u)),j(1)},[te,ee,u]);const $=r.useMemo(()=>[...Q].sort((t,o)=>{let a="",n="";switch(y){case"firstName":a=t.FirstName.toLowerCase(),n=o.FirstName.toLowerCase();break;case"lastName":a=t.LastName.toLowerCase(),n=o.LastName.toLowerCase();break;case"email":a=t.Email.toLowerCase(),n=o.Email.toLowerCase();break;default:a=t.FirstName.toLowerCase(),n=o.FirstName.toLowerCase()}return a<n?g==="asc"?-1:1:a>n?g==="asc"?1:-1:0}),[Q,y,g]),P=r.useMemo(()=>[...se].sort((t,o)=>{const a=t.Name.toLowerCase(),n=o.Name.toLowerCase();return a<n?C==="asc"?-1:1:a>n?C==="asc"?1:-1:0}),[se,O,C]),le=b*(m==="All"?$.length:m),Pe=le-(m==="All"?$.length:m),de=m==="All"?$:$.slice(Pe,le),me=N*(u==="All"?P.length:u),Ie=me-(u==="All"?P.length:u),ue=u==="All"?P:P.slice(Ie,me),Fe=async s=>{var p;if(s.preventDefault(),!F.trim()){c("Team name is required."),d.error("Team name is required.");return}const t=sessionStorage.getItem("token");if(!t){c("Authentication token is missing. Please log in again."),d.error("Authentication token is missing. Please log in again.");return}if(!(i!=null&&i.OrgID)){c("User organization ID is undefined."),d.error("User organization ID is undefined.");return}w(!0),c("");const o=Array.from(U).map(l=>Number(l)),a=Array.from(D).map(l=>Number(l)),n=Array.from(T);try{const l={name:F,description:H,members:o,leaders:a,courses:n};x?await h.put(`https://knowvara.com/api/api/auth/teams/${x}`,l,{headers:{Authorization:`Bearer ${t}`}}):await h.post(`https://knowvara.com/api/api/auth/org/${i.OrgID}/teams`,l,{headers:{Authorization:`Bearer ${t}`}}),await ge(),q("/admin/people")}catch(l){if(h.isAxiosError(l)){const I=((p=l.response)==null?void 0:p.data)||l.message;c(`Error submitting form: ${I}`),d.error(`Error submitting form: ${I}`)}else c("Unexpected error submitting form."),d.error("Unexpected error submitting form.")}finally{w(!1)}},Ee=()=>{q("/admin/people")},B=s=>{y===s?X(g==="asc"?"desc":"asc"):(be(s),X("asc"))},Ue=s=>{O===s?oe(C==="asc"?"desc":"asc"):(ye(s),oe("asc"))};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto",children:[e.jsxs("div",{className:"w-full md:w-3/5 p-6 border-r border-gray-300",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-600 mb-4",children:x?"Edit Team":"Create Team"}),ne&&e.jsx("div",{className:"mb-4 text-red-500",children:ne}),e.jsxs("form",{onSubmit:Fe,children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{htmlFor:"teamName",className:"block text-gray-700 mb-2",children:["Team Name",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",id:"teamName",value:F,onChange:s=>R(s.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-lg",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"teamDescription",className:"block text-gray-700 mb-2",children:"Description"}),e.jsx("textarea",{id:"teamDescription",value:H,onChange:s=>W(s.target.value),className:"w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400",rows:3})]}),e.jsx("h2",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Members & Leaders"}),e.jsxs("div",{className:"flex flex-row justify-between items-center mb-2 mt-2",children:[e.jsx("input",{type:"text",placeholder:"Search users by name or email...",onChange:Le,className:"w-64 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm mb-2"}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm mt-1",children:"Show:"}),e.jsxs("select",{value:m,onChange:Ae,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),S?e.jsx("div",{children:"Loading users..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer",onClick:()=>B("firstName"),children:e.jsxs("div",{className:"flex items-center",children:["First Name",y==="firstName"&&e.jsx("span",{className:"ml-1",children:g==="asc"?"▲":"▼"})]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer",onClick:()=>B("lastName"),children:e.jsxs("div",{className:"flex items-center",children:["Last Name",y==="lastName"&&e.jsx("span",{className:"ml-1",children:g==="asc"?"▲":"▼"})]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer",onClick:()=>B("email"),children:e.jsxs("div",{className:"flex items-center",children:["Email",y==="email"&&e.jsx("span",{className:"ml-1",children:g==="asc"?"▲":"▼"})]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200",children:"Member"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200",children:"Leader"})]})}),e.jsx("tbody",{children:de.length>0?de.map((s,t)=>e.jsxs("tr",{className:t%2===0?"bg-gray-50":"",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.FirstName}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.LastName}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.Email}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 text-center",children:e.jsx("input",{type:"checkbox",checked:U.has(s.Id),onChange:()=>Ce(s.Id)})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 text-center",children:e.jsx("input",{type:"checkbox",checked:D.has(s.Id),onChange:()=>Se(s.Id)})})]},s.Id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No users found"})})})]})}),v>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>f(s=>Math.max(s-1,1)),disabled:b===1,className:`px-2 py-1 text-sm border rounded-md ${b===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:v},(s,t)=>t+1).map(s=>e.jsx("button",{type:"button",onClick:()=>f(s),className:`px-2 py-1 text-sm border rounded-md ${b===s?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:s},s)),e.jsx("button",{type:"button",onClick:()=>f(s=>Math.min(s+1,v)),disabled:b===v,className:`px-2 py-1 text-sm border rounded-md ${b===v?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]}),e.jsxs("div",{className:"flex justify-end mt-6",children:[e.jsx("button",{onClick:Ee,className:"px-4 py-2 lms-cancel-button mr-2",children:"Cancel"}),e.jsx("button",{type:"submit",className:`px-4 py-2 lms-button text-sm ${S?"opacity-50 cursor-not-allowed":""}`,disabled:S,children:S?"Submitting...":x?"Update Team":"Create Team"})]})]})]}),e.jsxs("div",{className:"w-full md:w-2/5 p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-600 mb-2",children:"Team Auto-Enrollments"}),e.jsxs("div",{className:"flex flex-row justify-between items-center mb-2 mt-2",children:[e.jsx("input",{type:"text",placeholder:"Search courses by name...",onChange:$e,className:"w-64 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm mb-2"}),e.jsxs("div",{className:"flex justify-end",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm mt-1",children:"Show:"}),e.jsxs("select",{value:u,onChange:ke,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),S&&!x?e.jsx("div",{children:"Loading courses..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200",children:"Select"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer",onClick:()=>Ue("name"),children:e.jsxs("div",{className:"flex items-center",children:["Name",O==="name"&&e.jsx("span",{className:"ml-1",children:C==="asc"?"▲":"▼"})]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200",children:"Price"})]})}),e.jsx("tbody",{children:ue.length>0?ue.map((s,t)=>e.jsxs("tr",{className:t%2===0?"bg-gray-50":"",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 text-center",children:e.jsx("input",{type:"checkbox",checked:T.has(s.Id),onChange:()=>ve(s.Id)})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.Name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.Price})]},s.Id)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No courses found"})})})]})}),A>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>j(s=>Math.max(s-1,1)),disabled:N===1,className:`px-2 py-1 text-sm border rounded-md ${N===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:A},(s,t)=>t+1).map(s=>e.jsx("button",{type:"button",onClick:()=>j(s),className:`px-2 py-1 text-sm border rounded-md ${N===s?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:s},s)),e.jsx("button",{type:"button",onClick:()=>j(s=>Math.min(s+1,A)),disabled:N===A,className:`px-2 py-1 text-sm border rounded-md ${N===A?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]})]})]})};export{Re as default};
