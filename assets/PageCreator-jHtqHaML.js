import{v as we,c as ye,d as je,r as n,j as e,M as X,f as c,B as V,b4 as Se}from"./index-JlNpboNx.js";import{P as Ce}from"./PageObject-DHzgxNBv.js";const Ie=[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link"],[{color:[]},{background:[]}],[{align:[]}]],Ae={toolbar:Ie},j={textOnly:{title:"Text Only",layout:[{field:"content",width:"full"}],contentClass:"text-only-content",imageClass:""},imageRightHalf:{title:"Image Right Half",layout:[{field:"content",width:"half"},{field:"image",width:"half"}],contentClass:"image-right-half-content",imageClass:"image-right-half-image"},imageLeftHalf:{title:"Image Left Half",layout:[{field:"image",width:"half"},{field:"content",width:"half"}],contentClass:"image-left-half-content",imageClass:"image-left-half-image"},imageBottom:{title:"Image Bottom",layout:[{field:"content",width:"full"},{field:"image",width:"full"}],contentClass:"image-bottom-content",imageClass:"image-bottom-image"},imageTop:{title:"Image Top",layout:[{field:"image",width:"full"},{field:"content",width:"full"}],contentClass:"image-top-content",imageClass:"image-top-image"},imageOnly:{title:"Image Only",layout:[{field:"image",width:"full"}],contentClass:"",imageClass:"image-only-image"}},Z=[{label:"Female 1",value:"voice1"},{label:"Female 2",value:"voice2"},{label:"Male 1",value:"voice3"},{label:"Male 2",value:"voice4"}],Pe=()=>{const{lessonId:f,pageId:i}=we(),{user:h}=ye(),v=je(),[a,l]=n.useState(null),[p,S]=n.useState("textOnly"),[_,C]=n.useState(!1),[I,A]=n.useState("readScript"),[N,m]=n.useState(""),[g,u]=n.useState("voice1"),[H,k]=n.useState(!1),[ee,$]=n.useState(!1),[D,d]=n.useState(""),[te,P]=n.useState(!1),[E,w]=n.useState(""),[ae,R]=n.useState(!1),[W,x]=n.useState(""),[se,O]=n.useState(!1),[Q,b]=n.useState(""),[U,F]=n.useState(!1),[Y,y]=n.useState(""),[T,B]=n.useState(!1),[q,L]=n.useState("");n.useEffect(()=>{i&&i!=="0"?(console.log("Looking up page id: "+i),(async()=>{const o=sessionStorage.getItem("token");if(!o){console.error("No token found, user is not authenticated.");return}try{const r=await c.get(`https://knowvara.com/api/api/pages/page/${i}`,{headers:{Authorization:`Bearer ${o}`}});l(r.data),S(r.data.Template||"textOnly"),u(re(r.data.VoiceName||"voice1"))}catch(r){console.error("Error fetching page:",r)}})()):(async()=>{console.log(h==null?void 0:h.Email);const s=sessionStorage.getItem("token");if(!s){console.error("No token found, user is not authenticated.");return}try{const r=(await c.post("https://knowvara.com/api/api/pages/createTemporaryPage",{lessonId:f},{headers:{Authorization:`Bearer ${s}`}})).data.pageId;v(`/admin/page-creator/${f}/${r}`)}catch(o){console.error("Error creating temporary page:",o)}})()},[i,f,h==null?void 0:h.Email,v]);const re=t=>{switch(t){case"Nova":return"voice1";case"Shimmer":return"voice2";case"Onyx":return"voice3";case"Echo":return"voice4";default:return"voice1"}},oe=t=>{S(t),l(s=>s?{...s,Template:t}:null)},ne=t=>{const{name:s,value:o}=t.target;l(r=>r?{...r,[s]:o}:null)},ie=t=>{l(s=>s?{...s,PageContent:t}:null)},le=t=>{l(s=>s?{...s,ImageURL:t}:null)},ce=async t=>{if(t.target.files&&t.target.files.length>0){const s=t.target.files[0];if(!s.type.startsWith("audio/")){b("Invalid file type. Please upload a valid audio file.");return}if(s.size>10*1024*1024){b("File size exceeds 10 MB.");return}O(!0),b(""),y("");const o=new FormData;o.append("audio",s);const r=sessionStorage.getItem("token");if(!r){b("User is not authenticated."),O(!1);return}try{const G=await c.post(`https://knowvara.com/api/api/pages/uploadAudio/${a==null?void 0:a.Id}`,o,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}});l(K=>K?{...K,AudioURL:G.data.audioUrl}:null)}catch(G){console.error("Error uploading audio:",G),b("Failed to upload audio.")}finally{O(!1)}}},de=async()=>{if(!(a!=null&&a.AudioURL))return;F(!0),y("");const t=sessionStorage.getItem("token");if(!t){y("User is not authenticated."),F(!1);return}try{await c.delete(`https://knowvara.com/api/api/pages/removeAudio/${a.Id}`,{headers:{Authorization:`Bearer ${t}`}}),l(s=>s?{...s,AudioURL:""}:null)}catch(s){console.error("Error removing audio:",s),y("Failed to remove audio.")}finally{F(!1)}},me=async()=>{try{l(s=>s?{...s,temporary:"n"}:null);const t=sessionStorage.getItem("token");if(!t){console.error("No token found, user is not authenticated.");return}i&&i!=="0"?await c.put(`https://knowvara.com/api/api/pages/${i}`,a,{headers:{Authorization:`Bearer ${t}`}}):await c.post("https://knowvara.com/api/api/pages",a,{headers:{Authorization:`Bearer ${t}`}}),v(`/admin/lesson-builder/${f}`)}catch(t){console.error("Error saving page:",t),V.error("Failed to save the page. Please try again.")}},ue=()=>{C(!0),A("readScript"),u("voice1"),a!=null&&a.NarrationScript?m(a.NarrationScript):m(M((a==null?void 0:a.PageContent)||""))},he=()=>{C(!1),A("readScript"),m(""),u("voice1"),d("")},J=t=>{A(t.target.value),t.target.value==="readContent"?m(M((a==null?void 0:a.PageContent)||"")):t.target.value==="readScript"&&m((a==null?void 0:a.NarrationScript)||"")},pe=async()=>{if(!a)return;k(!0),d("");const t=sessionStorage.getItem("token");if(!t){d("User is not authenticated."),k(!1);return}try{const o=(await c.post(`https://knowvara.com/api/api/content/generateNarrationScript/${a.Id}`,{title:a.Title,content:M(a.PageContent)},{headers:{Authorization:`Bearer ${t}`}})).data.narrationScript;m(o)}catch(s){console.error("Error generating narration script with AI:",s),d("Failed to generate narration script with AI.")}finally{k(!1)}},ge=async()=>{if(!a)return;if(!N.trim()){d("Narration script cannot be empty.");return}$(!0),d("");const t=sessionStorage.getItem("token");if(!t){d("User is not authenticated."),$(!1);return}try{const s=await c.post(`https://knowvara.com/api/api/content/generateNarration/${a.Id}`,{narrationScript:N,voice:g},{headers:{Authorization:`Bearer ${t}`}});l(o=>o?{...o,AudioURL:s.data.audioUrl,NarrationScript:N}:null),V.success("Narration audio generated successfully!")}catch(s){console.error("Error generating narration audio with AI:",s),d("Failed to generate narration audio with AI.")}finally{$(!1),C(!1)}},xe=()=>{P(!0),w(""),x(""),B(!1),u("voice1"),L("")},fe=()=>{P(!1),w(""),x(""),B(!1),u("voice1"),L("")},be=async()=>{if(!E.trim()){x("Please enter a description.");return}R(!0),x("");const t=sessionStorage.getItem("token");if(!t){x("User is not authenticated."),R(!1);return}try{await c.post("https://knowvara.com/api/api/content/createAIPage",{pageId:i,description:E,createNarration:T,selectedVoice:g},{headers:{Authorization:`Bearer ${t}`}});const s=await c.get(`https://knowvara.com/api/api/pages/page/${i}`,{headers:{Authorization:`Bearer ${t}`}});l({...s.data,Template:"imageRightHalf"}),S("imageRightHalf"),V.success("Page content generated successfully!"),P(!1),w("")}catch(s){console.error("Error generating page with AI:",s),x("Failed to generate page content with AI.")}finally{R(!1)}},ve=()=>{try{const t=`/voiceSamples/${g.toLowerCase()}.mp3`;new Audio(t).play()}catch(t){console.error("Error playing voice sample:",t),L("Failed to play voice sample.")}},M=t=>{let r=new DOMParser().parseFromString(t,"text/html").body.innerText||"";return r=r.replace(/\n+/g," "),r=r.replace(/\s+/g," ").trim(),r=r.replace(/([.:!?])(?=\S)/g,"$1 "),r=r.replace(/:(?=\S)/g,": "),r},z=t=>{switch(t.field){case"title":return e.jsx("input",{type:"text",name:"Title",value:(a==null?void 0:a.Title)||"",onChange:ne,placeholder:"Title",className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300 mb-8"});case"content":return e.jsx(Se,{value:(a==null?void 0:a.PageContent)||"",onChange:ie,placeholder:"Content",modules:Ae,className:`mb-14 w-full ${j[p].contentClass}`});case"image":return e.jsx(Ce,{pageId:(a==null?void 0:a.Id)||0,initialImageURL:(a==null?void 0:a.ImageURL)||"",initialImageDescription:(a==null?void 0:a.AIImageDescription)||"",onImageUpload:le,className:j[p].imageClass});default:return null}},Ne=()=>{const t=j[p].layout;return e.jsxs(e.Fragment,{children:[z({field:"title",width:"full"}),p==="imageRightHalf"||p==="imageLeftHalf"?e.jsx("div",{className:"flex space-x-4",children:t.map((s,o)=>e.jsx("div",{className:`mb-4 ${s.width==="half"?"w-1/2":"w-full"} px-2`,children:z(s)},o))}):t.map((s,o)=>e.jsx("div",{className:`mb-4 ${s.width==="half"?"w-1/2":"w-full"}`,children:z(s)},o))]})};return e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"w-1/5 p-4 border-r overflow-y-auto",children:Object.entries(j).map(([t,s])=>e.jsx("div",{className:`p-4 cursor-pointer ${p===t?"bg-violet-100":""}`,onClick:()=>oe(t),children:s.title},t))}),e.jsx("div",{className:"w-4/5 p-4 flex flex-col justify-between",children:a&&e.jsxs(e.Fragment,{children:[e.jsx("div",{children:Ne()}),e.jsxs("div",{className:"flex items-center justify-between mt-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[a.AudioURL?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("audio",{controls:!0,src:`${a.AudioURL}`,className:"flex-1",children:"Your browser does not support the audio element."}),e.jsx("label",{htmlFor:"audio-upload",className:"lms-button text-white py-2 px-4 rounded-sm cursor-pointer text-sm",children:"Replace Audio"}),e.jsx("button",{onClick:de,className:`lms-button text-white py-2 px-4 rounded-sm text-sm ${U?"bg-gray-400 cursor-not-allowed":"bg-red-500 hover:bg-red-600"}`,disabled:U,children:U?"Removing...":"Remove Audio"})]}):e.jsx("label",{htmlFor:"audio-upload",className:"lms-button text-white py-2 px-4 rounded-sm cursor-pointer text-sm",children:"Upload Audio File"}),e.jsx("button",{onClick:ue,className:"lms-button text-white py-2 px-4 rounded-sm text-sm",children:"Generate Narration with AI"}),e.jsx("input",{id:"audio-upload",type:"file",accept:"audio/*",className:"hidden",onChange:ce})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-auto",children:[e.jsx("button",{onClick:()=>v(`/admin/lesson-builder/${f}`),className:"lms-button text-white py-2 px-4 rounded-sm text-sm",children:"Cancel"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{onClick:xe,className:"lms-button bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-sm text-sm",children:"Build this page for me with AI"})}),e.jsx("button",{onClick:me,className:"lms-button text-white py-2 px-4 rounded-sm text-sm",children:"Save Page"})]}),e.jsxs("div",{className:"flex flex-col ml-4",children:[se&&e.jsx("span",{className:"text-gray-500 text-sm",children:"Uploading audio..."}),Q&&e.jsx("span",{className:"text-red-500 text-sm",children:Q}),Y&&e.jsx("span",{className:"text-red-500 text-sm",children:Y})]})]})]})}),_&&e.jsx(X,{title:"Generate Narration",onClose:he,onConfirm:ge,confirmText:"Generate Narration",widthClassName:"max-w-2xl",children:ee?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"loader mb-4"}),e.jsx("p",{children:"Generating narration audio. Please wait..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Choose Narration Option:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"narrationOption",value:"readScript",checked:I==="readScript",onChange:J,className:"form-radio"}),e.jsx("span",{className:"ml-2",children:"Read a script"})]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"narrationOption",value:"readContent",checked:I==="readContent",onChange:J,className:"form-radio"}),e.jsx("span",{className:"ml-2",children:"Read the content of the page"})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Narration Script:"}),e.jsx("textarea",{className:"w-full p-3 border rounded-md focus:outline-none focus:ring focus:border-blue-300",rows:6,value:N,onChange:t=>m(t.target.value),placeholder:"Narration script will appear here..."})]}),I==="readScript"&&e.jsx("div",{className:"mb-4",children:e.jsx("button",{onClick:pe,className:"lms-button text-white py-2 px-4 rounded-sm text-sm",disabled:H,children:H?"Generating Script...":"Generate Script with AI"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Select Voice:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("select",{value:g,onChange:t=>u(t.target.value),className:"w-1/2 p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",children:Z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("button",{onClick:()=>new Audio(`/voiceSamples/${g.toLowerCase()}.mp3`).play(),className:"text-blue-500 hover:text-blue-700",title:"Play Voice Sample",children:"🔊 Play Sample"})]})]}),D&&e.jsx("div",{className:"mb-4 text-red-500",children:D})]})}),te&&e.jsx(X,{title:"Build Page with AI",onClose:fe,onConfirm:be,confirmText:"Build Page",widthClassName:"max-w-2xl",children:ae?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"loader mb-4"}),e.jsx("p",{children:"Generating page content. Please wait..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"What should this page be about?"}),e.jsx("textarea",{className:"w-full p-3 border rounded-md focus:outline-none focus:ring focus:border-blue-300 mb-4",rows:5,value:E,onChange:t=>w(t.target.value),placeholder:"Describe what the page should be about..."}),e.jsx("div",{className:"mb-4",children:e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",checked:T,onChange:t=>B(t.target.checked),className:"form-checkbox h-5 w-5 text-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-700",children:"Create Narration"})]})}),T&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"Select Voice:"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("select",{value:g,onChange:t=>u(t.target.value),className:"w-1/2 p-2 border rounded-md focus:outline-none focus:ring focus:border-blue-300",children:Z.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))}),e.jsx("button",{type:"button",onClick:ve,className:"bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-md",title:"Play Voice Sample",children:"🔊 Play Sample"})]}),q&&e.jsx("span",{className:"text-red-500 text-sm",children:q})]}),W&&e.jsx("div",{className:"mb-4 text-red-500",children:W})]})})]})};export{Pe as default};
