import{c as N,r as c,j as t,F as E,f as g}from"./index-C-8dYBHj.js";import{R as O,P as I,a as L,C as M,T as S,L as k,A as P,b as R,X as z,Y as B,c as C}from"./AreaChart-D8TRyyin.js";import{f as b}from"./format-Dt71a7ij.js";import{p as w}from"./parseISO-BQ4LyrE0.js";const $=["#FF8042","#FFBB28","#00C49F","#0088FE"],X=({userId:m,height:j=260,outerRadius:l=100,innerRadius:u=40})=>{const{user:i}=N(),[r,y]=c.useState([]),[v,n]=c.useState(!0),[x,o]=c.useState(null);return c.useEffect(()=>{(async()=>{const e=sessionStorage.getItem("token");if(!e){o("Authentication token is missing. Please log in again."),n(!1);return}if(i){if(!i.OrgID){o("Organization ID is missing."),n(!1);return}try{n(!0);const a=m?`https://knowvara.com/api/api/reports/completion-status/${i.OrgID}?userId=${m}`:`https://knowvara.com/api/api/reports/completion-status/${i.OrgID}`,s=await g.get(a,{headers:{Authorization:`Bearer ${e}`}});console.log("Completion Status Response:",s.data);const d=s.data.completionStatusData;if(Array.isArray(d)){const p=d.map(h=>({name:h.name,value:Number(h.value)}));y(p)}else console.warn("Unexpected completionStatusData format:",d),y([]),o("Unexpected data format received.")}catch(a){console.error("Error fetching completion status data:",a),g.isAxiosError(a)&&a.response?o(`Error ${a.response.status}: ${a.response.data.error||"Failed to fetch completion status data."}`):o("Failed to fetch completion status data.")}finally{n(!1)}}})()},[i,m]),i?t.jsxs("div",{className:"bg-white rounded shadow mb-4 flex flex-col items-center",children:[t.jsx("div",{className:"w-full p-2 subnav-gradient text-white",children:"Course Completion Status"}),t.jsx("div",{className:"w-full flex justify-center items-center p-2",children:v?t.jsxs("div",{className:"flex items-center",children:[t.jsx(E,{className:"animate-spin mr-2"}),t.jsx("span",{children:"Loading completion status data..."})]}):x?t.jsx("p",{className:"text-red-500",children:x}):r.length===0?t.jsx("p",{children:"No completion status data available."}):t.jsx(O,{width:"100%",height:j,children:t.jsxs(I,{children:[t.jsx(L,{data:r,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:l,innerRadius:u,fill:"#8884d8",label:({cx:f,cy:e,midAngle:a,innerRadius:s,outerRadius:d,value:p})=>{if(p===0)return null;const h=Math.PI/180,D=s+(d-s)*.5,A=f+D*Math.cos(-a*h),F=e+D*Math.sin(-a*h);return t.jsx("text",{x:A,y:F,fill:"white",fontSize:16,textAnchor:A>f?"start":"end",dominantBaseline:"central",children:p})},labelLine:!1,children:r.map((f,e)=>t.jsx(M,{fill:$[e%$.length]},`cell-${e}`))}),t.jsx(S,{}),t.jsx(k,{})]})})})]}):t.jsx("div",{children:"Access Denied."})},Y=({userId:m,height:j=235})=>{const{user:l}=N(),[u,i]=c.useState([]),[r,y]=c.useState(7),[v,n]=c.useState(!0),[x,o]=c.useState(null);c.useEffect(()=>{(async()=>{const a=sessionStorage.getItem("token");if(!a){o("Authentication token is missing. Please log in again."),n(!1);return}if(l){if(!l.OrgID){o("Organization ID is missing."),n(!1);return}try{n(!0);const s=m?`https://knowvara.com/api/api/reports/activity/${l.OrgID}?days=${r}&userId=${m}`:`https://knowvara.com/api/api/reports/activity/${l.OrgID}?days=${r}`,d=await g.get(s,{headers:{Authorization:`Bearer ${a}`}});console.log("Activity Data Response:",d.data);const p=d.data.activityData;Array.isArray(p)?i(p):(console.warn("Unexpected activityData format:",p),i([]),o("Unexpected data format received."))}catch(s){console.error("Error fetching activity data:",s),g.isAxiosError(s)&&s.response?o(`Error ${s.response.status}: ${s.response.data.error||"Failed to fetch activity data."}`):o("Failed to fetch activity data.")}finally{n(!1)}}})()},[l,r,m]);const f=e=>{y(e)};return l?t.jsxs("div",{className:"bg-white rounded shadow mb-4 flex flex-col",children:[t.jsxs("div",{className:"flex w-full p-2 subnav-gradient text-white justify-between items-center",children:[t.jsx("span",{children:"Activity Overview"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{onClick:()=>f(7),className:`px-3 py-1 rounded ${r===7?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Past 7 Days"}),t.jsx("button",{onClick:()=>f(30),className:`px-3 py-1 rounded ${r===30?"bg-blue-500 text-white":"bg-gray-200 text-gray-700"}`,children:"Past 30 Days"})]})]}),t.jsx("div",{className:"flex-1 py-4 px-1",children:v?t.jsx("p",{className:"mt-4",children:"Loading activity data..."}):x?t.jsx("p",{className:"mt-4 text-red-500",children:x}):u.length===0?t.jsx("p",{className:"mt-4",children:"No activity data found."}):t.jsx(O,{width:"100%",height:j,children:t.jsxs(P,{data:u,margin:{top:10,right:30,left:0,bottom:0},children:[t.jsxs("defs",{children:[t.jsxs("linearGradient",{id:"colorLogins",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#8884d8",stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:"#8884d8",stopOpacity:0})]}),t.jsxs("linearGradient",{id:"colorCompletions",x1:"0",y1:"0",x2:"0",y2:"1",children:[t.jsx("stop",{offset:"5%",stopColor:"#82ca9d",stopOpacity:.8}),t.jsx("stop",{offset:"95%",stopColor:"#82ca9d",stopOpacity:0})]})]}),t.jsx(R,{strokeDasharray:"3 3"}),t.jsx(z,{dataKey:"date",tickFormatter:e=>b(w(e),"MMM d")}),t.jsx(B,{}),t.jsx(S,{labelFormatter:e=>b(w(e),"MMMM d, yyyy")}),t.jsx(k,{}),t.jsx(C,{type:"monotone",dataKey:"logins",name:"Logins",stroke:"#8884d8",fillOpacity:1,fill:"url(#colorLogins)"}),t.jsx(C,{type:"monotone",dataKey:"completions",name:"Course Completions",stroke:"#82ca9d",fillOpacity:1,fill:"url(#colorCompletions)"})]})})})]}):t.jsx("div",{children:"Access Denied."})};export{X as A,Y as a};
