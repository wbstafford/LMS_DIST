import{c as C,d as q,r as m,j as s,at as x,B as p,e as B}from"./index-BzFnb_De.js";const $=()=>{const{user:u}=C(),k=q(),[d,g]=m.useState([]),[c,f]=m.useState([]),[i,N]=m.useState([]),[n,j]=m.useState([]),[r,I]=m.useState([]),[b,v]=m.useState(!1),E=sessionStorage.getItem("token"),P=async()=>{var S,w;if(i.length===0&&n.length===0&&r.length===0){p.error("Please select at least one course, Learning Plan, or Bundle to enroll.");return}if(d.length===0&&c.length===0){p.error("Please select at least one user or team to enroll.");return}const e=[];n.forEach(a=>{a.courses.forEach(t=>{e.push(t.id)})}),r.forEach(a=>{a.courses.forEach(t=>{e.push(t.Id)})});const l=[...i.map(a=>a.Id),...e],y=Array.from(new Set(l)),o={};if(d.length>0){const a=d.map(t=>parseInt(t.Id,10)).filter(t=>!isNaN(t));o.userIds=a}c.length>0&&(o.teamIds=c.map(a=>a.id)),y.length>0&&(o.courseIds=y),n.length>0&&(o.learningPlanIds=n.map(a=>a.id)),r.length>0&&(o.bundleIds=r.map(a=>a.Id)),v(!0);try{const a=await B.post("https://knowvara.com/api/api/enrollments/bulk-enroll",o,{headers:{Authorization:`Bearer ${E}`,"Content-Type":"application/json"}});p.success(a.data.message||"Bulk enrollment successful."),g([]),f([]),j([]),I([]),N([]),k("/admin")}catch(a){console.error("Error during bulk enrollment:",a);const t=a;(w=(S=t.response)==null?void 0:S.data)!=null&&w.error?p.error(t.response.data.error):p.error("Failed to perform bulk enrollment.")}finally{v(!1)}},h={orgId:u==null?void 0:u.OrgID};return s.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-screen",children:[s.jsxs("div",{className:"w-full md:w-1/3 p-4 border-r",children:[s.jsx("h2",{className:"text-2xl font-semibold mb-4 text-gray-700",children:"Bulk Enrollment"}),s.jsx(x,{title:"Users",placeholder:"Search users...",fetchEndpoint:"https://knowvara.com/api/api/enrollments/search-users",queryParamName:"q",selectedItems:d,setSelectedItems:g,additionalParams:h,getId:e=>e.Id,getName:e=>`${e.FirstName} ${e.LastName}`}),s.jsx(x,{title:"Teams",placeholder:"Search teams...",fetchEndpoint:"https://knowvara.com/api/api/enrollments/search-teams",queryParamName:"q",selectedItems:c,setSelectedItems:f,additionalParams:h,getId:e=>e.id,getName:e=>e.name})]}),s.jsxs("div",{className:"w-full md:w-1/3 p-4 border-r",children:[s.jsx(x,{title:"Courses",placeholder:"Search courses...",fetchEndpoint:"https://knowvara.com/api/api/enrollments/search-courses",queryParamName:"q",selectedItems:i,setSelectedItems:N,additionalParams:h,getId:e=>e.Id,getName:e=>e.Name}),s.jsx(x,{title:"Learning Plans",placeholder:"Search Learning Plans...",fetchEndpoint:"https://knowvara.com/api/api/learning-plans/search",queryParamName:"q",selectedItems:n,setSelectedItems:j,additionalParams:h,getId:e=>e.id,getName:e=>e.name}),s.jsx(x,{title:"Bundles",placeholder:"Search Bundles...",fetchEndpoint:"https://knowvara.com/api/api/bundles/search",queryParamName:"q",selectedItems:r,setSelectedItems:I,additionalParams:h,getId:e=>e.Id,getName:e=>e.Name})]}),s.jsxs("div",{className:"w-full md:w-1/3 p-4 bg-gray-50 rounded-md",children:[s.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Selected Items"}),d.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"font-medium mb-2 text-gray-700",children:"Users"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(e=>s.jsxs("div",{className:"flex items-center bg-blue-100 text-blue-700 px-3 py-1 rounded-full",children:[s.jsxs("span",{className:"mr-2",children:[e.FirstName," ",e.LastName]}),s.jsx("button",{onClick:()=>g(d.filter(l=>l.Id!==e.Id)),className:"text-xl leading-none",children:"×"})]},e.Id))})]}),c.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"font-medium mb-2 text-gray-700",children:"Teams"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(e=>s.jsxs("div",{className:"flex items-center bg-green-100 text-green-700 px-3 py-1 rounded-full",children:[s.jsx("span",{className:"mr-2",children:e.name}),s.jsx("button",{onClick:()=>f(c.filter(l=>l.id!==e.id)),className:"text-xl leading-none",children:"×"})]},e.id))})]}),i.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"font-medium mb-2 text-gray-700",children:"Courses"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(e=>s.jsxs("div",{className:"flex items-center bg-purple-100 text-purple-700 px-3 py-1 rounded-full",children:[s.jsx("span",{className:"mr-2",children:e.Name}),s.jsx("button",{onClick:()=>N(i.filter(l=>l.Id!==e.Id)),className:"text-xl leading-none",children:"×"})]},e.Id))})]}),n.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"font-medium mb-2 text-gray-700",children:"Learning Plans"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(e=>s.jsxs("div",{className:"flex items-center bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full",children:[s.jsx("span",{className:"mr-2",children:e.name}),s.jsx("button",{onClick:()=>j(n.filter(l=>l.id!==e.id)),className:"text-xl leading-none",children:"×"})]},e.id))})]}),r.length>0&&s.jsxs("div",{className:"mb-4",children:[s.jsx("h4",{className:"font-medium mb-2 text-gray-700",children:"Bundles"}),s.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(e=>s.jsxs("div",{className:"flex items-center bg-purple-100 text-purple-700 px-3 py-1 rounded-full",children:[s.jsx("span",{className:"mr-2",children:e.Name}),s.jsx("button",{onClick:()=>I(r.filter(l=>l.Id!==e.Id)),className:"text-xl leading-none",children:"×"})]},e.Id))})]}),s.jsx("div",{className:"mt-6 flex justify-center",children:s.jsx("button",{onClick:P,disabled:b,className:`px-6 py-3 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none ${b?"opacity-50 cursor-not-allowed":""}`,children:b?"Enrolling...":"Process Enrollments"})})]})]})};export{$ as default};
