import{c as T,r as n,d as A,f as u,j as t,a5 as C,P as B,a6 as O,a2 as z,a7 as U,a8 as M,a9 as R}from"./index-JlNpboNx.js";import{C as V}from"./CourseStatusBar-LbQkWQkb.js";const H=({courseId:o,enrollmentId:h=0,inPlayer:c=!1,updatedLesson:i,currentLessonId:j,orderLessons:p=!1,hideLaunchButtons:f=!1,courseName:l,imageURL:x})=>{const{user:a}=T(),[d,g]=n.useState([]),[y,b]=n.useState(!1),[w,I]=n.useState(0),$=A();n.useEffect(()=>{if(o&&(a!=null&&a.Id)){const e=`https://knowvara.com/api/api/lessons/status/${o}/${a.Id}/${h}`;b(!0),u.get(e).then(r=>{const s=r.data;g(s)}).catch(r=>{console.error("Error fetching lessons:",r)}).finally(()=>{b(!1)})}},[o,a==null?void 0:a.Id,h]),n.useEffect(()=>{i&&(g(e=>e.map(r=>r.Id===Number(i.lessonId)?{...r,status:i.status}:r)),I(e=>e+1))},[i]),n.useEffect(()=>{c&&!l&&(a!=null&&a.OrgID)&&(async()=>{const r=sessionStorage.getItem("token");if(!r){console.error("No token found, user is not authenticated.");return}try{await u.get(`https://knowvara.com/api/api/courses/${a==null?void 0:a.OrgID}/${o}`,{headers:{Authorization:`Bearer ${r}`}})}catch(s){console.error("Error fetching course name:",s)}})()},[c,o,a==null?void 0:a.OrgID,l]);const k=async()=>{const e=sessionStorage.getItem("token");if(!e)return console.error("No token found, user is not authenticated."),null;try{return(await u.post("https://knowvara.com/api/api/courses/enrollment",{courseId:o,userId:a==null?void 0:a.Id},{headers:{Authorization:`Bearer ${e}`}})).data.enrollmentId}catch(r){return console.error("Error creating enrollment:",r),null}},v=async(e,r)=>{if(f)return;let s=h;if(console.log("Current enrollment: "+s),(!s||s===0)&&(s=await k(),!s)){console.error("Failed to create enrollment, cannot launch lesson.");return}if(a&&s){const m=sessionStorage.getItem("token");if(!m){console.error("No token found, user is not authenticated.");return}const D={userId:a.Id,type:"lessonLaunch",orgId:a.OrgID,enrollmentId:s,courseId:o,lessonId:e};try{await u.post("https://knowvara.com/api/api/actions/log",D,{headers:{Authorization:`Bearer ${m}`}}),console.log("Action logged successfully")}catch(L){console.error("Error logging action:",L)}}if(a){const{Id:m}=a;$(`/course-player/${e}/${s}/${o}/${m}/${r}`)}},E=e=>{if(!e)return"";const r=new Date(e);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}).format(r)},F=e=>{switch(e){case"completed":case"passed":return t.jsx(R,{className:"large-icon"});case"incomplete":case"failed":return t.jsx(M,{className:"large-icon"});default:return t.jsx(U,{className:"large-icon"})}},N=p?d.find(e=>e.Type!=="header"&&e.status!=="completed"&&e.status!=="passed"):null,S=n.useMemo(()=>new Set(d.filter(e=>e.status==="completed"||e.status==="passed").map(e=>e.Id)),[d]);return t.jsxs("div",{className:c?"overflow-x-auto border-r min-h-[100%]":"overflow-x-auto",children:[c&&l&&t.jsxs("div",{className:"flex items-center p-3",children:[x&&t.jsx("img",{src:x,alt:l,className:"w-16 h-16 mr-4 shadow-lg rounded-lg"}),t.jsxs("div",{className:"w-full",children:[t.jsx("h1",{className:"text-lg font-bold text-gray-700 pb-1 mt-2",children:l}),t.jsx("div",{className:"mb-2 px-4 pt-1",children:t.jsx(V,{courseId:o,lessonsUpdated:w})})]})]}),y?t.jsx("p",{children:"Loading..."}):t.jsx("div",{className:"p-0 md:p-2",children:t.jsx("table",{className:"min-w-full bg-white",children:t.jsx("tbody",{children:d.map(e=>{let r=!1;return f||(p?(S.has(e.Id)||N&&e.Id===N.Id)&&(r=!0):r=!0),t.jsx("tr",{className:`${e.Type==="header"?"bg-gray-100":e.Id===Number(j)?"bg-violet-100":""}`,children:e.Type==="header"?t.jsx("td",{className:"py-3 px-4 border-b border-t font-bold w-4 text-sm",colSpan:6,children:e.Name}):t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"py-3 px-2 md:px-4 border-b border-t text-center w-4",children:e.Type==="mp4"?t.jsx(C,{className:"large-icon"}):e.Type==="pdf"?t.jsx(B,{className:"large-icon"}):t.jsx(O,{className:"large-icon"})}),t.jsx("td",{className:"py-3 px-2 md:px-4 border-b border-t text-sm",children:e.Name}),!c&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"py-3 px-4 border-b border-t hidden md:table-cell",children:e.score||""}),t.jsx("td",{className:"py-3 px-4 border-b border-t hidden md:table-cell",children:E(e.completedDate)})]}),t.jsx("td",{className:"py-3 px-4 border-b border-t text-center w-16",children:F(e.status)}),t.jsx("td",{className:"py-3 px-4 border-b border-t text-center w-16",children:r?t.jsx(z,{className:"cursor-pointer large-icon",onClick:()=>v(e.Id,e.Type),"aria-label":`Launch lesson ${e.Name}`,title:`Launch lesson ${e.Name}`}):null})]})},e.Id)})})})})]})};export{H as C};
