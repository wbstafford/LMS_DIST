import{c as Se,r as o,d as Ie,w as Ae,j as e,ap as K,as as Ue,af as Q,ag as $e,ah as W,aq as Z,A as ee,M as A,B as i,f as h}from"./index-BSiKmnSf.js";import{u as ke}from"./useSubscription-LS2xWsBZ.js";const Te=()=>{const{user:a}=Se(),{isUserLimitReached:se,refetch:re}=ke(),[v,p]=o.useState([]),[U,te]=o.useState({key:"FirstName",direction:"ascending"}),[ae,C]=o.useState(!1),[$,D]=o.useState(null),[N,m]=o.useState(""),[k,T]=o.useState(!1),g=Ie(),[oe,ne]=o.useState(""),[u,b]=o.useState(1),[x,E]=o.useState(15),[P,M]=o.useState([]),[w,f]=o.useState(""),[le,L]=o.useState(!1),[ie,S]=o.useState(!1),[F,I]=o.useState(null),[O,z]=o.useState(!1),[ce,B]=o.useState(!1),[de,Y]=o.useState(""),[V,me]=o.useState({x:0,y:0}),[xe,G]=o.useState(!1),he=s=>{ne(s),b(1)},ge=()=>{g("/admin/import-users/")},R=Ae(he,300),ue=s=>{sessionStorage.setItem("origin",location.pathname+location.search),g(`/student/transcript/${s}`)};o.useEffect(()=>()=>{R.cancel()},[]);const pe=async()=>{var r,c,l,n;const s=sessionStorage.getItem("token");if(!s){console.error("No token found"),m("Authentication token is missing. Please log in again."),i.error("Authentication token is missing. Please log in again.");return}if(!(a!=null&&a.OrgID)){console.error("User OrgID is undefined"),m("User organization ID is undefined."),i.error("User organization ID is undefined.");return}console.log(`Fetching users for OrgID: ${a.OrgID}`);try{const t=await h.get(`https://knowvara.com/api/api/auth/org/${a.OrgID}/users`,{headers:{Authorization:`Bearer ${s}`}});Array.isArray(t.data)?p(t.data):(console.error("Fetched data is not an array"),p([]))}catch(t){h.isAxiosError(t)?(m(`Error fetching people: ${((r=t.response)==null?void 0:r.data)||t.message}`),console.error(`Error fetching people: ${(c=t.response)==null?void 0:c.status} - ${(l=t.response)==null?void 0:l.data}`),i.error(`Error fetching people: ${((n=t.response)==null?void 0:n.data)||t.message}`)):(m("Unexpected error fetching people."),console.error("Unexpected error fetching people:",t),i.error("Unexpected error fetching people.")),p([])}};o.useEffect(()=>{a!=null&&a.OrgID&&pe()},[a==null?void 0:a.OrgID]);const q=async()=>{var r,c,l;const s=sessionStorage.getItem("token");if(!s){console.error("No token found"),f("Authentication token is missing. Please log in again."),i.error("Authentication token is missing. Please log in again.");return}if(!(a!=null&&a.OrgID)){console.error("User OrgID is undefined"),f("User organization ID is undefined."),i.error("User organization ID is undefined.");return}L(!0),f("");try{const n=await h.get(`https://knowvara.com/api/api/auth/org/${a.OrgID}/teams`,{headers:{Authorization:`Bearer ${s}`}});M(n.data)}catch(n){if(h.isAxiosError(n)){const t=((r=n.response)==null?void 0:r.data)||n.message;f(`Error fetching teams: ${t}`),console.error(`Error fetching teams: ${(c=n.response)==null?void 0:c.status} - ${(l=n.response)==null?void 0:l.data}`),i.error(`Error fetching teams: ${t}`)}else f("Unexpected error fetching teams."),console.error("Unexpected error fetching teams:",n),i.error("Unexpected error fetching teams.");M([])}finally{L(!1)}};o.useEffect(()=>{a!=null&&a.OrgID&&q()},[a==null?void 0:a.OrgID]);const H=s=>{let r="ascending";U.key===s&&U.direction==="ascending"&&(r="descending"),te({key:s,direction:r});const c=[...v].sort((l,n)=>{const t=l[s]??"",d=n[s]??"";return t<d?r==="ascending"?-1:1:t>d?r==="ascending"?1:-1:0});p(c)},be=()=>{g("/admin/person-form")},fe=s=>{sessionStorage.setItem("origin",location.pathname+location.search),g(`/admin/person-form/${s}`)},ye=async s=>{var c,l,n,t;const r=sessionStorage.getItem("token");if(!r){console.error("No token found"),m("Authentication token is missing. Please log in again."),i.error("Authentication token is missing. Please log in again.");return}T(!0);try{await h.delete(`https://knowvara.com/api/api/auth/users/${s}`,{headers:{Authorization:`Bearer ${r}`}}),p(v.filter(d=>d.Id!==s)),i.success("User deleted successfully."),re()}catch(d){if(h.isAxiosError(d)){const _=typeof((c=d.response)==null?void 0:c.data)=="string"?d.response.data:JSON.stringify((l=d.response)==null?void 0:l.data)||d.message||"Error deleting user.";m(`Error deleting person: ${_}`),console.error(`Error deleting person: ${(n=d.response)==null?void 0:n.status} - ${(t=d.response)==null?void 0:t.data}`),i.error(`Error deleting user: ${_}`)}else m("An unexpected error occurred while deleting the person."),console.error("Unexpected error deleting person:",d),i.error("An unexpected error occurred while deleting the person.")}finally{T(!1),C(!1),D(null)}},y=v.filter(s=>{const r=`${s.FirstName} ${s.LastName}`.toLowerCase(),c=s.Email.toLowerCase(),l=oe.toLowerCase();return r.includes(l)||c.includes(l)}),j=x==="All"?1:Math.ceil(y.length/x),J=u*(x==="All"?y.length:x),je=J-(x==="All"?y.length:x),X=x==="All"?y:y.slice(je,J),Ne=s=>{const r=s.target.value;E(r==="All"?"All":Number(r)),b(1)},we=async s=>{var c,l,n;const r=sessionStorage.getItem("token");if(!r){console.error("No token found"),i.error("Authentication token is missing. Please log in again.");return}z(!0);try{await h.delete(`https://knowvara.com/api/api/auth/teams/${s}`,{headers:{Authorization:`Bearer ${r}`}}),i.success("Team deleted successfully."),q()}catch(t){if(h.isAxiosError(t)){const d=((c=t.response)==null?void 0:c.data)||t.message;console.error(`Error deleting team: ${(l=t.response)==null?void 0:l.status} - ${(n=t.response)==null?void 0:n.data}`),i.error(`Error deleting team: ${d}`)}else console.error("Unexpected error deleting team:",t),i.error("Unexpected error deleting team.")}finally{z(!1),S(!1),I(null)}},ve=s=>{Y(s),B(!0)},Ce=s=>{me({x:s.clientX,y:s.clientY})},De=()=>{B(!1),Y("")};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto",children:[e.jsxs("div",{className:"w-full md:w-3/5 p-4 md:border-r border-gray-300",children:[N&&e.jsx("div",{className:"mb-4 text-red-500",children:N}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center mb-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-600",children:"People"}),e.jsxs("div",{className:"flex justify-end mb-4",children:[se?e.jsx("button",{className:"px-4 py-2 text-white text-sm mr-2 bg-red-500 hover:bg-red-600 rounded",onClick:()=>G(!0),children:"Get More Users"}):e.jsxs("button",{className:"px-4 py-2 lms-button text-sm mr-2 flex items-center ",onClick:be,children:[e.jsx(K,{className:"mr-2"})," Create New Person"]}),e.jsxs("button",{className:"px-4 py-2 lms-button flex items-center",onClick:ge,children:[e.jsx(Ue,{className:"mr-2"})," Upload People"]})]})]}),e.jsxs("div",{className:"flex flex-row justify-between items-center mb-3 mt-4",children:[e.jsx("input",{type:"text",placeholder:"Search by name or email...",onChange:s=>R(s.target.value),className:"w-64 px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-gray-700 text-sm",children:"Show:"}),e.jsxs("select",{value:x,onChange:Ne,className:"px-2 py-1 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm",children:[e.jsx("option",{value:15,children:"15"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"}),e.jsx("option",{value:200,children:"200"}),e.jsx("option",{value:"All",children:"All"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-sm w-12"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>H("FirstName"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"mr-2"}),"First"]})}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 cursor-pointer text-sm",onClick:()=>H("LastName"),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"mr-2"}),"Last"]})}),e.jsx("th",{className:"hidden sm:table-cell py-2 px-4 border-b border-gray-200 text-sm",children:"Email"}),e.jsx("th",{className:"w-16 py-2 px-4 border-b border-gray-200 text-sm",children:"Admin"}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-sm"}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-sm"}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-sm"})]})}),e.jsx("tbody",{children:X.length>0?X.map((s,r)=>e.jsxs("tr",{className:r%2===0?"bg-gray-50":"",children:[e.jsx("td",{className:"py-1 md:py-2 px-1 border-b border-gray-200",children:e.jsx("img",{src:s.imageUrl?"/content"+s.imageUrl:"/defaultUserIcon.webp",alt:`${s.FirstName} ${s.LastName}`,className:"w-10 h-8 md:h-10 rounded-full object-cover",loading:"lazy",onMouseEnter:s.imageUrl?()=>ve("/content"+s.imageUrl):void 0,onMouseMove:s.imageUrl?Ce:void 0,onMouseLeave:s.imageUrl?De:void 0})}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.FirstName}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.LastName}),e.jsx("td",{className:"hidden sm:table-cell py-2 px-4 border-b border-gray-200",children:s.Email}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200 text-center",children:s.Admin==="y"?"Yes":"No"}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx($e,{size:20,className:"cursor-pointer lms-icon ",onClick:()=>ue(s.Id),title:"Transcript","aria-label":"Transcript"})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(W,{size:18,className:"cursor-pointer lms-icon",onClick:()=>fe(s.Id),title:"Edit User","aria-label":"Edit User"})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:(a==null?void 0:a.Id)===s.Id.toString()?e.jsx("span",{className:"text-gray-400",children:"You"}):e.jsx(Z,{size:18,className:"cursor-pointer lms-icon",onClick:()=>{D(s.Id),C(!0)},title:"Delete User","aria-label":"Delete User"})})]},s.Id)):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No people available"})})})]})}),j>1&&e.jsxs("div",{className:"flex justify-center items-center mt-4 space-x-2",children:[e.jsx("button",{onClick:()=>b(s=>Math.max(s-1,1)),disabled:u===1,className:`px-2 py-1 text-sm border rounded-md ${u===1?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Previous"}),Array.from({length:j},(s,r)=>r+1).map(s=>e.jsx("button",{onClick:()=>b(s),className:`px-2 py-1 text-sm border rounded-md ${u===s?"bg-blue-500 text-white":"bg-white hover:bg-gray-100"}`,children:s},s)),e.jsx("button",{onClick:()=>b(s=>Math.min(s+1,j)),disabled:u===j,className:`px-2 py-1 text-sm border rounded-md ${u===j?"bg-gray-200 cursor-not-allowed":"bg-white hover:bg-gray-100"}`,children:"Next"})]})]}),e.jsxs("div",{className:"w-full md:w-2/5 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-600",children:"Teams"}),e.jsxs("button",{className:"px-4 py-2 lms-button text-sm flex items-center ",onClick:()=>g("/admin/team-form"),children:[e.jsx(K,{className:"mr-2"}),"Create Team"]})]}),w&&e.jsx("div",{className:"mb-4 text-red-500",children:w}),le?e.jsx("div",{children:"Loading teams..."}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-white",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 px-4 border-b border-gray-200",children:"Team Name"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200",children:"Description"}),e.jsx("th",{className:"py-2 px-4 border-b border-gray-200 text-center",children:"Members"}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-sm"}),e.jsx("th",{className:"w-8 py-2 px-2 border-b border-gray-200 text-sm"})]})}),e.jsx("tbody",{children:P.length>0?P.map((s,r)=>e.jsxs("tr",{className:r%2===0?"bg-gray-50":"",children:[e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.name}),e.jsx("td",{className:"py-2 px-4 border-b border-gray-200",children:s.description}),e.jsxs("td",{className:"py-2 px-4 border-b border-gray-200 text-center",children:[s.userCount," "]}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(W,{size:18,className:"cursor-pointer lms-icon",onClick:()=>g(`/admin/team-form/${s.id}`),title:"Edit Team","aria-label":"Edit Team"})}),e.jsx("td",{className:"py-2 px-2 border-b border-gray-200 text-center",children:e.jsx(Z,{size:18,className:"cursor-pointer lms-icon",onClick:()=>{I(s.id),S(!0)},title:"Delete Team","aria-label":"Delete Team"})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-2 px-4 border-b border-gray-200 text-center",children:"No teams available"})})})]})})]}),e.jsx(ee,{children:ae&&$!==null&&e.jsxs(A,{title:"Confirm Deletion",onClose:()=>{C(!1),D(null),m("")},onConfirm:()=>ye($),confirmText:k?"Deleting...":"Yes, Delete",isConfirmDisabled:k,singleButton:!1,widthClassName:"max-w-md",children:[e.jsx("p",{children:"Are you sure you want to delete this user? This action cannot be undone."}),N&&e.jsx("div",{className:"mt-4 text-red-500",children:N})]})}),e.jsx(ee,{children:ie&&F!==null&&e.jsxs(A,{title:"Confirm Deletion",onClose:()=>{S(!1),I(null)},onConfirm:()=>we(F),confirmText:O?"Deleting...":"Yes, Delete",isConfirmDisabled:O,singleButton:!1,widthClassName:"max-w-md",children:[e.jsx("p",{children:"Are you sure you want to delete this team? This action cannot be undone."}),w&&e.jsx("div",{className:"mt-4 text-red-500",children:w})]})}),xe&&e.jsx(A,{title:"User Limit Reached",onClose:()=>G(!1),onConfirm:()=>g("/admin/settings"),confirmText:"Go to Settings",isConfirmDisabled:!1,singleButton:!1,widthClassName:"max-w-md",children:e.jsxs("p",{children:["You are currently using all of the users in your subscription. Go to the"," ",e.jsx("strong",{children:e.jsx("a",{href:"/admin/settings",className:"text-blue-500 underline",children:"settings page"})})," ","and upgrade your account to allow for more users."]})}),ce&&e.jsx("div",{className:"fixed pointer-events-none z-50",style:{top:V.y-72,left:V.x+20},children:e.jsx("img",{src:de,alt:"User Avatar",className:"w-36 h-36 rounded-full object-cover shadow-lg border-2 border-white"})})]})},Me=()=>e.jsx("div",{className:"p-0",children:e.jsx(Te,{})});export{Me as default};
