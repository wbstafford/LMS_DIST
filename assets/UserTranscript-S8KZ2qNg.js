import{c as w,r as l,j as e,e as N,F as y,ai as L,y as v,aj as k,ak as E,al as A,am as F,t as $,d as R}from"./index-2WPDJfjq.js";import{U as T,L as U}from"./UserDetails-CKF0bxZn.js";import{A as B,a as M}from"./AdminDashboardActivityChart-BWqoZrgy.js";import{f as z}from"./format-Dt71a7ij.js";import"./CourseStatusBar-D5Anj0Mn.js";import"./AreaChart-BrqGiCaV.js";import"./parseISO-BQ4LyrE0.js";const P=({userId:c})=>{const{user:t}=w(),[x,d]=l.useState(null),[h,m]=l.useState(!0),[o,u]=l.useState(null);l.useEffect(()=>{(async()=>{const p=sessionStorage.getItem("token");if(!p){u("Authentication token is missing. Please log in again."),m(!1);return}if(t){if(!t.OrgID){u("Organization ID is missing."),m(!1);return}try{m(!0);const j=(await N.get(`https://knowvara.com/api/api/reports/user-statistics/${c}`,{headers:{Authorization:`Bearer ${p}`}})).data;d(j)}catch(f){console.error("Error fetching user statistics:",f),u("Failed to fetch user statistics.")}finally{m(!1)}}})()},[c]);const a=i=>i?z(new Date(i),"MMMM d, yyyy h:mm a"):"N/A";return t?e.jsxs("div",{className:"bg-white rounded shadow mb-4",children:[e.jsx("div",{className:"w-full p-2 subnav-gradient text-white",children:"Statistics"}),h?e.jsx("p",{children:"Loading user statistics..."}):o?e.jsx("p",{className:"text-red-500",children:o}):x?e.jsxs("div",{className:"flex flex-col space-y-2 mt-1 p-2",children:[e.jsx("div",{children:e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Most Recent Log In:"})," ",a(x.mostRecentLogIn)]})}),e.jsx("div",{children:e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Most Recent Enrollment:"})," ",a(x.mostRecentEnrollment)]})}),e.jsx("div",{children:e.jsxs("div",{className:"text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Most Recent Completion:"})," ",a(x.mostRecentCompletion)]})})]}):e.jsx("p",{children:"No user statistics available."})]}):e.jsx("div",{children:"Access Denied."})},O=({enrollmentId:c})=>{const[t,x]=l.useState([]),[d,h]=l.useState(!1),[m,o]=l.useState(null);l.useEffect(()=>{(async()=>{h(!0),o(null);try{const i=sessionStorage.getItem("token");if(!i){o("User is not authenticated.");return}const p=await N.get(`https://knowvara.com/api/api/enrollments/${c}/lessons`,{headers:{Authorization:`Bearer ${i}`}});x(p.data.lessons)}catch(i){console.error("Error fetching lessons:",i),o("Failed to load lessons.")}finally{h(!1)}})()},[c]);const u=a=>{switch(a.toLowerCase()){case"completed":return e.jsx(v,{className:"text-green-500 inline"});case"incomplete":return e.jsx(k,{className:"text-yellow-500 inline"});case"passed":return e.jsx(v,{className:"text-green-500 inline"});case"not attempted":default:return e.jsx(L,{className:"text-gray-500 inline"})}};return d?e.jsxs("div",{className:"flex items-center space-x-2 p-4",children:[e.jsx(y,{className:"animate-spin"}),e.jsx("span",{children:"Loading lessons..."})]}):m?e.jsx("div",{className:"text-red-500 p-4",children:m}):e.jsx("div",{className:"m-1 mt-2",children:e.jsx("table",{className:"min-w-full bg-white border",children:e.jsx("tbody",{children:t.length>0?t.map(a=>a.type.toLowerCase()==="header"?e.jsx("tr",{className:"bg-gray-100",children:e.jsx("td",{colSpan:3,className:"py-2 px-2 font-semibold text-gray-700",children:a.lessonName})},a.lessonId):e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"py-2 px-4 border-b",children:a.lessonName}),e.jsxs("td",{className:"py-2 px-4 border-b flex items-center",children:[u(a.status)," ",e.jsx("span",{className:"ml-2 capitalize",children:a.status})]}),e.jsx("td",{className:"py-2 px-4 border-b",children:a.completedDate?new Date(a.completedDate).toLocaleDateString():"N/A"})]},a.lessonId)):e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 px-4 border-b text-center",children:"No lessons found."})})})})})},V=({studentId:c})=>{const[t,x]=l.useState([]),[d,h]=l.useState(!1),[m,o]=l.useState(null),[u,a]=l.useState(new Set),[i,p]=l.useState("name"),f=s=>s?new Date(s).getTime():1/0;l.useEffect(()=>{c?(async()=>{h(!0),o(null);try{const r=sessionStorage.getItem("token");if(!r){o("User is not authenticated.");return}const n=await N.get(`https://knowvara.com/api/api/enrollments/student/${c}/courses`,{headers:{Authorization:`Bearer ${r}`},params:{sortBy:i}});x(n.data.courses)}catch(r){console.error("Error fetching courses:",r),o("Failed to load courses.")}finally{h(!1)}})():o("Student ID is missing.")},[c,i]);const j=s=>{if(s){const r=s.startsWith("http")?s:`/content/${s}`;window.open(r,"_blank")}},D=l.useMemo(()=>{if(!t)return[];const s=[...t];switch(i){case"name":return s.sort((r,n)=>r.courseName.localeCompare(n.courseName));case"enrollDate":return s.sort((r,n)=>new Date(n.enrollDate).getTime()-new Date(r.enrollDate).getTime());case"completedDate":return s.sort((r,n)=>{const I=r.completedDate?new Date(r.completedDate).getTime():0;return(n.completedDate?new Date(n.completedDate).getTime():0)-I});case"dueDate":return s.sort((r,n)=>f(r.dueDate)-f(n.dueDate));default:return s}},[t,i]),g=s=>{a(r=>{const n=new Set(r);return n.has(s)?n.delete(s):n.add(s),n})},b=s=>{switch(s){case"Overdue":return"text-red-600";case"Completed":case"Passed":return"text-green-600";case"Incomplete":return"text-yellow-700";case"Not Attempted":default:return"text-gray-500"}},C=s=>{switch(s){case"Overdue":return"Overdue";case"Completed":return"Completed";case"Incomplete":return"In Progress";case"Not Attempted":default:return"Not Attempted"}},S=s=>{p(s.target.value)};return e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center mb-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Courses"}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 md:mt-0",children:[e.jsx("label",{htmlFor:"sortBy",className:"text-sm",children:"Sort By:"}),e.jsxs("select",{id:"sortBy",value:i,onChange:S,className:"p-2 border rounded-md",children:[e.jsx("option",{value:"name",children:"Name"}),e.jsx("option",{value:"enrollDate",children:"Enroll Date"}),e.jsx("option",{value:"completedDate",children:"Completed Date"}),e.jsx("option",{value:"dueDate",children:"Due Date"})," "]})]})]}),d?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{className:"animate-spin"}),e.jsx("span",{children:"Loading courses..."})]}):m?e.jsx("div",{className:"text-red-500",children:m}):t.length===0?e.jsx("div",{children:"No courses enrolled."}):e.jsx("ul",{className:"space-y-1",children:D.map(s=>e.jsxs("li",{className:"border p-2 rounded-md",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex space-x-4 w-2/3",children:[e.jsx("img",{src:s.imageURL||"/GenericCourseIcon.webp",alt:s.courseName,className:"w-16 h-16 object-cover rounded cursor-pointer",onClick:()=>g(s.enrollmentId)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-md font-semibold text-gray-700 cursor-pointer",onClick:()=>g(s.enrollmentId),children:s.courseName}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center",children:[e.jsx("span",{className:`mt-0 font-semibold ${b(s.status)}`,children:C(s.status)}),s.completedDate&&e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["Completed on:"," ",new Date(s.completedDate).toLocaleDateString()]}),s.dueDate&&e.jsxs("span",{className:"text-sm text-gray-600 ml-2",children:["Due Date:"," ",new Date(s.dueDate).toLocaleDateString()]})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end w-1/3",children:[s.certificateURL&&e.jsx("a",{onClick:()=>j(s.certificateURL),target:"_blank",rel:"noopener noreferrer",className:"lms-icon cursor-pointer",title:"View Certificate","aria-label":`View Certificate for ${s.courseName}`,children:e.jsx(E,{size:20})}),e.jsx("button",{className:"text-gray-600 ml-2 focus:outline-none",onClick:()=>g(s.enrollmentId),"aria-expanded":u.has(s.enrollmentId),"aria-controls":`course-lessons-${s.enrollmentId}`,title:u.has(s.enrollmentId)?"Collapse Lessons":"Expand Lessons",children:u.has(s.enrollmentId)?e.jsx(A,{size:20}):e.jsx(F,{size:20})})]})]}),u.has(s.enrollmentId)&&e.jsx(O,{enrollmentId:s.enrollmentId})]},s.enrollmentId))}),e.jsx("hr",{className:"mt-3"})]})},X=()=>{const{personId:c}=$(),{user:t}=w(),x=R(),d=c||(t==null?void 0:t.Id);if(!d)return e.jsx("div",{children:"Loading..."});const h=!c,m=()=>{const o=sessionStorage.getItem("origin");o?(x(o),sessionStorage.removeItem("origin")):x("/student")};return e.jsxs("div",{className:"flex flex-col md:flex-row h-auto min-h-[100%]",children:[e.jsxs("div",{className:"flex flex-col items-start w-full md:w-1/5 md:border-r border-gray-300 p-2 md:p-4",children:[c&&e.jsx("button",{onClick:m,className:"mb-2 px-3 py-1 text-xs lms-button",children:"Return"}),e.jsx("div",{className:"w-full",children:e.jsx(T,{userId:d,gamify:t==null?void 0:t.gamify,isMe:h})})]}),e.jsx("div",{className:"w-full md:w-3/5 p-2 md:p-4 md:border-r border-gray-300",children:e.jsxs("div",{className:"flex flex-col gap-4 w-full",children:[e.jsx("div",{className:"w-full",children:e.jsx(V,{studentId:d})}),e.jsx("div",{className:"w-full",children:e.jsx(U,{allowLaunch:!1,userId:d})})]})}),e.jsx("div",{className:"w-full md:w-1/5 p-2 md:p-4",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("div",{children:e.jsx(B,{userId:d,height:175,outerRadius:62,innerRadius:10})}),e.jsx("div",{children:e.jsx(M,{userId:d,height:150})}),e.jsx("div",{children:e.jsx(P,{userId:d})})]})})]})};export{X as default};
